æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª Nginx æœåŠ¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚

## Namespace

Namespace æ˜¯ Kubernetes ç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç° **å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»** æˆ–è€… **å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»** ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰çš„Podéƒ½æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå¯èƒ½ä¸æƒ³è®©ä¸¤ä¸ª Pod ä¹‹é—´è¿›è¡Œäº’ç›¸çš„è®¿é—®ï¼Œé‚£æ­¤æ—¶å°±å¯ä»¥å°†ä¸¤ä¸ª Pod åˆ’åˆ†åˆ°ä¸åŒçš„namespace ä¸‹ã€‚Kubernetes é€šè¿‡å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºåˆ†é…åˆ°ä¸åŒçš„ Namespace ä¸­ï¼Œå¯ä»¥å½¢æˆé€»è¾‘ä¸Šçš„ â€œç»„â€ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚

å¯ä»¥é€šè¿‡ Kubernetes çš„æˆæƒæœºåˆ¶ï¼Œå°†ä¸åŒçš„ namespace äº¤ç»™ä¸åŒç§Ÿæˆ·è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å®ç°äº†å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚æ­¤æ—¶è¿˜èƒ½ç»“åˆ Kubernetes çš„èµ„æºé…é¢æœºåˆ¶ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚ CPU ä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ç­‰ï¼Œæ¥å®ç°ç§Ÿæˆ·å¯ç”¨èµ„æºçš„ç®¡ç†ã€‚

<img src="assets/image-20251111180142808.png" alt="image-20251111180142808" style="zoom:88%;" />

åœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤åˆ›å»ºå‡ ä¸ª namespace ã€‚

```bash
kubectl get namespace
```

è¾“å‡ºï¼š

```bash
NAME              STATUS   AGE
default           Active   18h
kube-node-lease   Active   18h
kube-public       Active   18h
kube-system       Active   18h
```

è¿™äº›å‘½åç©ºé—´çš„ä½œç”¨å„æœ‰ä¸åŒï¼Œæ‰¿æ‹…äº†ä¸åŒçš„èŒè´£ã€‚

- **defaultï¼š** æ‰€æœ‰æœªæŒ‡å®š Namespace çš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨ `default` å‘½åç©ºé—´

- **kube-node-leaseï¼š** é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13 å¼€å§‹å¼•å…¥

- **kube-publicï¼š** æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰

- **kube-systemï¼š** æ‰€æœ‰ç”± Kubernetes ç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´

ä¸‹é¢æ¥çœ‹ namespace èµ„æºçš„å…·ä½“æ“ä½œã€‚

### æŸ¥çœ‹

#### æŸ¥çœ‹æ‰€æœ‰çš„ ns

```bash
kubectl get ns
```

#### æŸ¥çœ‹æŒ‡å®šçš„ ns

```bash
kubectl get ns <nsåç§°>

# ä¾‹å¦‚ï¼š
kubectl get ns dafault
```

#### æŒ‡å®šè¾“å‡ºæ ¼å¼

Kubernetes æ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ wide ã€json ã€yaml

```bash
kubectl get ns <nsåç§°>  -o yaml

# ä¾‹å¦‚ï¼š
kubectl get ns default -o yaml
```

#### æŸ¥çœ‹ ns è¯¦æƒ…

```bash
kubectl describe ns <nsåç§°>

# ä¾‹å¦‚:
kubectl describe ns default
```

### åˆ›å»º

```bash
kubectl create ns <nsåç§°>

# ä¾‹å¦‚:
kubectl create ns dev
```

### åˆ é™¤

```bash
kubectl delete ns <nsåç§°>

# ä¾‹å¦‚:
kubectl delete ns dev
```

### é€šè¿‡é…ç½®æ–¹å¼æ“ä½œ

é¦–å…ˆå‡†å¤‡ä¸€ä¸ª YAML æ–‡ä»¶ ns-dev.yaml ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

```bash
cat <<EOF > ns-dev.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: dev
EOF
```

#### åˆ›å»º

```bash
kubectl create -f ns-dev.yaml

# æŸ¥è¯¢ï¼ŒéªŒè¯æ˜¯å¦åˆ›å»º
kubectl get ns
```

#### åˆ é™¤

```bash
kubectl delete -f ns-dev.yaml

# æŸ¥è¯¢ï¼ŒéªŒè¯æ˜¯å¦åˆ é™¤
kubectl get ns
```

## Pod

Pod æ˜¯ Kubernetes é›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äº Pod ä¸­ã€‚

Pod å¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ª Pod ä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚

![image-20251111202718076](assets/image-20251111202718076.png)

Kubernetes åœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªç»„ä»¶ä¹Ÿéƒ½æ˜¯ä»¥ Pod æ–¹å¼è¿è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ã€‚

```bash
kubectl get pod -n kube-system
```

![image-20251111202844522](assets/image-20251111202844522.png)

### åˆ›å»ºå¹¶è¿è¡Œ

Kubernetes æ²¡æœ‰æä¾›å•ç‹¬è¿è¡Œ Pod çš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡ Pod æ§åˆ¶å™¨æ¥å®ç°çš„ã€‚

å‘½ä»¤æ ¼å¼ï¼š 

```bash
kubectl run (podæ§åˆ¶å™¨åç§°) [å‚æ•°]
```

ä¾‹ï¼š

```bash
# --image  æŒ‡å®šPodçš„é•œåƒ
# --port   æŒ‡å®šç«¯å£
# --namespace  æŒ‡å®šnamespace
kubectl run nginx --image=nginx:alpine --port=80 --namespace dev
```

### æŸ¥çœ‹ Pod ä¿¡æ¯

```bash
# æŸ¥çœ‹ Pod åŸºæœ¬ä¿¡æ¯
kubectl get pods -n dev

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod nginx-7b676545bc-txk98 -n dev
```

![image-20251111204721689](assets/image-20251111204721689.png)

### è®¿é—® Pod

```bash
# è·å– POD çš„ IP åœ°å€
kubectl get pods -n dev -o wide

# è®¿é—® POD
curl http://10.244.2.4:80
```

![image-20251111205038594](assets/image-20251111205038594.png)

### åˆ é™¤æŒ‡å®š Pod

```bash
# åˆ é™¤æŒ‡å®š POD
kubectl delete pod nginx-7b676545bc-txk98 -n dev

# æ­¤æ—¶ï¼Œæ˜¾ç¤ºåˆ é™¤PodæˆåŠŸï¼Œä½†æ˜¯å†æŸ¥è¯¢ï¼Œå‘ç°åˆæ–°äº§ç”Ÿäº†ä¸€ä¸ª
kubectl get pods -n dev -o wide

# è¿™æ˜¯å› ä¸ºå½“å‰Podæ˜¯ç”±Podæ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œæ§åˆ¶å™¨ä¼šç›‘æ§ Pod çŠ¶å†µï¼Œä¸€æ—¦å‘ç° Pod æ­»äº¡ï¼Œä¼šç«‹å³é‡å»º
# æ­¤æ—¶è¦æƒ³åˆ é™¤ Podï¼Œå¿…é¡»åˆ é™¤ Pod æ§åˆ¶å™¨
# æŸ¥è¯¢ä¸€ä¸‹å½“å‰ namespace ä¸‹çš„ Pod æ§åˆ¶å™¨
kubectl get deploy -n dev -o wide

# åˆ é™¤æ­¤ Pod æ§åˆ¶å™¨
kubectl delete deploy nginx -n dev

# ç¨ç­‰ç‰‡åˆ»ï¼Œå†æŸ¥è¯¢ Podï¼Œå‘ç° Pod è¢«åˆ é™¤äº†
kubectl get pods -n dev -o wide
```

![image-20251111210204832](assets/image-20251111210204832.png)

### é€šè¿‡é…ç½®æ–¹å¼æ“ä½œ

é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ª pod-nginx.yaml æ–‡ä»¶å¹¶å†™å…¥ç›¸å…³å†…å®¹ã€‚

```bash
cat <<EOF > pod-nginx.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: dev
spec:
  containers:
  - image: nginx:alpine
    name: pod
    ports:
    - name: nginx-port
      containerPort: 80
      protocol: TCP
EOF
```

#### åˆ›å»º

```bash
kubectl create -f pod-nginx.yaml
```

è¿™ä¸ªæ—¶å€™ï¼ŒNginx æœåŠ¡æ˜¯æ— æ³•è®¿é—®çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰åˆ›å»º service å»æš´éœ² deployment ã€‚

![image-20251111212049593](assets/image-20251111212049593.png)

#### åˆ é™¤

```bash
kubectl delete -f pod-nginx.yaml
```

## Label

Label æ˜¯ Kubernetes ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨èµ„æºä¸Šæ·»åŠ æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©ã€‚

Label çš„ç‰¹ç‚¹ï¼š

- ä¸€ä¸ª Label ä¼šä»¥ `key/value` é”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Šï¼Œå¦‚ Node ã€ Pod ã€Service ç­‰ï¼›
- ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„ Label ï¼ŒåŒä¸€ä¸ª Label ä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»ï¼›
- Label é€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤ï¼›

å¯ä»¥é€šè¿‡ Label å®ç°èµ„æºçš„å¤šç»´åº¦åˆ†ç»„ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œã€‚

> **ğŸ¤“ è¯´æ˜ï¼š**
>
> ä¸€äº›å¸¸ç”¨çš„ Label ç¤ºä¾‹å¦‚ä¸‹ï¼š
>
> - ç‰ˆæœ¬æ ‡ç­¾ï¼š
>   - "version":"release"
>   - "version":"stable"
>   - ...
> - ç¯å¢ƒæ ‡ç­¾ï¼š
>   - "environment":"dev"
>   - "environment":"prod"
>   - "environment":"test"
>   - ...
> - æ¶æ„æ ‡ç­¾ï¼š
>   - "tier":"frontend"
>   - "tier":"backend"
>   - ...

æ ‡ç­¾å®šä¹‰å®Œæ¯•ä¹‹åï¼Œè¿˜è¦è€ƒè™‘åˆ°æ ‡ç­¾çš„é€‰æ‹©ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ° Label Selectorï¼ŒäºŒè€…æ¦‚å¿µåŒºåˆ«å¦‚ä¸‹ã€‚

- Label ç”¨äºç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰æ ‡è¯†ï¼›
- Label Selector ç”¨äºæŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›æ ‡ç­¾çš„èµ„æºå¯¹è±¡ï¼›

å½“å‰æœ‰ä¸¤ç§ Label Selectorï¼š

- åŸºäºç­‰å¼çš„ Label Selector

> **name=slaveï¼š** é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­ `key="name"` ä¸” `value="slave"` çš„å¯¹è±¡
>
> **env!=productionï¼š** é€‰æ‹©æ‰€æœ‰åŒ…æ‹¬ Label ä¸­çš„ `key="env"` ä¸” `value!="production"` çš„å¯¹è±¡

- åŸºäºé›†åˆçš„ Label Selector

> **name in (master, slave)ï¼š** é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­çš„ `key="name"` ä¸” `value="master"` æˆ– `"slave"` çš„å¯¹è±¡
>
> **name not in (frontend)ï¼š** é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­çš„ `key="name"` ä¸” `value` ä¸ç­‰äº `"frontend"` çš„å¯¹è±¡

æ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ª Label Selector è¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å· `,` è¿›è¡Œåˆ†éš”å³å¯ã€‚

ä¾‹å¦‚ï¼š

```bash
name=slave,env!=production
name not in (frontend),env!=production
```

### å‘½ä»¤æ–¹å¼

```bash
# ä¸º Pod èµ„æºæ‰“æ ‡ç­¾
kubectl label pod nginx version=1.0 -n dev

# ä¸º Pod èµ„æºæ›´æ–°æ ‡ç­¾
kubectl label pod nginx version=2.0 -n dev --overwrite

# æŸ¥çœ‹ Pod æ ‡ç­¾
kubectl get pod nginx -n dev --show-labels

# é€šè¿‡æ ‡ç­¾ç­›é€‰ Pods
kubectl get pod -n dev -l version=2.0  --show-labels
kubectl get pod -n dev -l version!=2.0 --show-labels

# åˆ é™¤ Pod èµ„æºæ ‡ç­¾
kubectl label pod nginx-pod version- -n dev
```

### é…ç½®æ–¹å¼

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ–°å»º YAML æ–‡ä»¶å¹¶å†™å…¥å†…å®¹ã€‚

```bash
cat <<EOF > pod-nginx.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: dev
  labels:
    version: "3.0" 
    env: "test"
spec:
  containers:
  - image: nginx:1.17.1
    name: pod
    ports:
    - name: nginx-port
      containerPort: 80
      protocol: TCP
EOF
```

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°æ ‡ç­¾ã€‚

```bash
kubectl apply -f pod-nginx.yaml
```

## Deployment

