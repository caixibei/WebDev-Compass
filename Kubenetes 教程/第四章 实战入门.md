<div style="width:100%;display:flex;"><img src="assets/640.gif" alt="640" style="width:200px;margin-left:auto;" /></div>

æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨ Kubernetes é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª Nginx æœåŠ¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚

## Namespace

Namespace æ˜¯ Kubernetes ç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç° **å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»** æˆ–è€… **å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»** ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes é›†ç¾¤ä¸­çš„æ‰€æœ‰çš„Podéƒ½æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå¯èƒ½ä¸æƒ³è®©ä¸¤ä¸ª Pod ä¹‹é—´è¿›è¡Œäº’ç›¸çš„è®¿é—®ï¼Œé‚£æ­¤æ—¶å°±å¯ä»¥å°†ä¸¤ä¸ª Pod åˆ’åˆ†åˆ°ä¸åŒçš„namespace ä¸‹ã€‚Kubernetes é€šè¿‡å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºåˆ†é…åˆ°ä¸åŒçš„ Namespace ä¸­ï¼Œå¯ä»¥å½¢æˆé€»è¾‘ä¸Šçš„ â€œç»„â€ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚

å¯ä»¥é€šè¿‡ Kubernetes çš„æˆæƒæœºåˆ¶ï¼Œå°†ä¸åŒçš„ namespace äº¤ç»™ä¸åŒç§Ÿæˆ·è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å®ç°äº†å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚æ­¤æ—¶è¿˜èƒ½ç»“åˆ Kubernetes çš„èµ„æºé…é¢æœºåˆ¶ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚ CPU ä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ç­‰ï¼Œæ¥å®ç°ç§Ÿæˆ·å¯ç”¨èµ„æºçš„ç®¡ç†ã€‚

<img src="assets/image-20251111180142808.png" alt="image-20251111180142808" style="zoom:88%;" />

åœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤åˆ›å»ºå‡ ä¸ª namespace ã€‚

```bash
kubectl get namespace
```

è¾“å‡ºï¼š

```bash
NAME              STATUS   AGE
default           Active   18h
kube-node-lease   Active   18h
kube-public       Active   18h
kube-system       Active   18h
```

è¿™äº›å‘½åç©ºé—´çš„ä½œç”¨å„æœ‰ä¸åŒï¼Œæ‰¿æ‹…äº†ä¸åŒçš„èŒè´£ã€‚

- **defaultï¼š** æ‰€æœ‰æœªæŒ‡å®š Namespace çš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨ `default` å‘½åç©ºé—´

- **kube-node-leaseï¼š** é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13 å¼€å§‹å¼•å…¥

- **kube-publicï¼š** æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰

- **kube-systemï¼š** æ‰€æœ‰ç”± Kubernetes ç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´

ä¸‹é¢æ¥çœ‹ namespace èµ„æºçš„å…·ä½“æ“ä½œã€‚

### æŸ¥çœ‹

#### æŸ¥çœ‹æ‰€æœ‰çš„ ns

```bash
kubectl get ns
```

#### æŸ¥çœ‹æŒ‡å®šçš„ ns

```bash
kubectl get ns <nsåç§°>

# ä¾‹å¦‚ï¼š
kubectl get ns dafault
```

#### æŒ‡å®šè¾“å‡ºæ ¼å¼

Kubernetes æ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯ wide ã€json ã€yaml

```bash
kubectl get ns <nsåç§°>  -o yaml

# ä¾‹å¦‚ï¼š
kubectl get ns default -o yaml
```

#### æŸ¥çœ‹ ns è¯¦æƒ…

```bash
kubectl describe ns <nsåç§°>

# ä¾‹å¦‚:
kubectl describe ns default
```

### åˆ›å»º

```bash
kubectl create ns <nsåç§°>

# ä¾‹å¦‚:
kubectl create ns dev
```

### åˆ é™¤

```bash
kubectl delete ns <nsåç§°>

# ä¾‹å¦‚:
kubectl delete ns dev
```

### é€šè¿‡é…ç½®æ–¹å¼æ“ä½œ

é¦–å…ˆå‡†å¤‡ä¸€ä¸ª YAML æ–‡ä»¶ ns-dev.yaml ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€‚

```bash
cat <<EOF > ns-dev.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: dev
EOF
```

#### åˆ›å»º

```bash
kubectl create -f ns-dev.yaml

# æŸ¥è¯¢ï¼ŒéªŒè¯æ˜¯å¦åˆ›å»º
kubectl get ns
```

#### åˆ é™¤

```bash
kubectl delete -f ns-dev.yaml

# æŸ¥è¯¢ï¼ŒéªŒè¯æ˜¯å¦åˆ é™¤
kubectl get ns
```

## Pod

Pod æ˜¯ Kubernetes é›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äº Pod ä¸­ã€‚

Pod å¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ª Pod ä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚

![image-20251111202718076](assets/image-20251111202718076.png)

Kubernetes åœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªç»„ä»¶ä¹Ÿéƒ½æ˜¯ä»¥ Pod æ–¹å¼è¿è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ã€‚

```bash
kubectl get pod -n kube-system
```

![image-20251111202844522](assets/image-20251111202844522.png)

### åˆ›å»ºå¹¶è¿è¡Œ

Kubernetes æ²¡æœ‰æä¾›å•ç‹¬è¿è¡Œ Pod çš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡ Pod æ§åˆ¶å™¨æ¥å®ç°çš„ã€‚

å‘½ä»¤æ ¼å¼ï¼š 

```bash
kubectl run (podæ§åˆ¶å™¨åç§°) [å‚æ•°]
```

ä¾‹ï¼š

```bash
# --image  æŒ‡å®šPodçš„é•œåƒ
# --port   æŒ‡å®šç«¯å£
# --namespace  æŒ‡å®šnamespace
kubectl run nginx --image=nginx:alpine --port=80 --namespace dev
```

### æŸ¥çœ‹ Pod ä¿¡æ¯

```bash
# æŸ¥çœ‹ Pod åŸºæœ¬ä¿¡æ¯
kubectl get pods -n dev

# æŸ¥çœ‹ Pod è¯¦ç»†ä¿¡æ¯
kubectl describe pod nginx-7b676545bc-txk98 -n dev
```

![image-20251111204721689](assets/image-20251111204721689.png)

### è®¿é—® Pod

```bash
# è·å– POD çš„ IP åœ°å€
kubectl get pods -n dev -o wide

# è®¿é—® POD
curl http://10.244.2.4:80
```

![image-20251111205038594](assets/image-20251111205038594.png)

### åˆ é™¤æŒ‡å®š Pod

```bash
# åˆ é™¤æŒ‡å®š POD
kubectl delete pod nginx-7b676545bc-txk98 -n dev

# æ­¤æ—¶ï¼Œæ˜¾ç¤ºåˆ é™¤PodæˆåŠŸï¼Œä½†æ˜¯å†æŸ¥è¯¢ï¼Œå‘ç°åˆæ–°äº§ç”Ÿäº†ä¸€ä¸ª
kubectl get pods -n dev -o wide

# è¿™æ˜¯å› ä¸ºå½“å‰Podæ˜¯ç”±Podæ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œæ§åˆ¶å™¨ä¼šç›‘æ§ Pod çŠ¶å†µï¼Œä¸€æ—¦å‘ç° Pod æ­»äº¡ï¼Œä¼šç«‹å³é‡å»º
# æ­¤æ—¶è¦æƒ³åˆ é™¤ Podï¼Œå¿…é¡»åˆ é™¤ Pod æ§åˆ¶å™¨
# æŸ¥è¯¢ä¸€ä¸‹å½“å‰ namespace ä¸‹çš„ Pod æ§åˆ¶å™¨
kubectl get deploy -n dev -o wide

# åˆ é™¤æ­¤ Pod æ§åˆ¶å™¨
kubectl delete deploy nginx -n dev

# ç¨ç­‰ç‰‡åˆ»ï¼Œå†æŸ¥è¯¢ Podï¼Œå‘ç° Pod è¢«åˆ é™¤äº†
kubectl get pods -n dev -o wide
```

![image-20251111210204832](assets/image-20251111210204832.png)

### é€šè¿‡é…ç½®æ–¹å¼æ“ä½œ

é€šè¿‡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä¼šåˆ›å»ºä¸€ä¸ª pod-nginx.yaml æ–‡ä»¶å¹¶å†™å…¥ç›¸å…³å†…å®¹ã€‚

```bash
cat <<EOF > pod-nginx.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: dev
spec:
  containers:
  - image: nginx:alpine
    name: pod
    ports:
    - name: nginx-port
      containerPort: 80
      protocol: TCP
EOF
```

#### åˆ›å»º

```bash
kubectl create -f pod-nginx.yaml
```

è¿™ä¸ªæ—¶å€™ï¼ŒNginx æœåŠ¡æ˜¯æ— æ³•è®¿é—®çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰åˆ›å»º service å»æš´éœ² deployment ã€‚

![image-20251111212049593](assets/image-20251111212049593.png)

#### åˆ é™¤

```bash
kubectl delete -f pod-nginx.yaml
```

## Label

Label æ˜¯ Kubernetes ç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨èµ„æºä¸Šæ·»åŠ æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©ã€‚

Label çš„ç‰¹ç‚¹ï¼š

- ä¸€ä¸ª Label ä¼šä»¥ `key/value` é”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Šï¼Œå¦‚ Node ã€ Pod ã€Service ç­‰ï¼›
- ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„ Label ï¼ŒåŒä¸€ä¸ª Label ä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»ï¼›
- Label é€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤ï¼›

å¯ä»¥é€šè¿‡ Label å®ç°èµ„æºçš„å¤šç»´åº¦åˆ†ç»„ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œã€‚

> **ğŸ¤“ è¯´æ˜ï¼š**
>
> ä¸€äº›å¸¸ç”¨çš„ Label ç¤ºä¾‹å¦‚ä¸‹ï¼š
>
> - ç‰ˆæœ¬æ ‡ç­¾ï¼š
>   - "version":"release"
>   - "version":"stable"
>   - ...
> - ç¯å¢ƒæ ‡ç­¾ï¼š
>   - "environment":"dev"
>   - "environment":"prod"
>   - "environment":"test"
>   - ...
> - æ¶æ„æ ‡ç­¾ï¼š
>   - "tier":"frontend"
>   - "tier":"backend"
>   - ...

æ ‡ç­¾å®šä¹‰å®Œæ¯•ä¹‹åï¼Œè¿˜è¦è€ƒè™‘åˆ°æ ‡ç­¾çš„é€‰æ‹©ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ° Label Selectorï¼ŒäºŒè€…æ¦‚å¿µåŒºåˆ«å¦‚ä¸‹ã€‚

- Label ç”¨äºç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰æ ‡è¯†ï¼›
- Label Selector ç”¨äºæŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›æ ‡ç­¾çš„èµ„æºå¯¹è±¡ï¼›

å½“å‰æœ‰ä¸¤ç§ Label Selectorï¼š

- åŸºäºç­‰å¼çš„ Label Selector

> **name=slaveï¼š** é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­ `key="name"` ä¸” `value="slave"` çš„å¯¹è±¡
>
> **env!=productionï¼š** é€‰æ‹©æ‰€æœ‰åŒ…æ‹¬ Label ä¸­çš„ `key="env"` ä¸” `value!="production"` çš„å¯¹è±¡

- åŸºäºé›†åˆçš„ Label Selector

> **name in (master, slave)ï¼š** é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­çš„ `key="name"` ä¸” `value="master"` æˆ– `"slave"` çš„å¯¹è±¡
>
> **name not in (frontend)ï¼š** é€‰æ‹©æ‰€æœ‰åŒ…å« Label ä¸­çš„ `key="name"` ä¸” `value` ä¸ç­‰äº `"frontend"` çš„å¯¹è±¡

æ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ª Label Selector è¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å· `,` è¿›è¡Œåˆ†éš”å³å¯ã€‚

ä¾‹å¦‚ï¼š

```bash
name=slave,env!=production
name not in (frontend),env!=production
```

### å‘½ä»¤æ–¹å¼

```bash
# ä¸º Pod èµ„æºæ‰“æ ‡ç­¾
kubectl label pod nginx version=1.0 -n dev

# ä¸º Pod èµ„æºæ›´æ–°æ ‡ç­¾
kubectl label pod nginx version=2.0 -n dev --overwrite

# æŸ¥çœ‹ Pod æ ‡ç­¾
kubectl get pod nginx -n dev --show-labels

# é€šè¿‡æ ‡ç­¾ç­›é€‰ Pods
kubectl get pod -n dev -l version=2.0  --show-labels
kubectl get pod -n dev -l version!=2.0 --show-labels

# åˆ é™¤ Pod èµ„æºæ ‡ç­¾
kubectl label pod nginx-pod version- -n dev
```

### é…ç½®æ–¹å¼

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ–°å»º YAML æ–‡ä»¶å¹¶å†™å…¥å†…å®¹ã€‚

```bash
cat <<EOF > pod-nginx.yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: dev
  labels:
    version: "3.0" 
    env: "test"
spec:
  containers:
  - image: nginx:alpine
    name: pod
    ports:
    - name: nginx-port
      containerPort: 80
      protocol: TCP
EOF
```

æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–°æ ‡ç­¾ã€‚

```bash
kubectl apply -f pod-nginx.yaml
```

## Deployment

åœ¨ Kubernetes ä¸­ï¼ŒPod æ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒï¼Œä½†æ˜¯ Kubernetes å¾ˆå°‘ç›´æ¥æ§åˆ¶ Pod ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ Pod æ§åˆ¶å™¨æ¥å®Œæˆçš„ã€‚Pod æ§åˆ¶å™¨ç”¨äº pod çš„ç®¡ç†ï¼Œç¡®ä¿ pod èµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“ pod çš„èµ„æºå‡ºç°æ•…éšœæ—¶ï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»º pod ã€‚

åœ¨ Kubernetes ä¸­ Pod æ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼Œæœ¬ç« èŠ‚åªä»‹ç»ä¸€ç§ï¼šDeployment ã€‚

![image-20251111221737475](assets/image-20251111221737475.png)

### å‘½ä»¤æ–¹å¼

```bash
# å‘½ä»¤æ ¼å¼: kubectl run deployment åç§° [å‚æ•°] 
# --image     æŒ‡å®š pod çš„é•œåƒ
# --port      æŒ‡å®šç«¯å£
# --replicas  æŒ‡å®šåˆ›å»º pod æ•°é‡
# --namespace æŒ‡å®š namespace
kubectl run nginx --image=nginx:alpine --port=80 --replicas=3 -n dev

# æŸ¥çœ‹åˆ›å»ºçš„Pod
kubectl get pods -n dev

# æŸ¥çœ‹ deployment çš„ä¿¡æ¯
kubectl get deploy -n dev

# UP-TO-DATEï¼šæˆåŠŸå‡çº§çš„å‰¯æœ¬æ•°é‡
# AVAILABLEï¼šå¯ç”¨å‰¯æœ¬çš„æ•°é‡
kubectl get deploy -n dev -o wide

# æŸ¥çœ‹deploymentçš„è¯¦ç»†ä¿¡æ¯
kubectl describe deploy nginx -n dev

# åˆ é™¤ 
kubectl delete deploy nginx -n dev
```

### é…ç½®æ–¹å¼

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ–°å»º YAML æ–‡ä»¶å¹¶å†™å…¥å†…å®¹ã€‚

```bash
cat <<EOF > deploy-nginx.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  namespace: dev
spec:
  replicas: 3
  selector:
    matchLabels:
      run: nginx
  template:
    metadata:
      labels:
        run: nginx
    spec:
      containers:
      - image: nginx:alpine
        name: nginx
        ports:
        - containerPort: 80
          protocol: TCP
EOF
```

#### åˆ›å»º

```bash
kubectl create -f deploy-nginx.yaml
```

#### åˆ é™¤

```bash
kubectl delete -f deploy-nginx.yaml
```

## Service

ç»è¿‡ä¸Šé¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿåˆ©ç”¨Deploymentæ¥åˆ›å»ºä¸€ç»„ Pod æ¥æä¾›å…·æœ‰é«˜å¯ç”¨æ€§çš„æœåŠ¡ã€‚

è™½ç„¶æ¯ä¸ªPodéƒ½ä¼šåˆ†é…ä¸€ä¸ªå•ç‹¬çš„ Pod IPï¼Œç„¶è€Œå´å­˜åœ¨å¦‚ä¸‹ä¸¤é—®é¢˜ï¼š

- Pod IP ä¼šéšç€ Pod çš„é‡å»ºäº§ç”Ÿå˜åŒ–
- Pod IP ä»…ä»…æ˜¯é›†ç¾¤å†…å¯è§çš„è™šæ‹Ÿ IPï¼Œå¤–éƒ¨æ— æ³•è®¿é—®

è¿™æ ·å¯¹äºè®¿é—®è¿™ä¸ªæœåŠ¡å¸¦æ¥äº†éš¾åº¦ï¼Œå› æ­¤ï¼ŒKubernetes è®¾è®¡äº† Service æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

Service å¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±» Pod **å¯¹å¤–çš„è®¿é—®æ¥å£** ï¼Œå€ŸåŠ© Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚

![image-20251111224203030](assets/image-20251111224203030.png)

### å‘½ä»¤æ–¹å¼

#### åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„ Service

```bash
# æš´éœ² Service
kubectl expose deploy nginx --name=svc-nginx --type=ClusterIP --port=80 --target-port=80 -n dev

# æŸ¥çœ‹ service
kubectl get svc svc-nginx -n dev -o wide

# è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ª CLUSTER-IPï¼Œè¿™å°±æ˜¯ service çš„ IPï¼Œåœ¨ Service çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸ä¼šå˜åŠ¨çš„
# å¯ä»¥é€šè¿‡è¿™ä¸ª IP è®¿é—®å½“å‰ service å¯¹åº”çš„ POD
curl 10.109.179.231:80
```

#### åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„ Service

<div style="border: 1px solid rgba(255, 165, 0,.1);
    padding: 10px;
    border-left: 5px solid rgba(255, 165, 0);
    background: rgba(255, 165, 0,.1);
    border-radius: 0 3px 3px 0;
    color: rgba(255, 165, 0);
    font-family: menlo;
    font-size: 12px;
    margin: 10px 0;
    display: flex;
    align-items: center;
    gap: 8px;">
    <svg viewBox="0 0 24 24" width="14px" height="14px" fill="none" style="flex-shrink: 0;" xmlns="http://www.w3.org/2000/svg">
    <path d="M12 8.00008V12.0001M12 16.0001H12.01M3 7.94153V16.0586C3 16.4013 3 16.5726 3.05048 16.7254C3.09515 16.8606 3.16816 16.9847 3.26463 17.0893C3.37369 17.2077 3.52345 17.2909 3.82297 17.4573L11.223 21.5684C11.5066 21.726 11.6484 21.8047 11.7985 21.8356C11.9315 21.863 12.0685 21.863 12.2015 21.8356C12.3516 21.8047 12.4934 21.726 12.777 21.5684L20.177 17.4573C20.4766 17.2909 20.6263 17.2077 20.7354 17.0893C20.8318 16.9847 20.9049 16.8606 20.9495 16.7254C21 16.5726 21 16.4013 21 16.0586V7.94153C21 7.59889 21 7.42756 20.9495 7.27477C20.9049 7.13959 20.8318 7.01551 20.7354 6.91082C20.6263 6.79248 20.4766 6.70928 20.177 6.54288L12.777 2.43177C12.4934 2.27421 12.3516 2.19543 12.2015 2.16454C12.0685 2.13721 11.9315 2.13721 11.7985 2.16454C11.6484 2.19543 11.5066 2.27421 11.223 2.43177L3.82297 6.54288C3.52345 6.70928 3.37369 6.79248 3.26463 6.91082C3.16816 7.01551 3.09515 7.13959 3.05048 7.27477C3 7.42756 3 7.59889 3 7.94153Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    </path>
</svg>
    <span style="line-height: 16px;">ä¸Šé¢åˆ›å»ºçš„ Service çš„ type ç±»å‹ä¸º ClusterIPï¼Œè¿™ä¸ª ip åœ°å€åªæœ‰é›†ç¾¤å†…éƒ¨å¯è®¿é—®ï¼Œå¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„ Serviceï¼Œéœ€è¦ä¿®æ”¹ type ä¸º NodePortã€‚</span>
</div>

```bash
# ä¸Šé¢åˆ›å»ºçš„ Service çš„ type ç±»å‹ä¸º ClusterIPï¼Œè¿™ä¸ª ip åœ°å€åªæœ‰é›†ç¾¤å†…éƒ¨å¯è®¿é—®ï¼Œå¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„ Serviceï¼Œéœ€è¦ä¿®æ”¹ type ä¸º NodePortã€‚
kubectl expose deploy nginx --name=svc-nginx --type=NodePort --port=80 --target-port=80 -n dev

# æ­¤æ—¶æŸ¥çœ‹ï¼Œä¼šå‘ç°å‡ºç°äº† NodePort ç±»å‹çš„Serviceï¼Œè€Œä¸”æœ‰ä¸€å¯¹ Portï¼ˆ80:31928/TCï¼‰
kubectl get svc  svc-nginx-1  -n dev -o wide

# æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„ä¸»æœºè®¿é—®  èŠ‚ç‚¹IP:32525 è®¿é—®æœåŠ¡äº†
# ä¾‹å¦‚åœ¨çš„ç”µè„‘ä¸»æœºä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸‹é¢çš„åœ°å€
http://192.168.239.100:32525/
```

#### åˆ é™¤ Service

```bash
kubectl delete svc svc-nginx -n dev
```

### é…ç½®æ–¹å¼

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ–°å»º YAML æ–‡ä»¶å¹¶å†™å…¥å†…å®¹ã€‚

```bash
cat <<EOF > service-nginx.yaml
apiVersion: v1
kind: Service
metadata:
  name: svc-nginx
  namespace: dev
spec:
  clusterIP: 10.109.179.231
  ports:
  - port: 80
    protocol: TCP
    targetPort: 80
    nodePort: 32080
  selector:
    run: nginx
  type: NodePort
EOF
```

#### åˆ›å»º

```bash
kubectl create -f service-nginx.yaml
```

#### åˆ é™¤

```bash
kubectl delete -f service-nginx.yaml
```

## å°ç»“

è‡³æ­¤ï¼Œå·²ç»æŒæ¡äº† Namespace ã€Pod ã€Deployment ã€Service èµ„æºçš„åŸºæœ¬æ“ä½œã€‚æœ‰äº†è¿™äº›æ“ä½œï¼Œå°±å¯ä»¥åœ¨ Kubernetes é›†ç¾¤ä¸­å®ç°ä¸€ä¸ªæœåŠ¡çš„ç®€å•éƒ¨ç½²å’Œè®¿é—®äº†ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦æ›´å¥½çš„ä½¿ç”¨ Kubernetesï¼Œå°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™å‡ ç§èµ„æºçš„ç»†èŠ‚å’ŒåŸç†ã€‚
