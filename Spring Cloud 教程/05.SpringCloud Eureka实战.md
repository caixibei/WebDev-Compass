[TOC]

# Spring Cloud Eureka é›†ç¾¤éƒ¨ç½²

> âœ¨ ä¹Ÿè®¸åœ¨å¤šå¹´åæˆ‘ä»¬åçŸ¥åè§‰çš„å‘ç°ï¼Œæˆ‘ä»¬è¦åšçš„å¹¶ä¸æ˜¯è´¨é—®å¯¹æ–¹ï¼šä¸ºä½•ç¦»å¼€ï¼Ÿè€Œæ˜¯æ—¶è¿‡å¢ƒè¿ä¹‹åæ˜ç™½äº†ï¼Œæ¯ä¸€ä¸ªæœªæ¥éƒ½æœ‰äººåœ¨ï¼Œä¸è¦æ‰§æ‹—çš„æŠŠè‡ªå·±å›°åœ¨å›ä¸å»çš„å›å¿†é‡Œä¸æ–­æ€€å¿µã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¸å¾—ä¸æ‰¿è®¤ï¼Œå¤±å»æ¯”æ‹¥æœ‰æ›´åŠ è¸å®ã€‚

æœ€è¿‘ä¸€æ®µæ—¶é—´å†…ï¼Œå†…å¿ƒæ€»æ˜¯æº¢å‡º â€œ è¦é™ä¸‹å¿ƒæ¥ï¼Œå¥½å¥½åšä¸€ä»¶èƒ½å¤Ÿå¯¹è‡ªå·±æœªæ¥3åˆ°5å¹´å†…äº§ç”Ÿå½±å“çš„äº‹æƒ… â€ çš„æƒ³æ³•ã€‚äººå‘ï¼Œåœ¨é—²çš„è›‹ç–¼çš„æ—¶å€™æ€»çˆ±èƒ¡æ€ä¹±æƒ³ï¼Œå¥½åƒåˆæœ‰å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œé‚£å°±å¿ƒè¡€æ¥æ½®çš„å†™ä¸€ä¸ªå§ã€‚ä¸‹é¢æˆ‘æ‰‹æŠŠæ‰‹çš„æ•™ä½ å¦‚ä½•ä¸€é”®éƒ¨ç½²é«˜å¯ç”¨æ³¨å†Œä¸­å¿ƒæœåŠ¡ã€‚ğŸ‘‡

## 1 ç¯å¢ƒå‡†å¤‡

ä¸ºäº†å°‘è¸©å‘ï¼Œæ‰€ä»¥æˆ‘è¿˜æ˜¯å¤§è‡´è¯´ä¸‹æˆ‘çš„å¼€å‘ç¯å¢ƒå§ã€‚

- java 1.8.0_152
- docker 26.1.4
- idea 2023.2
- maven 3.6.3
- git 2.26.2

å› ä¸ºæˆ‘æœ¬æœºé…ç½®ä¸å¤Ÿé«˜ï¼Œè·‘ Docker Desktop å°±ä¼šå¾ˆå¡é¡¿ï¼Œæ‰€ä»¥æˆ‘çš„ Docker æ˜¯æ”¾åœ¨åä¸ºäº‘æœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„ã€‚

## 2 åˆ›å»ºé¡¹ç›®

<div style="border: 1px solid #1d63edb5;
    padding: 10px;
    border-left: 5px solid #1d63edb5;
    background: #bed2fa63;
    border-radius: 0 3px 3px 0;
    color: #1d63ed;
    font-family: menlo;
    font-size: 12px;
    margin: 10px 0;
    display: flex;
    align-items: center;
    gap: 8px;">
    <svg viewBox="0 0 24 24" style="flex-shrink: 0;" width="14px" height="14px" fill="none" xmlns="http://www.w3.org/2000/svg" class="MuiSvgIcon-root MuiSvgIcon-colorInfo MuiSvgIcon-fontSizeSmall css-1bqouqa" focusable="false" aria-hidden="true" data-testid="InfoCircleIcon"><path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
    <span style="line-height: 16px;">ä½ å¯ä»¥é€‰æ‹©ç›´æ¥ä½¿ç”¨ IDEA å»åˆ›å»ºé¡¹ç›®éª¨æ¶ï¼Œç”šè‡³ä½ ä½¿ç”¨ Eclipse æ­å»ºéƒ½è¡Œï¼Œä½†æˆ‘éƒ½ä¸ç”¨ã€‚</span>
</div>

è®¿é—® <span style="color:#4185C6;">start.spring.io</span> æˆ–è€… <span style="color:#4185C6;">start.aliyun.com</span> ç«™ç‚¹åœ°å€ï¼Œæ­å»ºå¾®æœåŠ¡é¡¹ç›®éª¨æ¶ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©ä½¿ç”¨é˜¿é‡Œäº‘æä¾›çš„ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20241226153343989](./assets/image-20241226153343989.png)

ç‚¹å‡»è·å–ä»£ç ä¹‹åï¼Œå°†ä»£ç ä¸‹è½½ä¸‹æ¥ï¼Œæœ€ç»ˆæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20241226160248870](./assets/image-20241226160248870.png)

## 3 é¡¹ç›®æ‰˜ç®¡

æˆ‘ä»¬é€‰æ‹©å°†ä»£ç æ‰˜ç®¡åˆ° â€œå…¨çƒæœ€å¤§çš„åŒæ€§äº¤å‹ç½‘ç«™â€ ï¼Œåˆ›å»ºä»“åº“ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

![image-20241226154149306](./assets/image-20241226154149306.png)



åˆ›å»ºå¥½ä»“åº“ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä»“åº“è®¤è¯æ‰å¯ä»¥å¾€ä¸Šæ¨ä»£ç ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ˜¯è¿›è¡Œè®¤è¯ï¼Œæ‰“å¼€ Git å‘½ä»¤æ§åˆ¶å°ï¼Œé…ç½®è´¦æˆ·å’Œé‚®ç®±ï¼š

```bash
git config â€“global user.name '<è´¦æˆ·å>'
git config â€“global user.email '<é‚®ç®±>'
```

æ‰“å¼€ Git å‘½ä»¤æ§åˆ¶å°ï¼Œç”Ÿæˆå¯†é’¥ï¼š

```bash
#-t æŒ‡å®šå¯†é’¥ç±»å‹ï¼Œé»˜è®¤æ˜¯ rsa ï¼Œå¯ä»¥çœç•¥ã€‚
#-C è®¾ç½®æ³¨é‡Šæ–‡å­—ï¼Œæ¯”å¦‚é‚®ç®±ã€‚
#-f æŒ‡å®šå¯†é’¥æ–‡ä»¶å­˜å‚¨æ–‡ä»¶åã€‚
ssh-keygen -t rsa -C '<é‚®ç®±>'
```

è¾“å…¥å®Œæˆåï¼Œè¿ç»­æŒ‰3ä¸ªå›è½¦ï¼Œå¯†é’¥ç”Ÿæˆç»“æœå¦‚ä¸‹ï¼š

```bash
[root@localhost ~]# ssh-keygen -t rsa       <== å»ºç«‹å¯†é’¥å¯¹ï¼Œ-tä»£è¡¨ç±»å‹ï¼Œæœ‰RSAå’ŒDSAä¸¤ç§
Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):   <==å¯†é’¥æ–‡ä»¶é»˜è®¤å­˜æ”¾ä½ç½®ï¼ŒæŒ‰Enterå³å¯
Created directory '/root/.ssh'.
Enter passphrase (empty for no passphrase):     <== è¾“å…¥å¯†é’¥é”ç ï¼Œæˆ–ç›´æ¥æŒ‰ Enter ç•™ç©º
Enter same passphrase again:     <== å†è¾“å…¥ä¸€éå¯†é’¥é”ç 
Your identification has been saved in /root/.ssh/id_rsa.    <== ç”Ÿæˆçš„ç§é’¥
Your public key has been saved in /root/.ssh/id_rsa.pub.    <== ç”Ÿæˆçš„å…¬é’¥
The key fingerprint is:
SHA256:K1qy928tkk1FUuzQtlZK+poeS67vIgPvHw9lQ+KNuZ4 root@localhost.localdomain
The key's randomart image is:
+---[RSA 2048]----+
|           +.    |
|          o * .  |
|        . .O +   |
|       . *. *    |
|        S =+     |
|    .    =...    |
|    .oo =+o+     |
|     ==o+B*o.    |
|    oo.=EXO.     |
+----[SHA256]-----+
```

æœ€ååœ¨`.ssh`ç›®å½•ä¸‹å¾—åˆ°äº†ä¸¤ä¸ªæ–‡ä»¶ï¼š`id_rsa`ï¼ˆç§é’¥ï¼‰å’Œ`id_rsa.pub`ï¼ˆå…¬é’¥ï¼‰ï¼Œè·¯å¾„ä¸Šé¢çš„è¾“å‡ºç»“æœæœ‰ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ï¼š`cmd+R`ï¼Œè¾“å…¥ `%userprofile%`è¿›å…¥ï¼š

![image-20241226155105010](./assets/image-20241226155105010.png)

å°† `rsa.pub` ä¸­çš„å¯†é’¥å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸­ï¼ˆå¤‡ç”¨ï¼‰ï¼Œç„¶åæ‰“å¼€ Githubï¼Œè¿›å…¥è®¾ç½® ï¼ˆSettingsï¼‰ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ˆæˆ‘å¼€äº†ç¿»è¯‘æ’ä»¶ï¼‰ï¼š

![image-20241226154457244](./assets/image-20241226154457244.png)

ç„¶åå°†å…¬é’¥ç²˜è´´è¿›æ–°å»ºçš„ SSHå¯†é’¥é‡Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image-20241226155533514](./assets/image-20241226155533514.png)

æœ€åï¼Œæ‰“å¼€ Git Bashå‘½ä»¤æ§åˆ¶å°ï¼ŒéªŒè¯æ˜¯å¦è¿æ¥æˆåŠŸï¼š

```bash
ssh -T git@github.com
```

ç»“æœå¦‚ä¸‹ï¼š

```bash
$ ssh -T git@github.com
Hi xxxx! You've successfully authenticated, but GitHub does not provide shell access.
```

æ‰“å¼€ä»“åº“é¡µé¢å¤åˆ¶ä»“åº“åœ°å€ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20241226155857493](./assets/image-20241226155857493.png)

åˆ‡è®°ï¼Œä¸æ˜¯ `HTTPS` åè®®çš„åœ°å€ ï¼Œç„¶åå°†æˆ‘ä»¬çš„é¡¹ç›®æ¨é€è‡³ä»“åº“å³å¯ã€‚

## 4 ä¾èµ–ç®¡ç†

çˆ¶é¡¹ç›® `pom` ä¾èµ–ç®¡ç†ï¼Œå…·ä½“ç‰ˆæœ¬é…ç½®å¦‚ä¸‹ï¼š 

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <packaging>pom</packaging>
    <description>Tsai Spring Cloud</description>
    <groupId>tsai.spring.cloud</groupId>
    <artifactId>tsai-spring-cloud</artifactId>
    <version>1.1.0</version>

    <properties>
        <java.version>1.8</java.version>
        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
        <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
        <maven.compiler.version>3.8.1</maven.compiler.version>
        <spring-boot.version>2.7.6</spring-boot.version>
        <spring-cloud.version>2021.0.5</spring-cloud.version>
        <spring-cloud-alibaba.version>2021.0.5.0</spring-cloud-alibaba.version>
        <inject.version>1</inject.version>
    </properties>

    <modules>
        <module>spring-cloud-eureka</module>
    </modules>

    <dependencyManagement>
        <dependencies>
            <!-- spring boot -->
            <dependency>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-dependencies</artifactId>
                <version>${spring-boot.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <!--spring cloud-->
            <dependency>
                <groupId>org.springframework.cloud</groupId>
                <artifactId>spring-cloud-dependencies</artifactId>
                <version>${spring-cloud.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <!--spring cloud alibaba-->
            <dependency>
                <groupId>com.alibaba.cloud</groupId>
                <artifactId>spring-cloud-alibaba-dependencies</artifactId>
                <version>${spring-cloud-alibaba.version}</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            <!-- inject -->
            <dependency>
                <groupId>javax.inject</groupId>
                <artifactId>javax.inject</artifactId>
                <version>${inject.version}</version>
            </dependency>
        </dependencies>
    </dependencyManagement>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>${maven.compiler.version}</version>
                <configuration>
                    <source>${java.version}</source>
                    <target>${java.version}</target>
                    <encoding>${project.build.sourceEncoding}</encoding>
                    <verbose>false</verbose>
                    <showWarnings>false</showWarnings>
                    <fork>true</fork>
                    <compilerVersion>1.5</compilerVersion>
                    <meminitial>512m</meminitial>
                    <maxmem>2048m</maxmem>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>
```

æ³¨å†Œä¸­å¿ƒ `pom` ä¾èµ–é…ç½®å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
    <parent>
        <groupId>tsai.spring.cloud</groupId>
        <artifactId>tsai-spring-cloud</artifactId>
        <version>1.1.0</version>
    </parent>

    <modelVersion>4.0.0</modelVersion>
    <artifactId>spring-cloud-eureka</artifactId>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-logging</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-actuator</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <version>${spring-boot.version}</version>
                <configuration>
                    <fork>true</fork>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                    <includeSystemScope>true</includeSystemScope>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>repackage</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

</project>
```

## 5 æ³¨å†Œä¸­å¿ƒé…ç½®

æ³¨å†Œä¸­å¿ƒä¸Šä¸‹æ–‡é…ç½®å¦‚ä¸‹ï¼Œå› ä¸ºåç»­æˆ‘ä»¬éœ€è¦é€šè¿‡ docker ä¸€é”®éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œæ‰€ä»¥å‚æ•°åŠ¨æ€å¯é€‰ï¼Œå¦‚ä¸é…ç½®ï¼Œä»¥é»˜è®¤å€¼ä¸ºå‡†ï¼š

```yaml
server:
  port: ${SERVER_PORT:8761}

spring:
  application:
    name: ${APPLICATION_NAME:spring-cloud-eureka}
  # eureka ç›¸å…³é…ç½®
  security:
    user:
      name: ${EUREKA_ADMIN_NAME:eureka}
      password: ${EUREKA_ADMIN_PASSWORD:eureka}

# eureka ç›¸å…³é…ç½®
eureka:
  server:
    enable-self-preservation: true
    eviction-interval-timer-in-ms: 30000
  instance:
    hostname: ${HOSTNAME:${spring.application.name}}
    prefer-ip-address: ${PREFER_IP_ADDRESS:false}
    instance-id: ${spring.cloud.client.ip-address}:${server.port}
  client:
    fetch-registry: ${FETCH_REGISTRY:false}
    register-with-eureka: ${REGISTER_WITH_EUREKA:false}
    service-url:
      defaultZone: ${DEFAULT_ZONE:http://${spring.security.user.name}:${spring.security.user.password}@${eureka.instance.hostname}:8761/eureka/}

# actuator ç›¸å…³é…ç½®
management:
  endpoints:
    web:
      exposure:
        include: ${ENDPOINTS:info,shutdown}
  endpoint:
    shutdown:
      enabled: ${ENABLE_SHOWDOWN:false}
```

åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯ç”¨åˆ°äº†å®‰å…¨è®¤è¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ·»åŠ å®‰å…¨è®¤è¯é…ç½®ç±»ï¼Œä¸ç„¶æ³¨å†Œä¸­å¿ƒæ— æ³•æ³¨å†ŒæœåŠ¡ï¼š

```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    public void configure(HttpSecurity http) throws Exception {
        super.configure(http);
        http.csrf().ignoringAntMatchers("/eureka/**");
    }
}
```

å¼€å¯æ—¥å¿—è®°å½•ï¼Œæ·»åŠ æ—¥å¿—é…ç½®æ–‡ä»¶ `logback-spring.xml`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <!--å¼•å…¥é»˜è®¤é…ç½®-->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>
    <property scope="context" name="log.path" value="/logs/"/>
    <springProperty scope="context" name="log.name" source="spring.application.name"/>

    <!-- æ§åˆ¶å°è¾“å‡ºé…ç½® -->
    <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
        </encoder>
        <!-- åªè¾“å‡ºDEBUGçº§åˆ«åŠä»¥ä¸Šçš„æ—¥å¿— -->
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>DEBUG</level>
        </filter>
    </appender>

    <!-- æ–‡ä»¶è¾“å‡ºé…ç½® -->
    <appender name="INFO_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/${log.name}.info.log</file>
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
        </encoder>
        <!-- åªè¾“å‡ºINFOçº§åˆ«çš„æ—¥å¿— -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>INFO</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/%d{yyyy-MM-dd}/${log.name}.info.%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <!-- æ¯ä¸ªæ–‡ä»¶æœ€å¤§2MB -->
            <maxFileSize>2MB</maxFileSize>
            <!-- æœ€å¤šä¿ç•™30å¤©çš„å†å²è®°å½• -->
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>

    <!-- æ–‡ä»¶è¾“å‡ºé…ç½® -->
    <appender name="ERROR_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/${log.name}.error.log</file>
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
        </encoder>
        <!-- åªè¾“å‡ºERRORçº§åˆ«çš„æ—¥å¿— -->
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>ERROR</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/%d{yyyy-MM-dd}/${log.name}.error.%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <!-- æ¯ä¸ªæ–‡ä»¶æœ€å¤§2MB -->
            <maxFileSize>2MB</maxFileSize>
            <!-- æœ€å¤šä¿ç•™30å¤©çš„å†å²è®°å½• -->
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>

    <appender name="WARNING_FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <file>${log.path}/${log.name}.warning.log</file>
        <encoder>
            <pattern>${CONSOLE_LOG_PATTERN}</pattern>
        </encoder>
        <filter class="ch.qos.logback.classic.filter.LevelFilter">
            <level>WARN</level>
            <onMatch>ACCEPT</onMatch>
            <onMismatch>DENY</onMismatch>
        </filter>
        <rollingPolicy class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
            <fileNamePattern>${log.path}/%d{yyyy-MM-dd}/${log.name}.warning.%d{yyyy-MM-dd}-%i.log</fileNamePattern>
            <maxFileSize>2MB</maxFileSize>
            <maxHistory>30</maxHistory>
        </rollingPolicy>
    </appender>

    <root level="INFO">
        <appender-ref ref="STDOUT"/>
        <appender-ref ref="INFO_FILE"/>
        <appender-ref ref="ERROR_FILE"/>
        <appender-ref ref="WARNING_FILE"/>
    </root>
</configuration>
```

å¯åŠ¨ç±»ç¼–å†™ï¼Œè¾“å‡ºä¸€äº›å¯åŠ¨ä¿¡æ¯ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ’æŸ¥ï¼š

```java
@EnableEurekaServer
@SpringBootApplication
public class EurekaServerApplication {
    
    private static Logger logger = LoggerFactory.getLogger(EurekaServerApplication.class);

    public static void main(String[] args) {
        ApplicationContext context = SpringApplication.run(EurekaServerApplication.class, args);
        Environment environment = context.getEnvironment();
        String port = environment.getProperty("server.port");
        String fetchRegistry = environment.getProperty("eureka.client.fetch-registry");
        String registryWithEureka = environment.getProperty("eureka.client.register-with-eureka");
        String defaultZone = environment.getProperty("eureka.client.service-url.defaultZone");
        String hostname = environment.getProperty("eureka.instance.hostname");
        String preferIpAddress = environment.getProperty("eureka.instance.prefer-ip-address");
        logger.info("===================æ³¨å†Œä¸­å¿ƒè¿è¡Œç¯å¢ƒä¿¡æ¯===================");
        logger.info("æœåŠ¡ç«¯å£ï¼š{}",port);
        logger.info("å®ä¾‹åœ°å€ï¼š{}",hostname);
        logger.info("æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡ï¼š{}", fetchRegistry);
        logger.info("æ˜¯å¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š{}", registryWithEureka);
        logger.info("æ³¨å†Œä¸­å¿ƒé›†ç¾¤åœ°å€ï¼š{}", defaultZone);
        logger.info("æ˜¯å¦ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨çš„IPåœ°å€ï¼š{}", preferIpAddress);
        logger.info("=======================================================");
    }
}
```

æœ€åï¼Œå¯åŠ¨æ³¨å†Œä¸­å¿ƒæœåŠ¡ï¼Œä»¥é»˜è®¤é…ç½®å¯åŠ¨ï¼ŒéªŒè¯æœåŠ¡æ˜¯å¦å¯ç”¨å³å¯ã€‚

## 6 é›†ç¾¤éƒ¨ç½²

ç¼–å†™ `Dockerfile` æ–‡ä»¶ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š

```dockerfile
# åŸºäºjavaé•œåƒåˆ›å»ºæ–°é•œåƒ
FROM openjdk:8
# ä½œè€…
MAINTAINER caixibei
# å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸º mvn æ‰“åŒ…åçš„jaråŒ…å
# åœ¨targetç›®å½•ä¸‹æ‰¾å¾—åˆ°
ADD  target/spring-cloud-eureka-1.1.0.jar spring-cloud-eureka-1.1.0.jar
# è¿è¡ŒjaråŒ…
ENTRYPOINT ["java","-jar","/spring-cloud-eureka-1.1.0.jar","&"]

# æš´éœ²ç«¯å£
# EXPOSE 8761
```

æ‰“å¼€ IDEA è®¾ç½®ï¼Œæœç´¢ SSH ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œæ·»åŠ æˆ‘ä»¬çš„è¿œç«¯æœåŠ¡å™¨è¿æ¥é…ç½®ï¼š

![image-20241226161616345](./assets/image-20241226161616345.png)

å¡«å†™å®ŒæœåŠ¡å™¨ä¿¡æ¯ä¹‹åï¼Œç‚¹å‡»æµ‹è¯•è¿æ¥ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

![image-20241226161718325](./assets/image-20241226161718325.png)

æ¥ä¸‹æ¥éœ€è¦é…ç½®è¿æ¥Dockerå®ˆæŠ¤è¿›ç¨‹`ï¼ˆFile->Settings->æœç´¢dockerï¼‰`æ¥æ“ä½œDockerï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20241226161857209](./assets/image-20241226161857209.png)

ç„¶åæˆ‘ä»¬å°±éœ€è¦é…ç½®è¿œç¨‹éƒ¨ç½²ç¯å¢ƒäº†ï¼Œå…·ä½“æ“ä½œç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![image-20241226162003510](./assets/image-20241226162003510.png)

æ–°å»ºé…ç½®ï¼Œå› ä¸ºæˆ‘è¦éƒ¨ç½²2ä¸ªæ³¨å†Œä¸­å¿ƒï¼Œæ‰€ä»¥æˆ‘é…ç½®ä¸¤ä¸ªï¼Œè¿™æ ·åç»­å°±ä¸éœ€è¦ä¿®æ”¹å‚æ•°ã€‚

![image-20241226162139252](./assets/image-20241226162139252.png)

é…ç½®éƒ¨ç½²å‚æ•°ï¼Œè¿™ä¸ªåœ¨ä¸Šé¢çš„ä¸Šä¸‹æ–‡é…ç½®ä¸­æ‰¾å¯¹åº”çš„ é”®åï¼š

![image-20241226162619143](./assets/image-20241226162619143.png)

æœ€ç»ˆç”Ÿæˆçš„ `docker run` å‘½ä»¤å¦‚ä¸‹ï¼š

```shell
docker build -f Dockerfile \
-t spring-cloud-eureka:1.1.1 . \
&& docker run -p 8761:8761 \
--env APPLICATION_NAME=spring-cloud-eureka \
--env DEFAULT_ZONE=http://eureka:eureka@116.205.112.132:8762/eureka/ \
--env FETCH_REGISTRY=true \
--env HOSTNAME=spring-cloud-eureka-8761 \
--env REGISTER_WITH_EUREKA=true \
--env SERVER_PORT=8761 \
--env PREFER_IP_ADDRESS=true \
--name spring-cloud-eureka-8761 \
--restart always \
--net host \
spring-cloud-eureka:1.1.1 
```

æœ€ç»ˆé…ç½®ç»“æœå›¾å¦‚ä¸‹ï¼š

![image-20241226162537984](./assets/image-20241226162537984.png)

ç„¶åç‚¹å‡» éƒ¨ç½² è¿è¡Œå³å¯ï¼š

![image-20241226162926540](./assets/image-20241226162926540.png)

åœ¨æ§åˆ¶å°ä¹Ÿèƒ½çœ‹åˆ°è¿è¡Œçš„æ—¥å¿—ï¼Œååˆ†æ–¹ä¾¿ï¼š

![image-20241226163019826](./assets/image-20241226163019826.png)