<!DOCTYPE html><html><head>
      <title>05.SpringCloud Zuulå…¥é—¨æ•™ç¨‹</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\caixi\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.20\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="spring-cloud-zuul-æœåŠ¡ç½‘å…³">Spring Cloud Zuul æœåŠ¡ç½‘å…³ </h1>
<h2 id="å­¦ä¹ ç›®æ ‡">å­¦ä¹ ç›®æ ‡ </h2>
<p><img src="assets/image-20251211141511205.png" alt="image-20251211141511205"></p>
<h2 id="ä»€ä¹ˆæ˜¯-zuul">ä»€ä¹ˆæ˜¯ Zuul </h2>
<p>Zuul æ˜¯ä»è®¾å¤‡å’Œç½‘ç«™åˆ°åº”ç”¨ç¨‹åºåç«¯çš„æ‰€æœ‰è¯·æ±‚çš„å‰é—¨ã€‚ä½œä¸ºè¾¹ç¼˜æœåŠ¡åº”ç”¨ç¨‹åºï¼ŒZuul æ—¨åœ¨å®ç°åŠ¨æ€è·¯ç”±ï¼Œç›‘è§†ï¼Œå¼¹æ€§å’Œå®‰å…¨æ€§ã€‚Zuul åŒ…å«äº†å¯¹è¯·æ±‚çš„è·¯ç”±å’Œè¿‡æ»¤ä¸¤ä¸ªæœ€ä¸»è¦çš„åŠŸèƒ½ã€‚</p>
<p>Zuul æ˜¯ Netflix å¼€æºçš„å¾®æœåŠ¡ç½‘å…³ï¼Œå®ƒå¯ä»¥å’Œ Eurekaã€Ribbon ã€Hystrix ç­‰ç»„ä»¶é…åˆä½¿ç”¨ã€‚Zuul çš„æ ¸å¿ƒæ˜¯ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨ï¼Œè¿™äº›è¿‡æ»¤å™¨å¯ä»¥å®Œæˆä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>èº«ä»½è®¤è¯ä¸å®‰å…¨ï¼šè¯†åˆ«æ¯ä¸ªèµ„æºçš„éªŒè¯è¦æ±‚ï¼Œå¹¶æ‹’ç»é‚£äº›ä¸è¦æ±‚ä¸ç¬¦çš„è¯·æ±‚ï¼›</li>
<li>å®¡æŸ¥ä¸ç›‘æ§ï¼šåœ¨è¾¹ç¼˜ä½ç½®è¿½è¸ªæœ‰æ„ä¹‰çš„æ•°æ®å’Œç»Ÿè®¡ç»“æœï¼Œä»è€Œå¸¦æ¥ç²¾ç¡®çš„ç”Ÿäº§è¯•å›¾ï¼›</li>
<li>åŠ¨æ€è·¯ç”±ï¼šåŠ¨æ€çš„å°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒçš„åç«¯é›†ç¾¤ï¼›</li>
<li>å‹åŠ›æµ‹è¯•ï¼šé€æ¸å¢åŠ æŒ‡å‘é›†ç¾¤çš„æµé‡ï¼Œä»¥äº†è§£æ€§èƒ½ï¼›</li>
<li>è´Ÿè½½åˆ†é…ï¼šä¸ºæ¯ä¸€ç§è´Ÿè½½ç±»å‹åˆ†é…å¯¹åº”å®¹é‡ï¼Œå¹¶å¼ƒç”¨è¶…å‡ºé™å®šå€¼çš„è¯·æ±‚ï¼›</li>
<li>é™æ€å“åº”å¤„ç†ï¼šåœ¨è¾¹ç¼˜ä½ç½®ç›´æ¥å»ºç«‹éƒ¨åˆ†å“åº”ï¼Œä»è€Œé¿å…è½¬å‘åˆ°å†…éƒ¨é›†ç¾¤ï¼›</li>
<li>å¤šåŒºåŸŸå¼¹æ€§ï¼šè·¨è¶Š AWS Region è¿›è¡Œè¯·æ±‚è·¯ç”±ï¼Œæ—¨åœ¨å®ç° ELB ä½¿ç”¨çš„å¤šæ ·åŒ–ï¼Œä»¥åŠè®©ç³»ç»Ÿçš„è¾¹ç¼˜æ›´è´´è¿‘ç³»ç»Ÿçš„ä½¿ç”¨è€…ï¼›</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³">ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³ </h2>
<p>API Gateway ï¼ˆAPIGW / API ç½‘å…³ï¼‰ï¼Œæ•…åæ€ä¹‰ï¼Œæ˜¯å‡ºç°åœ¨ç³»ç»Ÿè¾¹ç•Œå±±æ­Œçš„ä¸€ä¸ªé¢å‘ API çš„ã€ä¸²è¡Œé›†ä¸­å¼çš„å¼ºç®¡æ§æœåŠ¡ï¼Œè¿™é‡Œçš„è¾¹ç•Œæ˜¯ä¼ä¸š IT ç³»ç»Ÿçš„è¾¹ç•Œï¼Œå¯ä»¥ç†è§£ä¸ºä¼ä¸šçº§åº”ç”¨é˜²ç«å¢™ï¼Œä¸»è¦èµ·åˆ°éš”ç¦»å¤–éƒ¨è®¿é—®ä¸å†…éƒ¨ç³»ç»Ÿçš„ä½œç”¨ã€‚åœ¨å¾®æœåŠ¡æ¦‚å¿µçš„æµè¡Œä¹‹å‰ï¼ŒAPI ç½‘å…³å°±å·²ç»è¯ç”Ÿäº†ï¼Œä¾‹å¦‚é“¶è¡Œã€è¯åˆ¸ç­‰é¢†åŸŸå¸¸è§çš„å‰ç½®æœºç³»ç»Ÿï¼Œä¹Ÿæ˜¯è§£å†³è®¿é—®è®¤è¯ã€æŠ¥æ–‡è½¬æ¢ã€è®¿é—®ç»Ÿè®¡ç­‰é—®é¢˜çš„ã€‚</p>
<p>API ç½‘å…³çš„æµè¡Œï¼Œæºäºè¿‘å‡ å¹´æ¥ç§»åŠ¨åº”ç”¨ä¸ä¼ä¸šé—´äº’è”ç½‘éœ€æ±‚çš„å…´èµ·ã€‚ç§»åŠ¨åº”ç”¨ã€ä¼ä¸šäº’è”ï¼Œä½¿å¾—åå°æœåŠ¡æ”¯æŒçš„å¯¹è±¡ï¼Œä»ä»¥å‰å•ä¸€çš„ Web åº”ç”¨ï¼Œæ‰©å±•åˆ°å¤šç§åº”ç”¨åœºæ™¯ï¼Œä¸”æ¯ç§ä½¿ç”¨åœºæ™¯å¯¹åå°æœåŠ¡çš„è¦æ±‚éƒ½ä¸å°½ç›¸åŒã€‚è¿™ä¸ä»…å¢åŠ äº†åå°æœåŠ¡çš„å“åº”é‡ï¼Œè¿˜å¢åŠ äº†åå°æœåŠ¡çš„å¤æ‚æ€§ã€‚éšç€å¾®æœåŠ¡æ¶æ„æ¦‚å¿µçš„æå‡ºï¼ŒAPI ç½‘å…³æˆä¸ºäº†å¾®æœåŠ¡æ¶æ„çš„ä¸€ä¸ªæ ‡é…ç»„ä»¶ã€‚</p>
<p>API ç½‘å…³æ˜¯ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯ç³»ç»Ÿå¯¹å¤–çš„å”¯ä¸€å…¥å£ã€‚API ç½‘å…³å°è£…äº†ç³»ç»Ÿå†…éƒ¨æ¶æ„ï¼Œä¸ºæ¯ä¸ªå®¢æˆ·ç«¯æä¾›å®šåˆ¶çš„ API ã€‚æ‰€æœ‰çš„å®¢æˆ·ç«¯å’Œæ¶ˆè´¹ç«¯éƒ½é€šè¿‡ç»Ÿä¸€çš„ç½‘å…³æ¥å…¥å¾®æœåŠ¡ï¼Œåœ¨ç½‘å…³å±‚å¤„ç†æ‰€æœ‰çš„éä¸šåŠ¡åŠŸèƒ½ã€‚API ç½‘å…³å¹¶ä¸æ˜¯å¾®æœåŠ¡åœºæ™¯ä¸­å¿…é¡»çš„ç»„ä»¶ï¼Œå¦‚ä¸‹å›¾ï¼Œä¸ç®¡æœ‰æ²¡æœ‰ API ç½‘å…³ï¼Œåç«¯å¾®æœåŠ¡éƒ½å¯ä»¥é€šè¿‡ API å¾ˆå¥½çš„æ”¯æŒå®¢æˆ·ç«¯çš„è®¿é—®ã€‚</p>
<img src="assets/image-20251220154549792.png" alt="image-20251220154549792" style="zoom:67%;">
<p>ä½†å¯¹äºæœåŠ¡æ•°é‡ä¼—å¤šï¼Œå¤æ‚åº¦è¾ƒé«˜ï¼Œè§„æ¨¡æ¯”è¾ƒå¤§çš„ä¸šåŠ¡æ¥è¯´ï¼Œå¼•å…¥ API ç½‘å…³ä¹Ÿæœ‰ä¸€ç³»åˆ—çš„å¥½å¤„ï¼š</p>
<ul>
<li>èšåˆæ¥å£ä½¿å¾—æœåŠ¡å¯¹è°ƒç”¨è€…é€æ˜ï¼Œå®¢æˆ·ç«¯ä¸åç«¯çš„è€¦åˆåº¦é™ä½ï¼›</li>
<li>èšåˆåå°æœåŠ¡ï¼ŒèŠ‚çœæµé‡ï¼Œæé«˜æ€§èƒ½ï¼Œä»¥æå‡ç”¨æˆ·ä½“éªŒï¼›</li>
<li>æä¾›å®‰å…¨ã€æµæ§ã€è¿‡æ»¤ã€ç¼“å­˜ã€è®¡è´¹ã€ç›‘æ§ç­‰ API ç®¡ç†åŠŸèƒ½ï¼›</li>
</ul>
<h2 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç½‘å…³">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç½‘å…³ </h2>
<p>Zuul æ˜¯ Netflix å¼€æºçš„ API ç½‘å…³ï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª <strong>åå‘ä»£ç† + è¿‡æ»¤å™¨é“¾</strong> çš„æ¶æ„æ¨¡å¼ã€‚å®ƒåœ¨ä¸åŒæ¶æ„ä¸­çš„ä»·å€¼ä½“ç°æœ‰æ˜¾è‘—å·®å¼‚ã€‚</p>
<ul>
<li>å•ä½“åº”ç”¨ï¼šæµè§ˆå™¨å‘èµ·è¯·æ±‚åˆ°å•ä½“åº”ç”¨æ‰€åœ¨çš„æœºå™¨ï¼Œåº”ç”¨ä»æ•°æ®åº“æŸ¥è¯¢æ•°æ®åŸè·¯è¿”å›ç»™æµè§ˆå™¨ï¼Œå¯¹äºå•ä½“åº”ç”¨æ¥è¯´æ˜¯ä¸éœ€è¦ç½‘å…³çš„ã€‚</li>
<li>å¾®æœåŠ¡ï¼šå¾®æœåŠ¡çš„åº”ç”¨å¯èƒ½éƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿ï¼Œä¸åŒåœ°åŒºï¼Œä¸åŒåŸŸåä¸‹ã€‚æ­¤æ—¶å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨/æ‰‹æœº/è½¯ä»¶å·¥å…·ï¼‰æƒ³è¦è¯·æ±‚å¯¹åº”çš„æœåŠ¡ï¼Œéƒ½éœ€è¦çŸ¥é“æœºå™¨çš„å…·ä½“ IP åœ°å€ æˆ–è€…åŸŸå URLï¼Œå½“å¾®æœåŠ¡å®ä¾‹ä¼—å¤šçš„æ—¶å€™ï¼Œè¿™æ˜¯ååˆ†éš¾ä»¥è®°å¿†çš„ï¼Œå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ä¹Ÿå¤ªå¤æ‚éš¾ä»¥ç»´æŠ¤ã€‚æ­¤æ—¶å°±æœ‰äº†ç½‘å…³ï¼Œå®¢æˆ·ç«¯ç›¸å…³çš„è¯·æ±‚ç›´æ¥å‘é€åˆ°ç½‘å…³ï¼Œç”±ç½‘å…³æ ¹æ®è¯·æ±‚æ ‡è¯†è§£æåˆ¤æ–­å‡ºå…·ä½“çš„å¾®æœåŠ¡åœ°å€ï¼Œå†æŠŠè¯·æ±‚è½¬å‘åˆ°å¾®æœåŠ¡å®ä¾‹ã€‚è¿™å…¶ä¸­çš„è®°å¿†åŠŸèƒ½å°±å…¨éƒ¨äº¤ç»™ç½‘å…³å»æ“ä½œäº†ã€‚</li>
</ul>
<img src="assets/image-20251220164718340.png" alt="image-20251220164718340" style="zoom:67%;">
<p>æ€»çš„æ¥è¯´ï¼Œå¦‚æœè®©å®¢æˆ·ç«¯ç›´æ¥ä¸å„å¾®æœåŠ¡äº¤äº’ï¼Œä¼šå¸¦æ¥ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ä¼šå¤šæ¬¡è¯·æ±‚ä¸åŒçš„å¾®æœåŠ¡ï¼Œå¢åŠ äº†å®¢æˆ·ç«¯çš„å¤æ‚æ€§ï¼›</li>
<li>å­˜åœ¨è·¨åŸŸè¯·æ±‚é—®é¢˜ï¼Œä¸”åœ¨æŸäº›åœºæ™¯ä¸‹å¤„ç†ç›¸å¯¹å¤æ‚ï¼›</li>
<li>èº«ä»½è®¤è¯é—®é¢˜ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½éœ€è¦ç‹¬ç«‹çš„èº«ä»½è®¤è¯ï¼›</li>
<li>éš¾ä»¥é‡æ„ï¼Œéšç€é¡¹ç›®çš„è¿­ä»£ï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ’åˆ†å¾®æœåŠ¡ï¼›</li>
<li>æŸäº›å¾®æœåŠ¡å¯èƒ½ä½¿ç”¨äº†é˜²ç«å¢™/æµè§ˆå™¨ä¸å‹å¥½çš„åè®®ï¼Œç›´æ¥è®¿é—®å­˜åœ¨ä¸€å®šçš„å›°éš¾ï¼›</li>
</ul>
<p>å› æ­¤ï¼Œä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç½‘å…³ä»‹äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚ç‡å…ˆç»è¿‡å¾®æœåŠ¡ç½‘å…³ï¼Œå®¢æˆ·ç«¯åªéœ€è¦ä¸ç½‘å…³è¿›è¡Œäº¤äº’ï¼Œåªéœ€è¦ç½‘å…³åœ°å€å³å¯ï¼Œè¿™æ ·ä¾¿ç®€åŒ–äº†å¼€å‘ä¸”æœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚</p>
<ul>
<li>æ˜“äºç›‘æ§ï¼Œå¯åœ¨å¾®æœåŠ¡ç½‘å…³æ”¶é›†ç›‘æ§æ•°æ®å¹¶å°†å…¶æ¨é€åˆ°å¤–éƒ¨ç³»ç»Ÿè¿›è¡Œåˆ†æï¼›</li>
<li>æ˜“äºè®¤è¯ï¼Œå¯åœ¨å¾®æœåŠ¡ç½‘å…³ä¸Šè¿›è¡Œè®¤è¯ï¼Œç„¶åå†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯çš„å¾®æœåŠ¡ï¼Œä»è€Œæ— éœ€åœ¨æ¯ä¸ªå¾®æœåŠ¡ä¸­è¿›è¡Œè®¤è¯ï¼›</li>
<li>å‡å°‘äº†å®¢æˆ·ç«¯ä¸å„å¾®æœåŠ¡ä¹‹é—´çš„äº¤äº’æ¬¡æ•°ï¼›</li>
</ul>
<h2 id="ç½‘å…³è§£å†³äº†ä»€ä¹ˆé—®é¢˜">ç½‘å…³è§£å†³äº†ä»€ä¹ˆé—®é¢˜ </h2>
<img src="assets/image-20251220172914409.png" alt="image-20251220172914409" style="zoom:67%;">
<p>ç½‘å…³å…·æœ‰èº«ä»½è®¤è¯ä¸å®‰å…¨ã€å®¡æŸ¥ä¸ç›‘æ§ã€åŠ¨æ€è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€ç¼“å­˜ã€è¯·æ±‚åˆ†ç‰‡ä¸ç®¡ç†ã€é™æ€å“åº”å¤„ç†ç­‰åŠŸèƒ½ã€‚å½“ç„¶æœ€ä¸»è¦çš„èŒè´£è¿˜æ˜¯ â€œä¸å¤–ç•Œè”ç³»â€ã€‚</p>
<p>æ€»ç»“æ¥è¯´ï¼Œç½‘å…³åº”è¯¥å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>æ€§èƒ½ï¼šAPI é«˜å¯ç”¨ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®¹é”™æœºåˆ¶ï¼›</li>
<li>å®‰å…¨ï¼šæƒé™èº«ä»½è®¤è¯ã€è„±æ•ã€æµé‡æ¸…æ´—ã€åç«¯ç­¾åï¼ˆä¿è¯å…¨é“¾è·¯å¯ä¿¡è°ƒç”¨ï¼‰ã€é»‘åå•ï¼ˆéæ³•è°ƒç”¨é™åˆ¶ï¼‰ï¼›</li>
<li>æ—¥å¿—ï¼šæ—¥å¿—è®°å½•ï¼Œä¸€æ—¦è®¾è®¡åˆ†å¸ƒå¼ï¼Œå…¨é“¾è·¯è·Ÿè¸ªå¿…ä¸å¯å°‘ï¼›</li>
<li>ç¼“å­˜ï¼šæ•°æ®ç¼“å­˜ï¼›</li>
<li>ç›‘æ§ï¼šè®°å½•è¯·æ±‚å“åº”æ•°æ®ï¼ŒAPI è€—æ—¶åˆ†æï¼Œæ€§èƒ½ç›‘æ§ï¼›</li>
<li>é™æµï¼šæµé‡æ§åˆ¶ã€é”™å³°æµæ§ï¼Œå¯ä»¥å®šä¹‰å¤šç§é™æµè§„åˆ™ï¼›</li>
<li>ç°åº¦ï¼šçº¿ä¸Šç°åº¦éƒ¨ç½²ï¼Œå¯ä»¥å‡å°‘é£é™©ï¼›</li>
<li>è·¯ç”±ï¼šåŠ¨æ€è·¯ç”±è§„åˆ™ï¼›</li>
</ul>
<h2 id="å¸¸ç”¨ç½‘å…³è§£å†³æ–¹æ¡ˆ">å¸¸ç”¨ç½‘å…³è§£å†³æ–¹æ¡ˆ </h2>
<h3 id="nginx--luaè„šæœ¬">Nginx + Luaè„šæœ¬ </h3>
<p>Nginx æ˜¯ç”± IgorSysoev ä¸ºä¿„ç½—æ–¯è®¿é—®é‡ç¬¬äºŒçš„ <a href="http://Rmbler.ru">Rmbler.ru</a> ç«™ç‚¹å¼€å‘çš„ï¼Œä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¸€æ–¹é¢å¯ä»¥åšåå‘ä»£ç†ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥åšé™æ€èµ„æºæœåŠ¡å™¨ã€‚</p>
<p>ğŸ¯ Nginx å’Œ Zuul æœ‰ä»¥ä¸‹å‡ ä¸ªåŒºåˆ«ï¼š</p>
<ul>
<li>
<p>Nginx æ˜¯ C è¯­è¨€å¼€å‘çš„ï¼Œè€Œ Zuul æ˜¯ Java è¯­è¨€å¼€å‘ï¼›</p>
</li>
<li>
<p>Nginx è´Ÿè½½å‡è¡¡å®ç°æ˜¯é‡‡ç”¨æœåŠ¡å™¨å®ç°è´Ÿè½½å‡è¡¡ï¼Œè€Œ Zuul è´Ÿè½½å‡è¡¡çš„å®ç°é‡‡ç”¨ Ribbon + Eureka æ¥å®ç°æœ¬åœ°è´Ÿè½½å‡è¡¡ï¼›</p>
</li>
<li>
<p>Nginx é€‚åˆäºæœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ï¼ŒZuul é€‚åˆå¾®æœåŠ¡ä¸­å®ç°ç½‘å…³ï¼›</p>
</li>
<li>
<p>Nginx ç›¸æ¯”äº Zuul åŠŸèƒ½ä¼šæ›´åŠ å¼ºå¤§ï¼Œå› ä¸º Nginx å¯ä»¥æ•´åˆä¸€äº›è„šæœ¬è¯­è¨€ï¼ˆNginx + Lua è„šæœ¬ï¼‰ï¼›</p>
</li>
<li>
<p>Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª IMAP / POP3 / SMIP æœåŠ¡å™¨ã€‚Zuul æ˜¯ Spring Cloud Netflix ä¸­çš„å¼€æºçš„ä¸€ä¸ª API Gateway æœåŠ¡å™¨ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Servlet åº”ç”¨ï¼Œæä¾›äº†åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ã€å®‰å…¨ç­‰è¾¹ç¼˜æœåŠ¡çš„æ¡†æ¶ã€‚Zuul ç›¸å½“äºæ˜¯ä»è®¾å¤‡åˆ°ç½‘ç«™åº”ç”¨ç¨‹åºåç«¯çš„æ‰€æœ‰è¯·æ±‚çš„å‰é—¨ã€‚</p>
</li>
<li>
<p>Nginx é€‚åˆåšé—¨æˆ·ç½‘å…³ï¼Œæ˜¯ä½œä¸ºæ•´ä¸ªå…¨å±€çš„ç½‘å…³ï¼Œå¯¹å¤–çš„å¤„äºæœ€å¤–å±‚çš„é‚£ç§ï¼›è€Œ Zuul å±äºä¸šåŠ¡ç½‘å…³ï¼Œä¸»è¦ç”¨æ¥å¯¹åº”ä¸åŒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œç”¨äºèšåˆä¸šåŠ¡ã€‚å„å¾®æœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼ŒèŒè´£å•ä¸€ï¼Œå¯¹å¤–æä¾›æœåŠ¡çš„æ—¶å€™éœ€è¦æœ‰ä¸€ä¸ªä¸œè¥¿å°†ä¸šåŠ¡èšåˆèµ·æ¥ï¼›</p>
</li>
<li>
<p>Zuul å¯ä»¥å®ç°ç†”æ–­ã€é‡è¯•ç­‰åŠŸèƒ½ï¼Œè¿™æ˜¯ Nginx ä¸å…·å¤‡çš„ã€‚</p>
</li>
</ul>
<h3 id="kong">Kong </h3>
<p>Kong æ˜¯ Mashape æä¾›çš„ä¸€æ¬¾ API ç®¡ç†è½¯ä»¶ï¼Œæœ¬èº«æ˜¯åŸºäº Nginx + Lua çš„ï¼Œä½†æ¯” Nginx æä¾›äº†æ›´ä¸ºç®€å•çš„é…ç½®æ–¹å¼ï¼Œæ•°æ®é‡‡ç”¨äº† ApacheCassandra / PostgreSQL å­˜å‚¨ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›ä¼˜ç§€çš„æ’ä»¶ï¼Œæ¯”å¦‚éªŒè¯ï¼Œæ—¥å¿—ï¼Œè°ƒç”¨é¢‘æ¬¡é™åˆ¶ç­‰ã€‚Kong éå¸¸è¯±äººçš„åœ°æ–¹å°±æ˜¯æä¾›äº†å¤§é‡çš„æ’ä»¶æ¥æ‰©å±•åº”ç”¨ï¼Œé€šè¿‡è®¾ç½®ä¸åŒçš„æ’ä»¶å¯ä»¥ä¸ºæœåŠ¡æä¾›å„ç§å¢å¼ºçš„åŠŸèƒ½ã€‚</p>
<p>ğŸ¯ å…·å¤‡ä»¥ä¸‹ä¼˜ç¼ºç‚¹ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šåŸºäº Nginx æ‰€ä»¥åœ¨æ€§èƒ½å’Œç¨³å®šæ€§æ–¹é¢ä¸ä¼šæœ‰é—®é¢˜ã€‚Kong ä½œä¸ºä¸€æ¬¾å•†ä¸šè½¯ä»¶ï¼Œåœ¨ Nginx ä¸Šåšäº†å¾ˆå¤šçš„æ‰©å±•æ€§å·¥ä½œï¼Œå¹¶ä¸”è¿˜æœ‰å¾ˆå¤šä»˜è´¹ä½¿ç”¨çš„å•†ä¸šæ’ä»¶ã€‚Kong æœ¬èº«ä¹Ÿæœ‰ä»˜è´¹çš„ä¼ä¸šç‰ˆï¼Œå…¶ä¸­åŒ…æ‹¬æŠ€æœ¯æ”¯æŒã€ä½¿ç”¨åŸ¹è®­æœåŠ¡ä»¥åŠ API åˆ†ææ’ä»¶ã€‚</li>
<li>ç¼ºç‚¹ï¼šå¦‚æœä½ ä½¿ç”¨ Spring Cloud , Kong å¦‚ä½•ç»“åˆç›®å‰å·²æœ‰çš„æœåŠ¡æ²»ç†ä½“ç³»ï¼Ÿ</li>
</ul>
<h3 id="traefik">Traefik </h3>
<p>Traefik æ˜¯ä¸€ä¸ªå¼€æºçš„ Go è¯­è¨€å¼€å‘çš„ï¼Œä¸ºäº†è®©å¾®æœåŠ¡éƒ¨ç½²æ›´åŠ ä¾¿æ·è€Œè¯ç”Ÿçš„ç°ä»£ HTTP åå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡å·¥å…·ã€‚å®ƒæ”¯æŒå¤šç§åå°ï¼ˆDockerã€Swarmã€Kubernatesã€Marathonã€Mesosã€Consulã€Etcdã€Zookeeperã€BoltDBã€Rest API ç­‰ï¼‰æ¥è‡ªåŠ¨åŒ–ã€åŠ¨æ€çš„åº”ç”¨ä»–çš„é…ç½®æ–‡ä»¶è®¾ç½®ï¼ŒTraefik æ‹¥æœ‰ä¸€ä¸ªåŸºäº AngularJS ç¼–å†™çš„ç®€å•ç½‘ç«™ç•Œé¢ï¼Œæ”¯æŒ RestAPIï¼Œé…ç½®æ–‡ä»¶çƒ­æ›´æ–°ï¼Œæ— éœ€é‡å¯è¿›ç¨‹ã€‚é«˜å¯ç”¨é›†ç¾¤æ¨¡å¼ç­‰ã€‚</p>
<p>ğŸ¯ ç›¸æ¯” Spring Cloud å’Œ Kubernetes è€Œè¨€ï¼Œç›®å‰æ¯”è¾ƒé€‚åˆ Kubernetes ã€‚</p>
<h3 id="springcloud-netflix-zuul">SpringCloud Netflix Zuul </h3>
<p>Zuul æ˜¯Netflix å…¬å¸å¼€æºçš„ä¸€ä¸ª API ç½‘å…³ç»„ä»¶ï¼ŒSpring Cloud å¯¹å…¶è¿›è¡ŒäºŒæ¬¡åŸºäº Spring Boot çš„æ³¨è§£å¼å°è£…åšåˆ°å¼€ç®±å³ç”¨ã€‚ç›®å‰æ¥è¯´ï¼Œç»“åˆ Spring Cloud æä¾›çš„æœåŠ¡æ²»ç†ä½“ç³»ï¼Œå¯ä»¥åšåˆ°è¯·æ±‚è½¬å‘ï¼Œæ ¹æ®é…ç½®æˆ–è€…é»˜è®¤çš„è·¯ç”±è§„åˆ™è¿›è¡Œè·¯ç”±å’Œè´Ÿè½½å‡è¡¡ï¼Œæ— ç¼é›†æˆ Hystrix ã€‚</p>
<p>è™½ç„¶å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Filter è¿‡æ»¤å™¨å®ç°æˆ‘ä»¬æƒ³è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”±äº Zuul æœ¬èº«çš„æ¶‰åŠæ˜¯åŸºäº å•çº¿ç¨‹çš„æ¥æ”¶è¯·æ±‚å’Œè½¬å‘å¤„ç†ï¼Œæ˜¯é˜»å¡ IOï¼Œä¸æ”¯æŒé•¿è¿æ¥ã€‚ç›®å‰æ¥çœ‹ Zuul å°±æ˜¾å¾—å¾ˆé¸¡è‚‹ï¼Œéšç€ Zuul 2.x ç‰ˆæœ¬ä¸€è‡´è·³ç¥¨ ï¼ˆ2019å¹´5æœˆå‘å¸ƒäº† Zuul 2.0 ç‰ˆæœ¬ï¼‰ï¼ŒSpring Cloud ä¸ºäº†ä¿é™©èµ·è§ï¼Œæ¨å‡ºäº†è‡ªå·±çš„ Spring Cloud Gatewayã€‚</p>
<p><span style="color:darkgrey;font-size:12px;">å¤§æ„å°±æ˜¯ï¼šZuul å·²æ­»ï¼ŒSpring Cloud Gateway æ°¸ç”Ÿï¼ğŸ¶</span></p>
<h4 id="zuul-10">Zuul 1.0 </h4>
<img src="./assets/image-20241210234005117.png" alt="æ¶æ„å›¾" style="zoom: 67%;">
<img src="./assets/image-20241210234107613.png" alt="æ ¸å¿ƒç±»å›¾" style="zoom: 67%;">
<img src="./assets/image-20241210234215051.png" alt="æ¨¡å‹" style="zoom:95%;">
<h4 id="zuul-20">Zuul 2.0 </h4>
<p><img src="./assets/image-20241210234349976.png" alt="image-20241210234349976"></p>
<h3 id="springcloud-gateway">SpringCloud Gateway </h3>
<p>Spring Cloud Gateway çš„å·¥ä½œåŸç†ï¼š</p>
<p><img src="./assets/image-20241210234610441.png" alt="image-20241210234610441"></p>
<p>å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚å¦‚æœç½‘å…³å¤„ç†ç¨‹åºæ˜ å°„ç¡®å®šè¯·æ±‚ä¸è·¯ç”±åŒ¹é…ï¼Œåˆ™ä¼šå°†å…¶å‘é€åˆ°ç½‘å…³ Web å¤„ç†ç¨‹åºã€‚æ­¤å¤„ç†ç¨‹åºé€šè¿‡ç‰¹å®šäºè¯·æ±‚çš„ç­›é€‰æ¡ä»¶é“¾è¿è¡Œè¯·æ±‚ã€‚è¿‡æ»¤å™¨è¢«è™šçº¿åˆ’åˆ†çš„åŸå› æ˜¯ filter å¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰å’Œä¹‹åè¿è¡Œ logicã€‚æ‰§è¡Œæ‰€æœ‰ â€œpreâ€ filter logicã€‚ç„¶åå‘å‡ºä»£ç†è¯·æ±‚ã€‚å‘å‡ºä»£ç†è¯·æ±‚åï¼Œå°†è¿è¡Œ â€œpostâ€ ç­›é€‰æ¡ä»¶é€»è¾‘ã€‚</p>
<h2 id="zuul-ç¯å¢ƒå‡†å¤‡">Zuul ç¯å¢ƒå‡†å¤‡ </h2>
<p>æˆ‘ä»¬æ–°å»ºä¸€ä¸ªå¾®æœåŠ¡çš„é¡¹ç›®ï¼Œé¡¹ç›®ç»“æ„å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="assets/image-20251220195034652.png" alt="image-20251220195034652"></p>
<ul>
<li>Eureka æ³¨å†Œä¸­å¿ƒï¼šæä¾›æœåŠ¡å‘ç°å’Œæ³¨å†ŒåŠŸèƒ½ï¼›</li>
<li>Zuul ç½‘å…³ï¼šæä¾›åŠ¨æ€è·¯ç”±åŠŸèƒ½ï¼›</li>
<li>æ¨¡å— Aï¼šæµ‹è¯•æœåŠ¡ï¼›</li>
<li>æ¨¡å— Bï¼šæµ‹è¯•æœåŠ¡ï¼›</li>
</ul>
<p><img src="assets/image-20251220232439113.png" alt="image-20251220232439113"></p>
<h2 id="nginx-å®ç°-api-ç½‘å…³">Nginx å®ç° API ç½‘å…³ </h2>
<img src="assets/image-20251221004038830.png" alt="image-20251221004038830" style="zoom: 35%;">
<p>åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬å·²ç»è¯¦ç»†çš„è®²è§£äº† Nginx å…³äºåå‘ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰åŠŸèƒ½çš„ä½¿ç”¨ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ä¸»è¦é€šè¿‡ Nginx æ¥å®ç° API ç½‘å…³æ–¹ä¾¿å¤§å®¶æ›´å¥½çš„å­¦ä¹ å’Œç†è§£ Zuul çš„ä½¿ç”¨ã€‚</p>
<h3 id="ä¸‹è½½å®‰è£…">ä¸‹è½½å®‰è£… </h3>
<p>åœ¨è¿™ä¹‹å‰æˆ‘ä»¬éœ€è¦å‰å¾€ <a href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a> ä¸‹è½½ Nginx æœåŠ¡å™¨è½¯ä»¶ï¼š</p>
<p><img src="./assets/image-20241211154334985.png" alt="image-20241211154334985"></p>
<p>ä¸‹è½½å®Œæˆåè§£å‹åˆ°æŒ‡å®šè·¯å¾„ä¸‹ <span style="color:#ff6e00;">ï¼ˆä¸è¦æ”¾ä¸­æ–‡è·¯å¾„ä¸‹ï¼ï¼ï¼ï¼‰</span>ï¼š</p>
<img src="./assets/image-20241211154456228.png" alt="image-20241211154456228" style="zoom:95%;">
<p>åŒå‡»å¯åŠ¨  <code>nginx.exe</code>  ç¨‹åºï¼Œç„¶åè®¿é—® <a href="http://127.0.0.1:80/">http://127.0.0.1:80/</a> ï¼Œå¦‚æœå¯åŠ¨æˆåŠŸï¼Œé¡µé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="./assets/image-20241211154724058.png" alt="image-20241211154724058"></p>
<p>æ‰“å¼€é…ç½®æ–‡ä»¶  <code>conf\nginx.conf</code>  ï¼Œé»˜è®¤é…ç½®å¦‚ä¸‹ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>
events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
    	<span class="token comment"># ç›‘å¬ç«¯å£ 80</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        
        <span class="token comment"># èµ„æºè·¯å¾„</span>
        location / <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="é…ç½®è·¯ç”±è§„åˆ™">é…ç½®è·¯ç”±è§„åˆ™ </h3>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>
events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
    	<span class="token comment"># ç›‘å¬ç«¯å£ 80</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        
        <span class="token comment"># èµ„æºè·¯å¾„</span>
        location / <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
            index  index.html index.htm<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment"># è·¯ç”±åˆ° autumnnook-system æ¨¡å—</span>
        location /system/ <span class="token punctuation">{</span>
        	proxy_pass http://127.0.0.1:18080/<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment"># è·¯ç”±åˆ° autumnnook-menu æ¨¡å—</span>
        location /menu/ <span class="token punctuation">{</span>
        	proxy_pass http://127.0.0.1:18081/<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>æˆ‘ä»¬æ¥çœ‹ä¸‹ Eureka ä¸­æ³¨å†Œçš„æœåŠ¡åˆ—è¡¨ï¼Œå½“æˆ‘ä»¬è®¿é—®  <code>/system</code>  çš„æ—¶å€™ï¼Œå°±å°†å®ƒè·¯ç”±åˆ°  <code>http://127.0.0.1/18080/</code> ã€‚åŒæ ·çš„ï¼Œå½“æˆ‘ä»¬è®¿é—®  <code>/menu</code> çš„æ—¶å€™ï¼Œè·¯ç”±åˆ°  <code>http://127.0.0.1:18081/</code> ã€‚</p>
<p><img src="assets/image-20251221003503166.png" alt="image-20251221003503166"></p>
<p>åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸­å…³é—­ Nginx è¿›ç¨‹åå†æ¬¡é‡å¯ï¼Œä»¥è®©é…ç½®æ–‡ä»¶ç”Ÿæ•ˆåï¼Œè®¿é—® <a href="http://127.0.0.1/system/test/info">http://127.0.0.1/system/test/info</a> ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼ŒæˆåŠŸè®¿é—® system æ¨¡å—çš„æœåŠ¡ï¼Œè¯´æ˜è·¯ç”±è½¬å‘æˆåŠŸäº†ã€‚</p>
<p><img src="assets/image-20251221003834009.png" alt="image-20251221003834009"></p>
<h2 id="zuul-å®ç°-api-ç½‘å…³å…¥é—¨æ¡ˆä¾‹">Zuul å®ç° API ç½‘å…³å…¥é—¨æ¡ˆä¾‹ </h2>
<h3 id="æ­å»ºç½‘å…³æœåŠ¡">æ­å»ºç½‘å…³æœåŠ¡ </h3>
<h4 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›® </h4>
<p>åˆ›å»º <code>autumnnook-zuul  </code>é¡¹ç›®æ¨¡å—</p>
<p><img src="assets/image-20251221005040072.png" alt="image-20251221005040072"></p>
<h4 id="æ·»åŠ é¡¹ç›®ä¾èµ–">æ·»åŠ é¡¹ç›®ä¾èµ– </h4>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--...å…¶ä»–ä¾èµ–é…ç½®ä¸åšå±•ç¤º--&gt;</span>
</code></pre><h4 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶ </h4>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token comment"># Zuul ç½‘å…³åº”ç”¨é…ç½®æ–‡ä»¶</span>
<span class="token comment">#</span>
<span class="token comment"># è¯¥é…ç½®æ–‡ä»¶å®šä¹‰äº† Zuul API ç½‘å…³çš„æ ¸å¿ƒé…ç½®ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨è®¾ç½®ã€Spring åº”ç”¨é…ç½®ã€</span>
<span class="token comment"># Zuul ç½‘å…³ç‰¹æ€§å’Œ Eureka æœåŠ¡å‘ç°é…ç½®ã€‚</span>
<span class="token comment">#</span>
<span class="token comment"># ä¸»è¦åŠŸèƒ½ï¼š</span>
<span class="token comment"># - é…ç½®ç½‘å…³æœåŠ¡å™¨å‚æ•°å’Œæ€§èƒ½ä¼˜åŒ–</span>
<span class="token comment"># - å®šä¹‰ Zuul è·¯ç”±å’Œè´Ÿè½½å‡è¡¡è¡Œä¸º</span>
<span class="token comment"># - é…ç½®æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆEurekaï¼‰</span>
<span class="token comment"># - è®¾ç½®å¥åº·æ£€æŸ¥å’Œç›‘æ§ç«¯ç‚¹</span>
<span class="token comment">#</span>
<span class="token comment"># é€‚ç”¨åœºæ™¯ï¼š</span>
<span class="token comment"># - å¾®æœåŠ¡æ¶æ„ä¸­çš„ API ç½‘å…³</span>
<span class="token comment"># - æœåŠ¡è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</span>
<span class="token comment"># - è¯·æ±‚è¿‡æ»¤å’Œæƒé™æ§åˆ¶</span>
<span class="token comment"># - æœåŠ¡æ³¨å†Œå‘ç°å’Œå¥åº·ç›‘æ§</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># æœåŠ¡å™¨ç«¯å£é…ç½®</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SERVER_PORT<span class="token punctuation">:</span><span class="token number">30000</span><span class="token punctuation">}</span>
  <span class="token comment"># Undertow æœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–é…ç½®</span>
  <span class="token comment"># Undertow æ˜¯é«˜æ€§èƒ½çš„ NIO æœåŠ¡å™¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯</span>
  <span class="token key atrule">undertow</span><span class="token punctuation">:</span>
    <span class="token comment"># I/O çº¿ç¨‹æ•°ï¼Œè´Ÿè´£å¤„ç†éé˜»å¡ I/O æ“ä½œ</span>
    <span class="token comment"># å»ºè®®è®¾ç½®ä¸º CPU æ ¸å¿ƒæ•°çš„ 1-2 å€</span>
    <span class="token key atrule">io-threads</span><span class="token punctuation">:</span> <span class="token number">16</span>
    <span class="token comment"># å·¥ä½œçº¿ç¨‹æ•°ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘</span>
    <span class="token comment"># æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦å’Œå¹¶å‘é‡è°ƒæ•´ï¼Œé€šå¸¸è®¾ç½®ä¸º I/O çº¿ç¨‹æ•°çš„ 10-100 å€</span>
    <span class="token key atrule">worker-threads</span><span class="token punctuation">:</span> <span class="token number">1600</span>
    <span class="token comment"># æ˜¯å¦ä½¿ç”¨ç›´æ¥å†…å­˜ç¼“å†²åŒº</span>
    <span class="token comment"># true è¡¨ç¤ºä½¿ç”¨å †å¤–å†…å­˜ï¼Œå‡å°‘ GC å‹åŠ›ï¼Œæé«˜æ€§èƒ½</span>
    <span class="token key atrule">direct-buffers</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Servlet ä¸Šä¸‹æ–‡è·¯å¾„é…ç½®</span>
  <span class="token comment"># å®šä¹‰åº”ç”¨è®¿é—®çš„åŸºç¡€è·¯å¾„ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦åŒ…å«æ­¤è·¯å¾„</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># åº”ç”¨åç§°é…ç½®ï¼Œç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°</span>
  <span class="token comment"># åœ¨ Eureka ä¸­ä»¥æ­¤åç§°æ³¨å†ŒæœåŠ¡</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>APPLICATION_NAME<span class="token punctuation">:</span>autumnnook<span class="token punctuation">-</span>zuul<span class="token punctuation">}</span>
  <span class="token comment"># Spring MVC é…ç½®</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token comment"># å½“æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚å¤„ç†å™¨æ—¶æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</span>
    <span class="token comment"># true: æŠ›å‡º NoHandlerFoundExceptionï¼Œä¾¿äºç»Ÿä¸€å¼‚å¸¸å¤„ç†</span>
    <span class="token comment"># false: è¿”å›é»˜è®¤ 404 é¡µé¢</span>
    <span class="token key atrule">throw-exception-if-no-handler-found</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># é™æ€èµ„æºæ˜ å°„é…ç½®</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨é™æ€èµ„æºæ˜ å°„</span>
    <span class="token comment"># true: å¯ç”¨ï¼Œå¯ä»¥è®¿é—®é™æ€èµ„æºæ–‡ä»¶</span>
    <span class="token comment"># false: ç¦ç”¨ï¼Œé€‚ç”¨äºçº¯ API ç½‘å…³åœºæ™¯</span>
    <span class="token key atrule">add-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token comment"># Zuul ç½‘å…³æ ¸å¿ƒé…ç½®</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token comment"># ä¿¡å·é‡é…ç½®ï¼Œç”¨äºæ§åˆ¶å¹¶å‘è¯·æ±‚æ•°é‡</span>
  <span class="token key atrule">semaphore</span><span class="token punctuation">:</span>
    <span class="token comment"># æœ€å¤§ä¿¡å·é‡æ•°é‡ï¼Œé™åˆ¶åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°</span>
    <span class="token comment"># é˜²æ­¢ç½‘å…³è¢«è¿‡å¤šè¯·æ±‚å‹å®ï¼Œèµ·åˆ°ç†”æ–­ä¿æŠ¤ä½œç”¨</span>
    <span class="token key atrule">max-semaphores</span><span class="token punctuation">:</span> <span class="token number">1100</span>
  <span class="token comment"># æ•æ„Ÿè¯·æ±‚å¤´é…ç½®</span>
  <span class="token comment"># ç©ºæ•°ç»„è¡¨ç¤ºä¸è¿‡æ»¤ä»»ä½•è¯·æ±‚å¤´ï¼Œæ‰€æœ‰å¤´ä¿¡æ¯éƒ½ä¼šè½¬å‘åˆ°ä¸‹æ¸¸æœåŠ¡</span>
  <span class="token key atrule">sensitive-headers</span><span class="token punctuation">:</span>
  <span class="token comment"># æ˜¯å¦å‰¥ç¦»è·¯ç”±å‰ç¼€</span>
  <span class="token comment"># false: ä¿ç•™å®Œæ•´è·¯å¾„è½¬å‘åˆ°ä¸‹æ¸¸æœåŠ¡</span>
  <span class="token comment"># true: å»é™¤è·¯ç”±åŒ¹é…çš„å‰ç¼€éƒ¨åˆ†</span>
  <span class="token key atrule">strip-prefix</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># æ˜¯å¦æ·»åŠ  Host å¤´ä¿¡æ¯</span>
  <span class="token comment"># true: åœ¨è½¬å‘è¯·æ±‚æ—¶æ·»åŠ  Host å¤´ï¼Œä¾¿äºä¸‹æ¸¸æœåŠ¡è¯†åˆ«è¯·æ±‚æ¥æº</span>
  <span class="token key atrule">add-host-header</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># HTTP å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span>
    <span class="token comment"># æœ€å¤§æ€»è¿æ¥æ•°ï¼Œé™åˆ¶ç½‘å…³ä¸æ‰€æœ‰ä¸‹æ¸¸æœåŠ¡çš„æ€»è¿æ¥æ•°</span>
    <span class="token key atrule">maxTotalConnections</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token comment"># æ¯ä¸ªè·¯ç”±çš„æœ€å¤§è¿æ¥æ•°ï¼Œé™åˆ¶åˆ°å•ä¸ªæœåŠ¡çš„æœ€å¤§è¿æ¥æ•°</span>
    <span class="token key atrule">maxPerRouteConnections</span><span class="token punctuation">:</span> <span class="token number">1100</span>
    <span class="token comment"># Socket è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="token comment"># è®¾ç½®ä¸ä¸‹æ¸¸æœåŠ¡å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">socket-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">3600000</span>
  <span class="token comment"># æ˜¯å¦å¿½ç•¥å®‰å…¨ç›¸å…³çš„å“åº”å¤´</span>
  <span class="token comment"># false: ä¿ç•™å®‰å…¨å¤´ä¿¡æ¯ï¼ˆå¦‚ X-Content-Type-Options ç­‰ï¼‰</span>
  <span class="token key atrule">ignoreSecurityHeaders</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token comment"># Eureka å®¢æˆ·ç«¯é…ç½®</span>
<span class="token comment"># ç”¨äºæœåŠ¡æ³¨å†Œå‘ç°ï¼Œç½‘å…³éœ€è¦æ³¨å†Œåˆ° Eureka å¹¶å‘ç°å…¶ä»–æœåŠ¡</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token comment"># å®ä¾‹é…ç½®ï¼Œå®šä¹‰å½“å‰æœåŠ¡å®ä¾‹çš„æ³¨å†Œä¿¡æ¯</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token comment"># å®ä¾‹ä¸»æœºåï¼Œç”¨äºæœåŠ¡å‘ç°æ—¶çš„åœ°å€è§£æ</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>$<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token comment"># æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ IP åœ°å€è¿›è¡Œæ³¨å†Œ</span>
    <span class="token comment"># false: ä½¿ç”¨ä¸»æœºåæ³¨å†Œ</span>
    <span class="token comment"># true: ä½¿ç”¨ IP åœ°å€æ³¨å†Œï¼Œé€‚ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PREFER_IP_ADDRESS<span class="token punctuation">:</span><span class="token boolean important">false</span><span class="token punctuation">}</span>
    <span class="token comment"># å®ä¾‹ ID æ ¼å¼ï¼Œåœ¨ Eureka æœåŠ¡å™¨ä¸­å”¯ä¸€æ ‡è¯†æ­¤å®ä¾‹</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
    <span class="token comment"># å¿ƒè·³ç»­çº¦é—´éš”ï¼ˆç§’ï¼‰</span>
    <span class="token comment"># å®¢æˆ·ç«¯å‘ Eureka æœåŠ¡å™¨å‘é€å¿ƒè·³çš„é¢‘ç‡</span>
    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>LEASE_RENEWAL_INTERVAL_IN_SECONDS<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>
    <span class="token comment"># ç§Ÿçº¦è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span>
    <span class="token comment"># Eureka æœåŠ¡å™¨åœ¨å¤šä¹…æ²¡æœ‰æ”¶åˆ°å¿ƒè·³åè®¤ä¸ºå®ä¾‹ä¸‹çº¿</span>
    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
    <span class="token comment"># çŠ¶æ€é¡µé¢ URLï¼Œç”¨äºå±•ç¤ºå®ä¾‹çŠ¶æ€ä¿¡æ¯</span>
    <span class="token key atrule">status-page-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/actuator/info
    <span class="token comment"># å¥åº·æ£€æŸ¥ URLï¼ŒEureka æœåŠ¡å™¨å®šæœŸæ£€æŸ¥å®ä¾‹å¥åº·çŠ¶æ€</span>
    <span class="token key atrule">health-check-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/actuator/health
    <span class="token comment"># ä¸»é¡µ URLï¼Œå®ä¾‹çš„ä¸»é¡µåœ°å€</span>
    <span class="token key atrule">home-page-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
  <span class="token comment"># Eureka å®¢æˆ·ç«¯è¡Œä¸ºé…ç½®</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨å¥åº·æ£€æŸ¥</span>
    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># æ˜¯å¦ä» Eureka æœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯</span>
    <span class="token comment"># true: è·å–å…¶ä»–æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œç”¨äºæœåŠ¡å‘ç°</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>FETCH_REGISTRY<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
    <span class="token comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka æœåŠ¡å™¨</span>
    <span class="token comment"># true: å°†æœ¬å®ä¾‹æ³¨å†Œåˆ° Eurekaï¼Œä¾›å…¶ä»–æœåŠ¡å‘ç°</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>REGISTER_WITH_EUREKA<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
    <span class="token comment"># Eureka æœåŠ¡å™¨åœ°å€é…ç½®</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment"># Eureka æœåŠ¡å™¨é›†ç¾¤åœ°å€ï¼Œæ”¯æŒå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”</span>
      <span class="token comment"># æ ¼å¼ï¼šåè®®://ç”¨æˆ·å:å¯†ç @ä¸»æœºå:ç«¯å£/eureka/</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>EUREKA_PEERS<span class="token punctuation">:</span>http<span class="token punctuation">:</span>//soaadmin<span class="token punctuation">:</span>jsepc01<span class="token tag">!@autumnnook-eureka:8761/eureka/</span><span class="token punctuation">}</span>
</code></pre><h4 id="å¯åŠ¨ç±»">å¯åŠ¨ç±» </h4>
<p>å¯åŠ¨ç±»éœ€è¦æ·»åŠ  <code>@EnableZuulProxy</code> æ³¨è§£ï¼ˆå…¶ä½™æ³¨è§£é…ç½®å¯ä»¥å¿½è§†ï¼Œå±•ç¤ºå‡ºæ¥çš„æ¯”è¾ƒå…¨ï¼‰</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-package">package</span> <span class="token namespace">com<span class="token punctuation">.</span>autumnnook</span><span class="token punctuation">;</span>

<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrix</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">EnableZuulProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span></span><span class="token class-name">Environment</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Zuul ç½‘å…³åº”ç”¨å¯åŠ¨ç±»
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç±»æ˜¯ AutumnNook å¾®æœåŠ¡æ¶æ„ä¸­çš„ API ç½‘å…³å…¥å£ï¼Œè´Ÿè´£ç»Ÿä¸€çš„è·¯ç”±è½¬å‘ã€
 * æœåŠ¡å‘ç°ã€ç†”æ–­é™çº§å’Œç›‘æ§ç®¡ç†åŠŸèƒ½ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>æ ¸å¿ƒåŠŸèƒ½æ³¨è§£è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableZuulProxy</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Zuul ä»£ç†åŠŸèƒ½ï¼Œæä¾›åŠ¨æ€è·¯ç”±å’Œè¿‡æ»¤å™¨æ”¯æŒ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œä¸æ³¨å†Œä¸­å¿ƒäº¤äº’<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableHystrix</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Hystrix ç†”æ–­å™¨ï¼Œæä¾›æœåŠ¡çš„å®¹é”™ä¿æŠ¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Hystrix ä»ªè¡¨ç›˜ï¼Œæä¾›ç†”æ–­ç›‘æ§ç•Œé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">}</span>ï¼šSpring Boot åº”ç”¨æ ‡å‡†æ³¨è§£ï¼ŒåŒ…å«ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨é…ç½®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>åº”ç”¨æ¶æ„å®šä½ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½œä¸ºå¾®æœåŠ¡æ¶æ„çš„ç»Ÿä¸€å…¥å£ç½‘å…³<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è´Ÿè´£è¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æä¾›ç»Ÿä¸€çš„è®¤è¯æˆæƒå…¥å£<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å®ç°æœåŠ¡çš„ç†”æ–­é™çº§å’Œé™æµä¿æŠ¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ”¶é›†å’Œå±•ç¤ºæœåŠ¡ç›‘æ§æŒ‡æ ‡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 * <span class="token keyword keyword-@version">@version</span> 1.0
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableZuulProxy</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableDiscoveryClient</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableHystrix</span></span>
 * <span class="token keyword keyword-@since">@since</span> 2024
 */</span>
<span class="token annotation punctuation">@EnableHystrix</span>                  <span class="token comment">// å¯ç”¨ Hystrix ç†”æ–­å™¨ï¼Œæä¾›æœåŠ¡çš„å®¹é”™ä¿æŠ¤æœºåˆ¶</span>
<span class="token annotation punctuation">@EnableZuulProxy</span>                <span class="token comment">// å¯ç”¨ Zuul ä»£ç†ï¼Œæä¾›åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ç­‰åŠŸèƒ½</span>
<span class="token annotation punctuation">@SpringBootApplication</span>          <span class="token comment">// Spring Boot åº”ç”¨æ ¸å¿ƒæ³¨è§£ï¼ŒåŒ…å«é…ç½®ã€ç»„ä»¶æ‰«æç­‰</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>          <span class="token comment">// å¯ç”¨æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Eurekaã€Consul ç­‰æ³¨å†Œä¸­å¿ƒ</span>
<span class="token annotation punctuation">@EnableHystrixDashboard</span>         <span class="token comment">// å¯ç”¨ Hystrix ä»ªè¡¨ç›˜ï¼Œæä¾›å¯è§†åŒ–çš„ç†”æ–­å™¨ç›‘æ§ç•Œé¢</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulApplication</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ—¥å¿—è®°å½•å™¨å®ä¾‹ï¼Œç”¨äºè¾“å‡ºåº”ç”¨å¯åŠ¨å’Œè¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * åº”ç”¨ä¸»å…¥å£æ–¹æ³•
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨æµç¨‹è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå§‹åŒ– Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®å’Œ Bean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨å†…åµŒçš„ Web æœåŠ¡å™¨ï¼ˆUndertowï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒï¼ˆEurekaï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå§‹åŒ– Zuul è·¯ç”±é…ç½®å’Œè¿‡æ»¤å™¨é“¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨ Hystrix ç†”æ–­å™¨å’Œç›‘æ§ä»ªè¡¨ç›˜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è¾“å‡ºå¯åŠ¨æˆåŠŸä¿¡æ¯å’Œå…³é”®é…ç½®å‚æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å…³é”®é…ç½®è¾“å‡ºï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡ç«¯å£ï¼šç½‘å…³å¯¹å¤–æœåŠ¡çš„ç«¯å£å·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å®ä¾‹åœ°å€ï¼šå½“å‰å®ä¾‹åœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡å‘ç°é…ç½®ï¼šæ˜¯å¦æ‹‰å–å’Œæ³¨å†ŒæœåŠ¡çš„å¼€å…³çŠ¶æ€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å†Œä¸­å¿ƒåœ°å€ï¼šEureka æœåŠ¡å™¨é›†ç¾¤åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è®¿é—®åœ°å€ï¼šåº”ç”¨å¯åŠ¨åçš„å¯è®¿é—®åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç›‘æ§ç«¯ç‚¹ï¼šActuator ç›‘æ§ç«¯ç‚¹çš„è®¿é—®åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">args</span> å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ç”¨äºè¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°
     */</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯åŠ¨ Spring Boot åº”ç”¨ï¼Œè¿”å›åº”ç”¨ä¸Šä¸‹æ–‡</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–ç¯å¢ƒé…ç½®ä¿¡æ¯</span>
        <span class="token class-name">Environment</span> environment <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–å…³é”®é…ç½®ä¿¡æ¯</span>
        <span class="token class-name">String</span> port <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"server.port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fetchRegistry <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.fetch-registry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> registryWithEureka <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.register-with-eureka"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> defaultZone <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.service-url.defaultZone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hostname <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.instance.hostname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> preferIpAddress <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.instance.prefer-ip-address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºåº”ç”¨å¯åŠ¨æˆåŠŸä¿¡æ¯å’Œå…³é”®é…ç½®</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"========= AutumnNook Zuul started successfully ========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸš€ æœåŠ¡ç«¯å£ï¼š{}"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ  å®ä¾‹åœ°å€ï¼š{}"</span><span class="token punctuation">,</span> hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“¥ æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡ï¼š{}"</span><span class="token punctuation">,</span> fetchRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“¤ æ˜¯å¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š{}"</span><span class="token punctuation">,</span> registryWithEureka<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ”— æ³¨å†Œä¸­å¿ƒé›†ç¾¤åœ°å€ï¼š{}"</span><span class="token punctuation">,</span> defaultZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸŒ æ˜¯å¦ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨çš„IPåœ°å€ï¼š{}"</span><span class="token punctuation">,</span> preferIpAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“Š è®¿é—®åœ°å€ï¼šhttp://localhost:{}/"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ‘ï¸ ç›‘æ§ç«¯ç‚¹ï¼šhttp://localhost:{}/actuator"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"========================================================"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-static">static</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ³¨å†Œ JVM å…³é—­é’©å­ï¼Œç¡®ä¿åº”ç”¨ä¼˜é›…å…³é—­</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"===================Autumnnook Zuul æ­£åœ¨å…³é—­==================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨æ¸…ç†èµ„æº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„èµ„æºæ¸…ç†é€»è¾‘ï¼Œå¦‚ï¼š</span>
            <span class="token comment">// - å…³é—­æ•°æ®åº“è¿æ¥æ± </span>
            <span class="token comment">// - é‡Šæ”¾ Redis è¿æ¥</span>
            <span class="token comment">// - ä»æ³¨å†Œä¸­å¿ƒæ³¨é”€æœåŠ¡</span>
            <span class="token comment">// - åœæ­¢åå°çº¿ç¨‹ç­‰</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"èµ„æºæ¸…ç†å®Œæˆï¼ŒæœåŠ¡å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="é…ç½®è·¯ç”±è§„åˆ™-1">é…ç½®è·¯ç”±è§„åˆ™ </h3>
<h4 id="url-åœ°å€è·¯ç”±">URL åœ°å€è·¯ç”± </h4>
<pre data-role="codeBlock" data-info="yml" class="language-yaml yml"><code><span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token key atrule">autumnnook-system</span><span class="token punctuation">:</span> <span class="token comment"># è·¯ç”± id è‡ªå®šä¹‰</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/system/<span class="token important">**</span> <span class="token comment"># é…ç½®è¯·æ±‚ url çš„æ˜ å°„è·¯å¾„</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//autumnnook<span class="token punctuation">-</span>system<span class="token punctuation">:</span><span class="token number">18080</span> <span class="token comment"># æ˜ å°„è·¯å¾„å¯¹åº”çš„å¾®æœåŠ¡åœ°å€</span>
    <span class="token key atrule">autumnnook-menu</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/menu/<span class="token important">**</span>
      <span class="token key atrule">url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//autumnnook<span class="token punctuation">-</span>menu<span class="token punctuation">:</span><span class="token number">18081</span>
</code></pre><p>å¯ä»¥ä½¿ç”¨é€šé…ç¬¦ï¼Œå«ä¹‰å¦‚ä¸‹ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">é€šé…ç¬¦</th>
<th style="text-align:center">å«ä¹‰</th>
<th style="text-align:center">ä¸¾ä¾‹</th>
<th style="text-align:center">è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">?</td>
<td style="text-align:center">åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</td>
<td style="text-align:center">/api/system/?</td>
<td style="text-align:center">/api/system/aï¼Œ/api/system/bï¼Œ...</td>
</tr>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:center">åŒ¹é…ä»»æ„æ•°é‡å­—ç¬¦ä¸åŒ…æ‹¬å­è·¯å¾„</td>
<td style="text-align:center">/api/system/*</td>
<td style="text-align:center">/api/system/aaï¼Œ/api/system/bbbï¼Œ...</td>
</tr>
<tr>
<td style="text-align:center">**</td>
<td style="text-align:center">åŒ¹é…ä»»æ„æ•°é‡å­—ç¬¦åŒ…æ‹¬å­è·¯å¾„</td>
<td style="text-align:center">/api/system/**</td>
<td style="text-align:center">/api/system/aa/bbï¼Œ/api/system/bbb/ccccï¼Œ...</td>
</tr>
</tbody>
</table>
<p>é‡å¯æœåŠ¡ï¼Œè®¿é—®ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="assets/image-20251221010848379.png" alt="image-20251221010848379"></p>
<h4 id="æœåŠ¡åç§°è·¯ç”±">æœåŠ¡åç§°è·¯ç”± </h4>
<p>å¾®æœåŠ¡ä¸€èˆ¬ç”±å‡ åã€ä¸Šç™¾ä¸ªæœåŠ¡ç»„æˆï¼Œå¯¹äº URL åœ°å€è·¯ç”±çš„æ–¹å¼ï¼Œå¦‚æœå¯¹äºæ¯ä¸ªæœåŠ¡å®ä¾‹æ‰‹åŠ¨æŒ‡å®šä¸€ä¸ªå”¯ä¸€è®¿é—®çš„åœ°å€ï¼Œè¿™æ ·åšæ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚</p>
<p>Zuul æ”¯æŒä¸ Eureka æ•´åˆå¼€å‘ï¼Œæ ¹æ® serviceId è‡ªåŠ¨ä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡åœ°å€å¹¶è½¬å‘è¯·æ±‚ï¼Œè¿™æ ·åšçš„å¥½å¤„ä¸ä»…å¯ä»¥é€šè¿‡å•ä¸ªç«¯ç‚¹æ¥è®¿é—®åº”ç”¨çš„æ‰€æœ‰æœåŠ¡ï¼Œè€Œä¸”åœ¨æ·»åŠ æˆ–è€…ç§»é™¤æœåŠ¡æ—¶ä¸ç”¨ä¿®æ”¹ Zuul çš„è·¯ç”±é…ç½®ã€‚</p>
<h5 id="æ·»åŠ -eureka-client-ä¾èµ–">æ·»åŠ  Eureka Client ä¾èµ– </h5>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><h5 id="é…ç½®æ³¨å†Œä¸­å¿ƒå’Œè·¯ç”±è§„åˆ™">é…ç½®æ³¨å†Œä¸­å¿ƒå’Œè·¯ç”±è§„åˆ™ </h5>
<pre data-role="codeBlock" data-info="yml" class="language-yaml yml"><code><span class="token comment"># Zuul ç½‘å…³åº”ç”¨é…ç½®æ–‡ä»¶</span>
<span class="token comment">#</span>
<span class="token comment"># è¯¥é…ç½®æ–‡ä»¶å®šä¹‰äº† Zuul API ç½‘å…³çš„æ ¸å¿ƒé…ç½®ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨è®¾ç½®ã€Spring åº”ç”¨é…ç½®ã€</span>
<span class="token comment"># Zuul ç½‘å…³ç‰¹æ€§å’Œ Eureka æœåŠ¡å‘ç°é…ç½®ã€‚</span>
<span class="token comment">#</span>
<span class="token comment"># ä¸»è¦åŠŸèƒ½ï¼š</span>
<span class="token comment"># - é…ç½®ç½‘å…³æœåŠ¡å™¨å‚æ•°å’Œæ€§èƒ½ä¼˜åŒ–</span>
<span class="token comment"># - å®šä¹‰ Zuul è·¯ç”±å’Œè´Ÿè½½å‡è¡¡è¡Œä¸º</span>
<span class="token comment"># - é…ç½®æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼ˆEurekaï¼‰</span>
<span class="token comment"># - è®¾ç½®å¥åº·æ£€æŸ¥å’Œç›‘æ§ç«¯ç‚¹</span>
<span class="token comment">#</span>
<span class="token comment"># é€‚ç”¨åœºæ™¯ï¼š</span>
<span class="token comment"># - å¾®æœåŠ¡æ¶æ„ä¸­çš„ API ç½‘å…³</span>
<span class="token comment"># - æœåŠ¡è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</span>
<span class="token comment"># - è¯·æ±‚è¿‡æ»¤å’Œæƒé™æ§åˆ¶</span>
<span class="token comment"># - æœåŠ¡æ³¨å†Œå‘ç°å’Œå¥åº·ç›‘æ§</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># æœåŠ¡å™¨ç«¯å£é…ç½®</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SERVER_PORT<span class="token punctuation">:</span><span class="token number">30000</span><span class="token punctuation">}</span>
  <span class="token comment"># Undertow æœåŠ¡å™¨æ€§èƒ½ä¼˜åŒ–é…ç½®</span>
  <span class="token comment"># Undertow æ˜¯é«˜æ€§èƒ½çš„ NIO æœåŠ¡å™¨ï¼Œé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯</span>
  <span class="token key atrule">undertow</span><span class="token punctuation">:</span>
    <span class="token comment"># I/O çº¿ç¨‹æ•°ï¼Œè´Ÿè´£å¤„ç†éé˜»å¡ I/O æ“ä½œ</span>
    <span class="token comment"># å»ºè®®è®¾ç½®ä¸º CPU æ ¸å¿ƒæ•°çš„ 1-2 å€</span>
    <span class="token key atrule">io-threads</span><span class="token punctuation">:</span> <span class="token number">16</span>
    <span class="token comment"># å·¥ä½œçº¿ç¨‹æ•°ï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘</span>
    <span class="token comment"># æ ¹æ®ä¸šåŠ¡å¤æ‚åº¦å’Œå¹¶å‘é‡è°ƒæ•´ï¼Œé€šå¸¸è®¾ç½®ä¸º I/O çº¿ç¨‹æ•°çš„ 10-100 å€</span>
    <span class="token key atrule">worker-threads</span><span class="token punctuation">:</span> <span class="token number">1600</span>
    <span class="token comment"># æ˜¯å¦ä½¿ç”¨ç›´æ¥å†…å­˜ç¼“å†²åŒº</span>
    <span class="token comment"># true è¡¨ç¤ºä½¿ç”¨å †å¤–å†…å­˜ï¼Œå‡å°‘ GC å‹åŠ›ï¼Œæé«˜æ€§èƒ½</span>
    <span class="token key atrule">direct-buffers</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># Servlet ä¸Šä¸‹æ–‡è·¯å¾„é…ç½®</span>
  <span class="token comment"># å®šä¹‰åº”ç”¨è®¿é—®çš„åŸºç¡€è·¯å¾„ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦åŒ…å«æ­¤è·¯å¾„</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># åº”ç”¨åç§°é…ç½®ï¼Œç”¨äºæœåŠ¡æ³¨å†Œå’Œå‘ç°</span>
  <span class="token comment"># åœ¨ Eureka ä¸­ä»¥æ­¤åç§°æ³¨å†ŒæœåŠ¡</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>APPLICATION_NAME<span class="token punctuation">:</span>autumnnook<span class="token punctuation">-</span>zuul<span class="token punctuation">}</span>
  <span class="token comment"># Spring MVC é…ç½®</span>
  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token comment"># å½“æ²¡æœ‰æ‰¾åˆ°è¯·æ±‚å¤„ç†å™¨æ—¶æ˜¯å¦æŠ›å‡ºå¼‚å¸¸</span>
    <span class="token comment"># true: æŠ›å‡º NoHandlerFoundExceptionï¼Œä¾¿äºç»Ÿä¸€å¼‚å¸¸å¤„ç†</span>
    <span class="token comment"># false: è¿”å›é»˜è®¤ 404 é¡µé¢</span>
    <span class="token key atrule">throw-exception-if-no-handler-found</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># é™æ€èµ„æºæ˜ å°„é…ç½®</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨é™æ€èµ„æºæ˜ å°„</span>
    <span class="token comment"># true: å¯ç”¨ï¼Œå¯ä»¥è®¿é—®é™æ€èµ„æºæ–‡ä»¶</span>
    <span class="token comment"># false: ç¦ç”¨ï¼Œé€‚ç”¨äºçº¯ API ç½‘å…³åœºæ™¯</span>
    <span class="token key atrule">add-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token comment"># Zuul ç½‘å…³æ ¸å¿ƒé…ç½®</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token key atrule">autumnnook-system</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/system/<span class="token important">**</span>
      <span class="token key atrule">service-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>AUTUMNLOOK_SYSTEM_SERVICE_ID<span class="token punctuation">:</span>autumnnook<span class="token punctuation">-</span>system<span class="token punctuation">}</span>
    <span class="token key atrule">autumnnook-menu</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /api/menu/<span class="token important">**</span>
      <span class="token key atrule">service-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>AUTUMNLOOK_MENU_SERVICE_ID<span class="token punctuation">:</span>autumnnook<span class="token punctuation">-</span>menu<span class="token punctuation">}</span>
  <span class="token comment"># ä¿¡å·é‡é…ç½®ï¼Œç”¨äºæ§åˆ¶å¹¶å‘è¯·æ±‚æ•°é‡</span>
  <span class="token key atrule">semaphore</span><span class="token punctuation">:</span>
    <span class="token comment"># æœ€å¤§ä¿¡å·é‡æ•°é‡ï¼Œé™åˆ¶åŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°</span>
    <span class="token comment"># é˜²æ­¢ç½‘å…³è¢«è¿‡å¤šè¯·æ±‚å‹å®ï¼Œèµ·åˆ°ç†”æ–­ä¿æŠ¤ä½œç”¨</span>
    <span class="token key atrule">max-semaphores</span><span class="token punctuation">:</span> <span class="token number">1100</span>
  <span class="token comment"># æ•æ„Ÿè¯·æ±‚å¤´é…ç½®</span>
  <span class="token comment"># ç©ºæ•°ç»„è¡¨ç¤ºä¸è¿‡æ»¤ä»»ä½•è¯·æ±‚å¤´ï¼Œæ‰€æœ‰å¤´ä¿¡æ¯éƒ½ä¼šè½¬å‘åˆ°ä¸‹æ¸¸æœåŠ¡</span>
  <span class="token key atrule">sensitive-headers</span><span class="token punctuation">:</span>
  <span class="token comment"># æ˜¯å¦å‰¥ç¦»è·¯ç”±å‰ç¼€</span>
  <span class="token comment"># false: ä¿ç•™å®Œæ•´è·¯å¾„è½¬å‘åˆ°ä¸‹æ¸¸æœåŠ¡</span>
  <span class="token comment"># true: å»é™¤è·¯ç”±åŒ¹é…çš„å‰ç¼€éƒ¨åˆ†</span>
  <span class="token key atrule">strip-prefix</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># æ˜¯å¦æ·»åŠ  Host å¤´ä¿¡æ¯</span>
  <span class="token comment"># true: åœ¨è½¬å‘è¯·æ±‚æ—¶æ·»åŠ  Host å¤´ï¼Œä¾¿äºä¸‹æ¸¸æœåŠ¡è¯†åˆ«è¯·æ±‚æ¥æº</span>
  <span class="token key atrule">add-host-header</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># HTTP å®¢æˆ·ç«¯è¿æ¥æ± é…ç½®</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span>
    <span class="token comment"># æœ€å¤§æ€»è¿æ¥æ•°ï¼Œé™åˆ¶ç½‘å…³ä¸æ‰€æœ‰ä¸‹æ¸¸æœåŠ¡çš„æ€»è¿æ¥æ•°</span>
    <span class="token key atrule">maxTotalConnections</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token comment"># æ¯ä¸ªè·¯ç”±çš„æœ€å¤§è¿æ¥æ•°ï¼Œé™åˆ¶åˆ°å•ä¸ªæœåŠ¡çš„æœ€å¤§è¿æ¥æ•°</span>
    <span class="token key atrule">maxPerRouteConnections</span><span class="token punctuation">:</span> <span class="token number">1100</span>
    <span class="token comment"># Socket è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="token comment"># è®¾ç½®ä¸ä¸‹æ¸¸æœåŠ¡å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">socket-timeout-millis</span><span class="token punctuation">:</span> <span class="token number">3600000</span>
  <span class="token comment"># æ˜¯å¦å¿½ç•¥å®‰å…¨ç›¸å…³çš„å“åº”å¤´</span>
  <span class="token comment"># false: ä¿ç•™å®‰å…¨å¤´ä¿¡æ¯ï¼ˆå¦‚ X-Content-Type-Options ç­‰ï¼‰</span>
  <span class="token key atrule">ignoreSecurityHeaders</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token comment"># Eureka å®¢æˆ·ç«¯é…ç½®</span>
<span class="token comment"># ç”¨äºæœåŠ¡æ³¨å†Œå‘ç°ï¼Œç½‘å…³éœ€è¦æ³¨å†Œåˆ° Eureka å¹¶å‘ç°å…¶ä»–æœåŠ¡</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token comment"># å®ä¾‹é…ç½®ï¼Œå®šä¹‰å½“å‰æœåŠ¡å®ä¾‹çš„æ³¨å†Œä¿¡æ¯</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token comment"># å®ä¾‹ä¸»æœºåï¼Œç”¨äºæœåŠ¡å‘ç°æ—¶çš„åœ°å€è§£æ</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>$<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token comment"># æ˜¯å¦ä¼˜å…ˆä½¿ç”¨ IP åœ°å€è¿›è¡Œæ³¨å†Œ</span>
    <span class="token comment"># false: ä½¿ç”¨ä¸»æœºåæ³¨å†Œ</span>
    <span class="token comment"># true: ä½¿ç”¨ IP åœ°å€æ³¨å†Œï¼Œé€‚ç”¨äºå®¹å™¨åŒ–éƒ¨ç½²</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>PREFER_IP_ADDRESS<span class="token punctuation">:</span><span class="token boolean important">false</span><span class="token punctuation">}</span>
    <span class="token comment"># å®ä¾‹ ID æ ¼å¼ï¼Œåœ¨ Eureka æœåŠ¡å™¨ä¸­å”¯ä¸€æ ‡è¯†æ­¤å®ä¾‹</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
    <span class="token comment"># å¿ƒè·³ç»­çº¦é—´éš”ï¼ˆç§’ï¼‰</span>
    <span class="token comment"># å®¢æˆ·ç«¯å‘ Eureka æœåŠ¡å™¨å‘é€å¿ƒè·³çš„é¢‘ç‡</span>
    <span class="token key atrule">lease-renewal-interval-in-seconds</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>LEASE_RENEWAL_INTERVAL_IN_SECONDS<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>
    <span class="token comment"># ç§Ÿçº¦è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰</span>
    <span class="token comment"># Eureka æœåŠ¡å™¨åœ¨å¤šä¹…æ²¡æœ‰æ”¶åˆ°å¿ƒè·³åè®¤ä¸ºå®ä¾‹ä¸‹çº¿</span>
    <span class="token key atrule">lease-expiration-duration-in-seconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
    <span class="token comment"># çŠ¶æ€é¡µé¢ URLï¼Œç”¨äºå±•ç¤ºå®ä¾‹çŠ¶æ€ä¿¡æ¯</span>
    <span class="token key atrule">status-page-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/actuator/info
    <span class="token comment"># å¥åº·æ£€æŸ¥ URLï¼ŒEureka æœåŠ¡å™¨å®šæœŸæ£€æŸ¥å®ä¾‹å¥åº·çŠ¶æ€</span>
    <span class="token key atrule">health-check-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>/actuator/health
    <span class="token comment"># ä¸»é¡µ URLï¼Œå®ä¾‹çš„ä¸»é¡µåœ°å€</span>
    <span class="token key atrule">home-page-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//$<span class="token punctuation">{</span>HOSTNAME<span class="token punctuation">:</span>localhost<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
  <span class="token comment"># Eureka å®¢æˆ·ç«¯è¡Œä¸ºé…ç½®</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨å¥åº·æ£€æŸ¥</span>
    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># æ˜¯å¦ä» Eureka æœåŠ¡å™¨è·å–æ³¨å†Œè¡¨ä¿¡æ¯</span>
    <span class="token comment"># true: è·å–å…¶ä»–æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œç”¨äºæœåŠ¡å‘ç°</span>
    <span class="token key atrule">fetch-registry</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>FETCH_REGISTRY<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
    <span class="token comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka æœåŠ¡å™¨</span>
    <span class="token comment"># true: å°†æœ¬å®ä¾‹æ³¨å†Œåˆ° Eurekaï¼Œä¾›å…¶ä»–æœåŠ¡å‘ç°</span>
    <span class="token key atrule">register-with-eureka</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>REGISTER_WITH_EUREKA<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
    <span class="token comment"># Eureka æœåŠ¡å™¨åœ°å€é…ç½®</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token comment"># Eureka æœåŠ¡å™¨é›†ç¾¤åœ°å€ï¼Œæ”¯æŒå¤šä¸ªåœ°å€ç”¨é€—å·åˆ†éš”</span>
      <span class="token comment"># æ ¼å¼ï¼šåè®®://ç”¨æˆ·å:å¯†ç @ä¸»æœºå:ç«¯å£/eureka/</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>EUREKA_PEERS<span class="token punctuation">:</span>http<span class="token punctuation">:</span>//soaadmin<span class="token punctuation">:</span>jsepc01<span class="token tag">!@autumnnook-eureka:8761/eureka/</span><span class="token punctuation">}</span>
</code></pre><h4 id="å¦‚ä½•ç®€åŒ–è·¯ç”±é…ç½®">å¦‚ä½•ç®€åŒ–è·¯ç”±é…ç½® </h4>
<p>Zuul ä¸ºäº†æ–¹ä¾¿å¤§å®¶ä½¿ç”¨ï¼Œæä¾›äº†é»˜è®¤è·¯ç”±é…ç½®ï¼šè·¯ç”± id å’Œ å¾®æœåŠ¡åç§°ä¸€è‡´ï¼Œpath é»˜è®¤å¯¹åº” <code>å¾®æœåŠ¡åç§°/**</code> ï¼Œå› æ­¤ä»¥ä¸‹é…ç½®å°±ä¸å¿…å†å†™äº†ã€‚</p>
<pre data-role="codeBlock" data-info="yml" class="language-yaml yml"><code><span class="token comment"># é»˜è®¤é…ç½®ç¤ºä¾‹</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token key atrule">autumnnook-system</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /autumnnook<span class="token punctuation">-</span>system/<span class="token important">**</span>
    <span class="token key atrule">autumnnook-menu</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /autumnnook<span class="token punctuation">-</span>menu/<span class="token important">**</span>
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´å³ä¾¿æˆ‘ä»¬å°†è·¯ç”±é…ç½®æ³¨é‡Šæ‰ï¼ŒåŒæ ·ä¹Ÿèƒ½æˆåŠŸè®¿é—®æœåŠ¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><img src="assets/image-20251221012543869.png" alt="image-20251221012543869"></p>
<p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬ç»“åˆæœåŠ¡åç§°è·¯ç”±å’Œé»˜è®¤è·¯ç”±çš„å¯å‘ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ Eureka æœåŠ¡æ³¨å†Œä¸­å¿ƒå®ç°åŠ¨æ€è·¯ç”±è§„åˆ™å¹¶è‡ªå®šä¹‰è·¯ç”± idã€‚éœ€è¦é€šè¿‡ç»§æ‰¿ <code>SimpleRouteLocator</code> å¹¶å®ç° <code>RefreshableRouteLocator</code> æ¥å£ã€‚</p>
<ul>
<li>è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ServiceInstance</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">DiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">RefreshableRouteLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SimpleRouteLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">ZuulProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedHashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>atomic<span class="token punctuation">.</span></span><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * è‡ªå®šä¹‰åŠ¨æ€è·¯ç”±å®šä½å™¨ï¼Œç”¨äºä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè‡ªåŠ¨å‘ç°å¹¶åˆ›å»ºZuulè·¯ç”±è§„åˆ™
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç±»ç»§æ‰¿ <span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">SimpleRouteLocator</span></span><span class="token punctuation">}</span> å¹¶å®ç° <span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">RefreshableRouteLocator</span></span><span class="token punctuation">}</span> æ¥å£ï¼Œ
 * æä¾›åŸºäºæœåŠ¡å‘ç°çš„è·¯ç”±åŠ¨æ€ç®¡ç†èƒ½åŠ›ã€‚å½“æœåŠ¡åœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œæˆ–æ³¨é”€æ—¶ï¼Œè·¯ç”±è§„åˆ™ä¼šè‡ªåŠ¨æ›´æ–°ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>ä¸»è¦ç‰¹æ€§ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è‡ªåŠ¨ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒå‘ç°æ‰€æœ‰å¯ç”¨æœåŠ¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä¸ºæ¯ä¸ªæœåŠ¡åŠ¨æ€åˆ›å»ºç»Ÿä¸€æ ¼å¼çš„è·¯ç”±è§„åˆ™<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ”¯æŒè·¯ç”±é…ç½®çš„çƒ­åˆ·æ–°ï¼Œæ— éœ€é‡å¯ç½‘å…³<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä¸é™æ€è·¯ç”±é…ç½®å…±å­˜ï¼ŒåŠ¨æ€è·¯ç”±ä¼˜å…ˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨åœºæ™¯ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¾®æœåŠ¡æ¶æ„ä¸­æœåŠ¡åŠ¨æ€ä¸Šä¸‹çº¿çš„åœºæ™¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>éœ€è¦è‡ªåŠ¨ä¸ºæ¯ä¸ªæ³¨å†Œçš„æœåŠ¡åˆ›å»ºç»Ÿä¸€è·¯ç”±è§„åˆ™çš„åœºæ™¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç½‘å…³éœ€è¦å®æ—¶æ„ŸçŸ¥æœåŠ¡æ³¨å†Œè¡¨å˜åŒ–çš„åœºæ™¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 * <span class="token keyword keyword-@version">@version</span> 1.0
 * <span class="token keyword keyword-@since">@since</span> 2024
 */</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SimpleRoutingLocater</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">SimpleRouteLocator</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">RefreshableRouteLocator</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ—¥å¿—è®°å½•å™¨å®ä¾‹ï¼Œç”¨äºè¾“å‡ºè·¯ç”±ç®¡ç†ç›¸å…³çš„æ—¥å¿—ä¿¡æ¯
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SimpleRoutingLocater</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è·¯ç”±IDç”Ÿæˆå™¨ï¼Œä½¿ç”¨åŸå­æ“ä½œç¡®ä¿çº¿ç¨‹å®‰å…¨
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç”Ÿæˆå™¨ä¸ºæ¯ä¸ªåŠ¨æ€åˆ›å»ºçš„è·¯ç”±ç”Ÿæˆå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸ºï¼šdiscovery-<span class="token punctuation">{</span>serviceName<span class="token punctuation">}</span>-<span class="token punctuation">{</span>sequence<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">AtomicInteger</span> <span class="token constant">ROUTE_ID_GENERATOR</span> <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œç”¨äºä»æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡ä¿¡æ¯
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>æ”¯æŒçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒåŒ…æ‹¬ï¼šEurekaã€Consulã€Nacosç­‰Spring Cloudå…¼å®¹çš„æ³¨å†Œä¸­å¿ƒã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨ <span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Resource</span></span><span class="token punctuation">}</span> æ³¨è§£å®ç°ä¾èµ–æ³¨å…¥ï¼Œç¡®ä¿åœ¨Springå®¹å™¨åˆå§‹åŒ–åè‡ªåŠ¨æ³¨å…¥ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">DiscoveryClient</span> discoveryClient<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æ„é€ ä¸€ä¸ªæ–°çš„åŠ¨æ€è·¯ç”±å®šä½å™¨å®ä¾‹
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">servletPath</span> åº”ç”¨ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œç”¨äºæ„å»ºå®Œæ•´è·¯ç”±è·¯å¾„
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">properties</span>  Zuulé…ç½®å±æ€§ï¼ŒåŒ…å«è·¯ç”±ç›¸å…³çš„å…¨å±€è®¾ç½®
     */</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">SimpleRoutingLocater</span><span class="token punctuation">(</span><span class="token class-name">String</span> servletPath<span class="token punctuation">,</span> <span class="token class-name">ZuulProperties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">(</span>servletPath<span class="token punctuation">,</span> properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ·æ–°è·¯ç”±é…ç½®ï¼Œé‡æ–°åŠ è½½æ‰€æœ‰è·¯ç”±è§„åˆ™
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥æ–¹æ³•ä¼šè§¦å‘è·¯ç”±é…ç½®çš„é‡æ–°åŠ è½½è¿‡ç¨‹ï¼Œé€šå¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡æ³¨å†Œè¡¨å‘ç”Ÿå˜åŒ–æ—¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>éœ€è¦å¼ºåˆ¶æ›´æ–°è·¯ç”±ç¼“å­˜æ—¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>é€šè¿‡/actuator/refreshç«¯ç‚¹è§¦å‘åˆ·æ–°æ—¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å®ç°è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>è°ƒç”¨çˆ¶ç±»çš„<span class="token punctuation">{</span><span class="token keyword keyword-@code">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">doRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>æ–¹æ³•é‡æ–°åŠ è½½æ‰€æœ‰è·¯ç”±ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Refreshing zuul routes from discovery client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">doRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å®šä½æ‰€æœ‰å¯ç”¨çš„è·¯ç”±è§„åˆ™ï¼ŒåŒ…æ‹¬é™æ€é…ç½®å’ŒåŠ¨æ€å‘ç°çš„è·¯ç”±
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>è·¯ç”±åŠ è½½æµç¨‹ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>é¦–å…ˆåŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„é™æ€è·¯ç”±ï¼ˆé€šè¿‡<span class="token punctuation">{</span><span class="token keyword keyword-@code">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">locateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>ï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç„¶ååŠ è½½ä»æœåŠ¡å‘ç°è·å–çš„åŠ¨æ€è·¯ç”±ï¼ˆé€šè¿‡<span class="token punctuation">{</span><span class="token keyword keyword-@code">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">locateRoutesFromDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>ï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå¹¶ä¸¤ç±»è·¯ç”±ï¼ŒåŠ¨æ€è·¯ç”±ä¼šè¦†ç›–åŒè·¯å¾„çš„é™æ€è·¯ç”±<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è®°å½•æœ€ç»ˆçš„è·¯ç”±æ•°é‡å’Œä¿¡æ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@return">@return</span> åŒ…å«æ‰€æœ‰è·¯ç”±è§„åˆ™çš„Mapï¼Œkeyä¸ºè·¯ç”±è·¯å¾„æ¨¡å¼ï¼Œvalueä¸ºå¯¹åº”çš„è·¯ç”±é…ç½®å¯¹è±¡
     * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">ZuulProperties</span><span class="token punctuation">.</span><span class="token class-name">ZuulRoute</span></span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-protected">protected</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span><span class="token punctuation">&gt;</span></span> <span class="token function">locateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span><span class="token punctuation">&gt;</span></span> routesMap <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        routesMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">locateRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        routesMap<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span><span class="token function">locateRoutesFromDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isInfoEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Loaded {} zuul routes: {}"</span><span class="token punctuation">,</span> routesMap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> routesMap<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> routesMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ä»æœåŠ¡å‘ç°å®¢æˆ·ç«¯åŠ¨æ€è·å–å¹¶ç”Ÿæˆè·¯ç”±é…ç½®
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å¤„ç†æµç¨‹ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è·å–æ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡åç§°åˆ—è¡¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ£€æŸ¥æœåŠ¡å‘ç°æ˜¯å¦æ­£å¸¸ï¼Œè‹¥æ— æœåŠ¡åˆ™è®°å½•è­¦å‘Š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>éå†æ¯ä¸ªæœåŠ¡ï¼Œè·å–å…¶å®ä¾‹ä¿¡æ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä¸ºæ¯ä¸ªæœåŠ¡åˆ›å»ºå¯¹åº”çš„è·¯ç”±è§„åˆ™<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¤„ç†é‡å¤è·¯ç”±è·¯å¾„çš„æƒ…å†µ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å¼‚å¸¸å¤„ç†ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>å½“æœåŠ¡å‘ç°å®¢æˆ·ç«¯å¼‚å¸¸æ—¶è¿”å›ç©ºæ˜ å°„ï¼Œä¸å½±å“é™æ€è·¯ç”±çš„æ­£å¸¸ä½¿ç”¨ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@return">@return</span> åŠ¨æ€ç”Ÿæˆçš„è·¯ç”±é…ç½®æ˜ å°„è¡¨ï¼Œkeyä¸ºè·¯ç”±è·¯å¾„ï¼Œvalueä¸ºè·¯ç”±é…ç½®å¯¹è±¡
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span><span class="token punctuation">&gt;</span></span> <span class="token function">locateRoutesFromDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span><span class="token punctuation">&gt;</span></span> dynamicRoutes <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> services <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>services<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"No services discovered from discovery client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-return">return</span> dynamicRoutes<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Discovered {} services: {}"</span><span class="token punctuation">,</span> services<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> services<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> serviceName <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances <span class="token operator">=</span> discoveryClient<span class="token punctuation">.</span><span class="token function">getInstances</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>instances<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"No instances found for service: {}"</span><span class="token punctuation">,</span> serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword keyword-continue">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span> route <span class="token operator">=</span> <span class="token function">createRouteForService</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">,</span> instances<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token function">buildRoutePath</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dynamicRoutes<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                dynamicRoutes<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
                logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Created route for service: {} -&gt; {}"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Duplicate route path detected: {}, skipping"</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> dynamicRoutes<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ä¸ºæŒ‡å®šæœåŠ¡åˆ›å»ºè·¯ç”±é…ç½®å¯¹è±¡
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>è·¯ç”±é…ç½®è¯¦è§£ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>id:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> è·¯ç”±å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºè·¯ç”±ç®¡ç†å’Œç›‘æ§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>serviceId:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æœåŠ¡æ ‡è¯†ï¼ŒZuulé€šè¿‡æ­¤å€¼è¿›è¡ŒæœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>retryable:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æ˜¯å¦å¯ç”¨é‡è¯•æœºåˆ¶ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®æ ¹æ®ä¸šåŠ¡éœ€æ±‚è®¾ç½®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>stripPrefix:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æ˜¯å¦å»é™¤è·¯å¾„å‰ç¼€ï¼Œtrueè¡¨ç¤ºè½¬å‘æ—¶å»æ‰æœåŠ¡åå‰ç¼€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>path:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> è·¯ç”±åŒ¹é…è·¯å¾„ï¼Œç”¨äºåŒ¹é…å®¢æˆ·ç«¯è¯·æ±‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>è®¾è®¡è€ƒè™‘ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨serviceIdè€Œéç›´æ¥URLï¼Œå……åˆ†åˆ©ç”¨Zuulçš„è´Ÿè½½å‡è¡¡èƒ½åŠ›ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">serviceName</span> æœåŠ¡åç§°ï¼Œç”¨äºè®¾ç½®serviceIdå’Œç”Ÿæˆè·¯ç”±ID
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">instances</span>   æœåŠ¡å®ä¾‹åˆ—è¡¨ï¼Œç”¨äºè®°å½•å®ä¾‹æ•°é‡ä¿¡æ¯ï¼ˆè°ƒè¯•ç”¨ï¼‰
     * <span class="token keyword keyword-@return">@return</span> é…ç½®å®Œæ•´çš„Zuulè·¯ç”±å¯¹è±¡
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span> <span class="token function">createRouteForService</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceName<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ServiceInstance</span><span class="token punctuation">&gt;</span></span> instances<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span> route <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ZuulProperties<span class="token punctuation">.</span>ZuulRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> routeId <span class="token operator">=</span> <span class="token function">generateRouteId</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        route<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>routeId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        route<span class="token punctuation">.</span><span class="token function">setServiceId</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        route<span class="token punctuation">.</span><span class="token function">setRetryable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        route<span class="token punctuation">.</span><span class="token function">setStripPrefix</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        route<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token function">buildRoutePath</span><span class="token punctuation">(</span>serviceName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"Created route: id={}, serviceId={}, path={}, instances={}"</span><span class="token punctuation">,</span> routeId<span class="token punctuation">,</span> serviceName<span class="token punctuation">,</span> route<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                instances<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> route<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * ç”Ÿæˆå”¯ä¸€çš„è·¯ç”±æ ‡è¯†ç¬¦
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>IDæ ¼å¼è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>"discovery":<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æ ‡è¯†æ­¤ä¸ºåŠ¨æ€å‘ç°çš„è·¯ç”±<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>serviceName<span class="token punctuation">}</span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> å…³è”çš„æœåŠ¡åç§°ï¼Œä¾¿äºè¯†åˆ«<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>sequence<span class="token punctuation">}</span>:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> è‡ªå¢åºåˆ—å·ï¼Œä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">}</span>ç¡®ä¿å…¨å±€å”¯ä¸€æ€§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>çº¿ç¨‹å®‰å…¨ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">AtomicInteger</span></span><span class="token punctuation">}</span>ç¡®ä¿å¹¶å‘ç¯å¢ƒä¸‹IDä¸ä¼šå†²çªã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">serviceName</span> æœåŠ¡åç§°ï¼Œä½œä¸ºIDçš„ä¸€éƒ¨åˆ†
     * <span class="token keyword keyword-@return">@return</span> æ ¼å¼ä¸º"discovery-<span class="token punctuation">{</span>serviceName<span class="token punctuation">}</span>-<span class="token punctuation">{</span>sequence<span class="token punctuation">}</span>"çš„å”¯ä¸€æ ‡è¯†ç¬¦
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">String</span> <span class="token function">generateRouteId</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"discovery-"</span> <span class="token operator">+</span> serviceName <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token constant">ROUTE_ID_GENERATOR</span><span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ„å»ºè·¯ç”±åŒ¹é…è·¯å¾„
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>è·¯å¾„è§„åˆ™è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨æœåŠ¡åç§°ä½œä¸ºè·¯å¾„å‰ç¼€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>"/**"è¡¨ç¤ºåŒ¹é…è¯¥è·¯å¾„ä¸‹çš„æ‰€æœ‰å­è·¯å¾„<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>ç¤ºä¾‹ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡"user-service"ä¼šç”Ÿæˆè·¯å¾„"/user-service/**"<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è¯·æ±‚"/user-service/api/users"ä¼šè¢«è·¯ç”±åˆ°user-serviceæœåŠ¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è¯·æ±‚"/user-service/api/orders"ä¹Ÿä¼šè¢«è·¯ç”±åˆ°user-serviceæœåŠ¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å¯æ‰©å±•æ€§ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>å¯æ ¹æ®éœ€è¦ä¿®æ”¹è·¯å¾„ç”Ÿæˆè§„åˆ™ï¼Œå¦‚æ·»åŠ ç‰ˆæœ¬å‰ç¼€"/v1/<span class="token punctuation">{</span>serviceName<span class="token punctuation">}</span>/**"ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">serviceName</span> æœåŠ¡åç§°
     * <span class="token keyword keyword-@return">@return</span> æ ¼å¼ä¸º"/<span class="token punctuation">{</span>serviceName<span class="token punctuation">}</span>/**"çš„è·¯ç”±è·¯å¾„
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token class-name">String</span> <span class="token function">buildRoutePath</span><span class="token punctuation">(</span><span class="token class-name">String</span> serviceName<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"/"</span> <span class="token operator">+</span> serviceName <span class="token operator">+</span> <span class="token string">"/**"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ul>
<li>æ·»åŠ  Zuul é…ç½®ç±»ï¼Œæ›¿æ¢é»˜è®¤è·¯ç”±å®šä½å™¨ï¼Œå®ç°åŸºäºæœåŠ¡å‘ç°çš„åŠ¨æ€è·¯ç”±ç®¡ç†</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>autumnnook<span class="token punctuation">.</span>locator<span class="token punctuation">.</span></span><span class="token class-name">SimpleRoutingLocater</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">ServerProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SimpleRouteLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">ZuulProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Primary</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * Zuulç½‘å…³é…ç½®ç±»
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç±»è´Ÿè´£é…ç½®Zuulç½‘å…³çš„æ ¸å¿ƒç»„ä»¶ï¼Œç‰¹åˆ«æ˜¯è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨çš„æ³¨å†Œå’Œåˆå§‹åŒ–ã€‚
 * é€šè¿‡æ›¿æ¢é»˜è®¤çš„è·¯ç”±å®šä½å™¨ï¼Œå®ç°åŸºäºæœåŠ¡å‘ç°çš„åŠ¨æ€è·¯ç”±ç®¡ç†ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>ä¸»è¦åŠŸèƒ½ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>é…ç½®è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨Bean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å…¥Zuulå’ŒæœåŠ¡å™¨ç›¸å…³é…ç½®å±æ€§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç¡®ä¿è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨ä¼˜å…ˆäºé»˜è®¤å®ç°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>é…ç½®è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Configuration</span></span><span class="token punctuation">}</span>æ ‡è¯†ä¸ºé…ç½®ç±»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">}</span>è‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Primary</span></span><span class="token punctuation">}</span>ç¡®ä¿è‡ªå®šä¹‰Beanä¼˜å…ˆè¢«ä½¿ç”¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 * <span class="token keyword keyword-@version">@version</span> 1.0
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">SimpleRoutingLocater</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">ZuulProperties</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">ServerProperties</span></span>
 * <span class="token keyword keyword-@since">@since</span> 2024
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulConfig</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * Zuulé…ç½®å±æ€§ï¼ŒåŒ…å«è·¯ç”±ã€è¿‡æ»¤å™¨ç­‰å…¨å±€é…ç½®
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥å±æ€§é€šè¿‡Spring Bootè‡ªåŠ¨é…ç½®æ³¨å…¥ï¼ŒåŒ…å«ä»¥ä¸‹é‡è¦é…ç½®é¡¹ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>routes:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> é™æ€è·¯ç”±é…ç½®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>prefix:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> è·¯ç”±å‰ç¼€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>stripPrefix:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æ˜¯å¦å‰¥ç¦»å‰ç¼€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>retryable:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æ˜¯å¦å¯é‡è¯•<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>sensitiveHeaders:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æ•æ„Ÿå¤´ä¿¡æ¯<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¿™äº›é…ç½®ä¼šå½±å“æ‰€æœ‰è·¯ç”±çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬åŠ¨æ€ç”Ÿæˆçš„è·¯ç”±ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">ZuulProperties</span> zuulProperties<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æœåŠ¡å™¨é…ç½®å±æ€§ï¼ŒåŒ…å«æœåŠ¡å™¨ç›¸å…³çš„é…ç½®ä¿¡æ¯
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥å±æ€§é€šè¿‡Spring Bootè‡ªåŠ¨é…ç½®æ³¨å…¥ï¼Œä¸»è¦åŒ…å«ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>servlet.context-path:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> åº”ç”¨ä¸Šä¸‹æ–‡è·¯å¾„<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>server.port:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æœåŠ¡å™¨ç«¯å£<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>server.address:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> æœåŠ¡å™¨åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>ä¸Šä¸‹æ–‡è·¯å¾„ç”¨äºæ„å»ºå®Œæ•´çš„å‰ç«¯è¯·æ±‚è·¯å¾„ï¼Œç¡®ä¿è·¯ç”±åŒ¹é…çš„æ­£ç¡®æ€§ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">ServerProperties</span> serverProperties<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºå¹¶æ³¨å†Œè‡ªå®šä¹‰è·¯ç”±å®šä½å™¨Bean
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>Beané…ç½®è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Bean</span></span><span class="token punctuation">}</span>æ³¨è§£å°†å…¶å£°æ˜ä¸ºSpring Bean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Primary</span></span><span class="token punctuation">}</span>æ³¨è§£ç¡®ä¿è¯¥Beanä¼˜å…ˆäºé»˜è®¤è·¯ç”±å®šä½å™¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>Beanåç§°ä¸º"routeLocator"ï¼Œä¸é»˜è®¤å®ç°ä¿æŒä¸€è‡´<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å‚æ•°ä¼ é€’ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>servletPath:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> ä»<span class="token punctuation">{</span><span class="token keyword keyword-@code">@code</span> <span class="token code-section"><span class="token code language-java">serverProperties<span class="token punctuation">.</span><span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>è·å–ï¼Œ
     *       ç¡®ä¿è·¯ç”±è·¯å¾„åŒ…å«æ­£ç¡®çš„ä¸Šä¸‹æ–‡å‰ç¼€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>zuulProperties:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span> ä¼ é€’Zuulå…¨å±€é…ç½®ï¼Œä½¿è‡ªå®šä¹‰å®šä½å™¨èƒ½å¤Ÿç»§æ‰¿é»˜è®¤è¡Œä¸º<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>æ›¿æ¢æœºåˆ¶ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>é€šè¿‡å£°æ˜åŒåä¸”æ ‡è®°ä¸º<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Primary</span></span><span class="token punctuation">}</span>çš„Beanï¼ŒSpringå®¹å™¨ä¼šä¼˜å…ˆä½¿ç”¨æ­¤è‡ªå®šä¹‰å®ç°ï¼Œ
     * ä»è€Œæ›¿æ¢Zuulé»˜è®¤çš„<span class="token punctuation">{</span><span class="token keyword keyword-@code">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span>SimpleRouteLocator</span></span></span><span class="token punctuation">}</span>ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@return">@return</span> é…ç½®å®Œæˆçš„è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨å®ä¾‹
     * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">SimpleRoutingLocater</span><span class="token punctuation">#</span><span class="token function">SimpleRoutingLocater</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">ZuulProperties</span><span class="token punctuation">)</span></span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">SimpleRouteLocator</span> <span class="token function">routeLocator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SimpleRoutingLocater</span><span class="token punctuation">(</span>serverProperties<span class="token punctuation">.</span><span class="token function">getServlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> zuulProperties<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="è·¯ç”±æ’é™¤">è·¯ç”±æ’é™¤ </h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è·¯ç”±æ’é™¤è®¾ç½®ä¸å…è®¸è¢«è®¿é—®çš„èµ„æºï¼Œå…è®¸è¢«è®¿é—®çš„èµ„æºå¯ä»¥é€šè¿‡è·¯ç”±è§„åˆ™è¿›è¡Œè®¾ç½®ã€‚</p>
<h4 id="url-åœ°å€æ’é™¤">URL åœ°å€æ’é™¤ </h4>
<pre data-role="codeBlock" data-info="yml" class="language-yaml yml"><code><span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">ignored-patterns</span><span class="token punctuation">:</span> /<span class="token important">**/order/**</span> <span class="token comment"># URL åœ°å€æ’é™¤ï¼Œæ’é™¤æ‰€æœ‰åŒ…å« /order/ çš„è¯·æ±‚ä¸ç»è¿‡ Zuul å¤„ç†</span>
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token key atrule">autumnnook-system</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /autumnnook<span class="token punctuation">-</span>system/<span class="token important">**</span>
    <span class="token key atrule">autumnnook-menu</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /autumnnook<span class="token punctuation">-</span>menu/<span class="token important">**</span>
</code></pre><h4 id="æœåŠ¡åç§°æ’é™¤">æœåŠ¡åç§°æ’é™¤ </h4>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">ignored-services</span><span class="token punctuation">:</span> autumnnook<span class="token punctuation">-</span>test <span class="token comment"># å¿½ç•¥çš„æœåŠ¡åˆ—è¡¨ï¼Œé¿å…å¯¹ç‰¹å®šæœåŠ¡è¿›è¡Œè·¯ç”±</span>
  <span class="token key atrule">routes</span><span class="token punctuation">:</span>
    <span class="token key atrule">autumnnook-system</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /autumnnook<span class="token punctuation">-</span>system/<span class="token important">**</span>
    <span class="token key atrule">autumnnook-menu</span><span class="token punctuation">:</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> /autumnnook<span class="token punctuation">-</span>menu/<span class="token important">**</span>
</code></pre><h3 id="è·¯ç”±å‰ç¼€">è·¯ç”±å‰ç¼€ </h3>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">prefix</span><span class="token punctuation">:</span> /api <span class="token comment"># å…¨å±€è·¯ç”±å‰ç¼€ï¼Œæ‰€æœ‰è¯·æ±‚è·¯å¾„å‰æ·»åŠ  /api</span>
  <span class="token comment"># ignored-services: autumnnook-test # å¿½ç•¥çš„æœåŠ¡åˆ—è¡¨ï¼Œé¿å…å¯¹ç‰¹å®šæœåŠ¡è¿›è¡Œè·¯ç”±</span>
  <span class="token comment"># routes:</span>
  <span class="token comment">#   autumnnook-system:</span>
  <span class="token comment">#     path: /autumnnook-system/**</span>
  <span class="token comment">#   autumnnook-menu:</span>
  <span class="token comment">#     path: /autumnnook-menu/**</span>
</code></pre><h2 id="ç½‘å…³è¿‡æ»¤å™¨">ç½‘å…³è¿‡æ»¤å™¨ </h2>
<img src="assets/image-20251221014048934.png" alt="image-20251221014048934" style="zoom:50%;">
<p>Zuul åŒ…å«äº†å¯¹è¯·æ±‚çš„è·¯ç”±å’Œè¿‡æ»¤ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå…¶ä¸­è·¯ç”±åŠŸèƒ½è´Ÿè´£å°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°å…·ä½“çš„å¾®æœåŠ¡å®ä¾‹ä¸Šï¼Œæ˜¯å®ç°å¤–éƒ¨è®¿é—®ç»Ÿä¸€å…¥å£çš„åŸºç¡€ã€‚è€Œè¿‡æ»¤å™¨åŠŸèƒ½åˆ™è´Ÿè´£å¯¹è¯·æ±‚çš„å¤„ç†è¿‡ç¨‹è¿›è¡Œå¹²é¢„ï¼Œæ˜¯æ˜¯å®ç°è¯·æ±‚æ ¡éªŒï¼ŒæœåŠ¡èšåˆç­‰åŠŸèƒ½çš„åŸºç¡€ã€‚ç„¶è€Œå®é™…ä¸Šï¼Œè·¯ç”±åŠŸèƒ½åœ¨çœŸæ­£è¿è¡Œæ—¶ï¼Œä»–çš„è·¯ç”±æ˜ å°„å’Œè¯·æ±‚è½¬å‘éƒ½æ˜¯ç”±å‡ ä¸ªä¸åŒçš„è¿‡æ»¤å™¨å®Œæˆçš„ã€‚</p>
<p>è·¯ç”±æ˜ å°„ä¸»è¦é€šè¿‡ <code>pre</code> ç±»å‹çš„è¿‡æ»¤å™¨å®Œæˆï¼Œå®ƒå°†è¯·æ±‚è·¯å¾„ä¸é…ç½®çš„è·¯ç”±è§„åˆ™è¿›è¡ŒåŒ¹é…ï¼Œä»¥æ‰¾åˆ°éœ€è¦è½¬å‘çš„ç›®æ ‡åœ°å€ã€‚è€Œè¯·æ±‚è½¬å‘çš„éƒ¨åˆ†åˆ™æ˜¯ç”± <code>routing</code> ç±»å‹çš„è¿‡æ»¤å™¨æ¥å®Œæˆï¼Œå¯¹ <code>pre</code> ç±»å‹çš„è¿‡æ»¤å™¨è·å¾—çš„è·¯ç”±åœ°å€è¿›è¡Œè½¬å‘ã€‚</p>
<p>æ‰€ä»¥è¯´ï¼Œè¿‡æ»¤å™¨æ˜¯ Zuul å®ç° API ç½‘å…³åŠŸèƒ½æœ€æ ¸å¿ƒçš„éƒ¨ä»¶ï¼Œæ¯ä¸€ä¸ªè¿›å…¥ Zuul çš„ HTTP è¯·æ±‚éƒ½ä¼šç»è¿‡ä¸€ç³»åˆ—çš„è¿‡æ»¤å™¨å¤„ç†é“¾å¾—åˆ°è¯·æ±‚å“åº”å¹¶è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<h3 id="å…³é”®åè¯">å…³é”®åè¯ </h3>
<p>Zuul ç½‘å…³ä½œä¸ºå¾®æœåŠ¡æµé‡çš„ç»Ÿä¸€å…¥å£ï¼Œå…¶æ ¸å¿ƒä»·å€¼å»ºç«‹åœ¨è¿‡æ»¤å™¨ã€è·¯ç”±ã€æœåŠ¡å‘ç°ç­‰åŸºç¡€æ¦‚å¿µä¹‹ä¸Šã€‚ç†è§£è¿™äº›å…³é”®åè¯ï¼Œæ˜¯æŒæ¡ç½‘å…³æ¶æ„è®¾è®¡çš„ç¬¬ä¸€è¯¾ã€‚</p>
<ul>
<li>ç±»å‹ï¼šå®šä¹‰è·¯ç”±è¿‡ç¨‹ä¸­åº”ç”¨è¿‡æ»¤å™¨çš„é˜¶æ®µï¼Œå…± <code>pre</code> ã€<code>routing</code>ã€<code>post</code>ã€<code>error</code> 4ä¸ªç±»å‹ï¼›</li>
<li>æ‰§è¡Œé¡ºåºï¼šåœ¨åŒç±»å‹ä¸­ï¼Œå®šä¹‰è¿‡æ»¤å™¨æ‰§è¡Œçš„é¡ºåºï¼Œæ¯”å¦‚å¤šä¸ª <code>pre</code> ç±»å‹è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼›</li>
<li>æ¡ä»¶ï¼šæ‰§è¡Œè¿‡æ»¤å™¨æ‰€éœ€è¦çš„æ¡ä»¶ï¼Œæ¯”å¦‚ <code>true</code> ä¸ºå¼€å¯ï¼Œ<code>false</code> ä¸ºå…³é—­ï¼›</li>
<li>åŠ¨ä½œï¼šå¦‚æœç¬¦åˆæ¡ä»¶ï¼Œå°†è¦æ‰§è¡Œçš„å…·ä½“æ“ä½œï¼›</li>
</ul>
<h3 id="è¿‡æ»¤å™¨ç±»å‹">è¿‡æ»¤å™¨ç±»å‹ </h3>
<p>Zuul çš„è¿‡æ»¤å™¨æ˜¯å…¶å®ç°ç½‘å…³åŠŸèƒ½çš„åŸºçŸ³ã€‚<code>PRE</code> ã€<code>ROUTING</code> ã€<code>POST</code> ã€<code>ERROR</code> å››ç±»è¿‡æ»¤å™¨æ„æˆå®Œæ•´çš„å¤„ç†é“¾æ¡ï¼Œæ¯ä¸ªç¯èŠ‚æ‰¿æ‹…ç€ä¸åŒçš„æµé‡æ²»ç†èŒè´£ã€‚</p>
<ul>
<li><code>pre</code>ï¼šè¯·æ±‚è¢«è·¯ç”±åˆ°æºæœåŠ¡å™¨ä¹‹å‰æ‰§è¡Œçš„è¿‡æ»¤å™¨ï¼Œå¯ä»¥ç§°ä¸ºå‰ç½®è¿‡æ»¤å™¨ã€‚ä¸»è¦æ‰¿æ‹… <strong>èº«ä»½è®¤è¯</strong>ã€<strong>è·¯ç”±</strong>ã€<strong>è¯·æ±‚æ—¥å¿—</strong>ã€‚</li>
<li><code>routing</code>ï¼šå¤„ç†å°†è¯·æ±‚å‘é€åˆ°æºæœåŠ¡å™¨çš„è¿‡æ»¤å™¨ï¼›</li>
<li><code>post</code>ï¼šå“åº”ä»æºæœåŠ¡å™¨è¿”å›æ—¶æ‰§è¡Œçš„è¿‡æ»¤å™¨ã€‚ä¸»è¦æ‰¿æ‹… <strong>å¯¹å“åº”å¢åŠ  HTTP å¤´</strong>ã€<strong>æ”¶é›†ç»Ÿè®¡å’Œåº¦é‡æŒ‡æ ‡</strong>ã€<strong>å°†å“åº”ä»¥æµçš„æ–¹å¼å‘é€å›å®¢æˆ·ç«¯</strong>ï¼›</li>
<li><code>error</code>ï¼šä¸Šè¿°é˜¶æ®µä¸­å‡ºç°é”™è¯¯æ—¶æ‰§è¡Œçš„è¿‡æ»¤å™¨ï¼›</li>
</ul>
<h3 id="è¿‡æ»¤å™¨å…¥é—¨æ¡ˆä¾‹">è¿‡æ»¤å™¨å…¥é—¨æ¡ˆä¾‹ </h3>
<h4 id="åˆ›å»ºè¿‡æ»¤å™¨">åˆ›å»ºè¿‡æ»¤å™¨ </h4>
<p>Spring Cloud Netflix Zuul ä¸­å®ç°è¿‡æ»¤å™¨å¿…é¡»åŒ…å« 4 ä¸ªåŸºæœ¬ç‰¹å¾ï¼š</p>
<ul>
<li>è¿‡æ»¤å™¨ç±»å‹</li>
<li>æ‰§è¡Œé¡ºåº</li>
<li>æ‰§è¡Œæ¡ä»¶</li>
<li>åŠ¨ä½œï¼ˆå…·ä½“æ“ä½œï¼‰</li>
</ul>
<p>è¿™äº›æ­¥éª¤éƒ½æ˜¯ ZuulFilter æ¥å£ä¸­å®šä¹‰çš„ 4 ä¸ªæŠ½è±¡æ–¹æ³•ï¼š</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">ZuulFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">RequestContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ZuulException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * è‡ªå®šä¹‰ Zuul ç½‘å…³è¿‡æ»¤å™¨
 * ä½œç”¨ï¼šå®ç°è¯·æ±‚çº§åˆ«çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æƒé™éªŒè¯ã€å‚æ•°æ ¡éªŒç­‰ ç”Ÿå‘½å‘¨æœŸï¼šåœ¨è¯·æ±‚ç»è¿‡ Zuul ç½‘å…³æ—¶è¢«è°ƒç”¨ï¼ŒæŒ‰ç…§è¿‡æ»¤å™¨ç±»å‹å’Œé¡ºåºæ‰§è¡Œ
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 */</span>
<span class="token annotation punctuation">@Component</span>  <span class="token comment">// å£°æ˜ä¸º Spring ç»„ä»¶ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ° Spring å®¹å™¨</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">CustomZuulFilter</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">ZuulFilter</span> <span class="token punctuation">{</span>

    <span class="token comment">// æ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºè¾“å‡ºè¿‡æ»¤å™¨æ‰§è¡Œä¿¡æ¯</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">CustomZuulFilter</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨ç±»å‹å®šä¹‰
     * è¿”å›å€¼å¿…é¡»æ˜¯ä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š - "pre":    å‰ç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹å‰æ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šèº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€é™æµç­‰ - "route":  è·¯ç”±è¿‡æ»¤å™¨ï¼Œè´Ÿè´£å°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡ å…¸å‹ç”¨é€”ï¼šHTTPè¯·æ±‚è½¬å‘ã€æœåŠ¡å‘ç°é›†æˆ
     * - "post":   åç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹åæ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šå“åº”å¤´ä¿®æ”¹ã€ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ã€æ—¥å¿—è®°å½• - "error":  é”™è¯¯è¿‡æ»¤å™¨ï¼Œå½“è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šé”™è¯¯å¤„ç†ã€å¼‚å¸¸å“åº”æ ¼å¼åŒ–
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨ç±»å‹å­—ç¬¦ä¸²
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">filterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"pre"</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰è¿‡æ»¤å™¨ä¸ºå‰ç½®è¿‡æ»¤å™¨</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
     * ä½œç”¨ï¼šå½“æœ‰å¤šä¸ªåŒç±»å‹è¿‡æ»¤å™¨æ—¶ï¼Œç¡®å®šå®ƒä»¬çš„æ‰§è¡Œé¡ºåº è§„åˆ™ï¼šæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œè¶Šé å‰ èŒƒå›´ï¼šå¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œé€šå¸¸ä½¿ç”¨ 0, 1, 2, ... ç­‰
     * ç¤ºä¾‹ï¼š - è®¤è¯è¿‡æ»¤å™¨ï¼šorder = 0ï¼ˆæœ€å…ˆæ‰§è¡Œï¼ŒéªŒè¯èº«ä»½ï¼‰ - æ—¥å¿—è¿‡æ»¤å™¨ï¼šorder = 1ï¼ˆå…¶æ¬¡æ‰§è¡Œï¼Œè®°å½•è¯·æ±‚ï¼‰ - å‚æ•°æ ¡éªŒè¿‡æ»¤å™¨ï¼šorder = 2ï¼ˆæœ€åæ‰§è¡Œï¼Œæ ¡éªŒå‚æ•°ï¼‰
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºçš„æ•´æ•°å€¼
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-int">int</span> <span class="token function">filterOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">// æœ€é«˜ä¼˜å…ˆçº§ï¼Œæœ€å…ˆæ‰§è¡Œ</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ˜¯å¦å¯ç”¨è¯¥è¿‡æ»¤å™¨
     * ä½œç”¨ï¼šåŠ¨æ€æ§åˆ¶è¿‡æ»¤å™¨æ˜¯å¦æ‰§è¡Œ è¿”å›å€¼ï¼š - true:  æ‰§è¡Œè¯¥è¿‡æ»¤å™¨çš„ run() æ–¹æ³• - false: è·³è¿‡è¯¥è¿‡æ»¤å™¨ï¼Œä¸æ‰§è¡Œ run() æ–¹æ³•
     * åº”ç”¨åœºæ™¯ï¼š 1. æ ¹æ®è¯·æ±‚è·¯å¾„å†³å®šæ˜¯å¦æ‰§è¡Œï¼ˆå¦‚åªå¯¹ /api/** è·¯å¾„ç”Ÿæ•ˆï¼‰ 2. æ ¹æ®é…ç½®å¼€å…³åŠ¨æ€å¯ç”¨/ç¦ç”¨è¿‡æ»¤å™¨ 3. æ ¹æ®è¯·æ±‚å¤´æˆ–å‚æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦è¿‡æ»¤
     *
     * <span class="token keyword keyword-@return">@return</span> å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰§è¡Œè¯¥è¿‡æ»¤å™¨
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-boolean">boolean</span> <span class="token function">shouldFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// å§‹ç»ˆæ‰§è¡Œæ­¤è¿‡æ»¤å™¨</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
     * ä½œç”¨ï¼šå®ç°å…·ä½“çš„è¿‡æ»¤å¤„ç†é€»è¾‘ æ‰§è¡Œæ—¶æœºï¼šå½“ shouldFilter() è¿”å› true æ—¶è¢«è°ƒç”¨
     * å…³é”®å¯¹è±¡ï¼š 1. RequestContext: Zuul è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨è¯·æ±‚/å“åº”ä¿¡æ¯ 2. HttpServletRequest: åŸå§‹ HTTP è¯·æ±‚å¯¹è±¡
     * å¸¸ç”¨æ“ä½œï¼š 1. è·å–è¯·æ±‚ä¿¡æ¯ï¼šURLã€æ–¹æ³•ã€å¤´ä¿¡æ¯ã€å‚æ•°ç­‰ 2. ä¿®æ”¹è¯·æ±‚ï¼šæ·»åŠ /åˆ é™¤è¯·æ±‚å¤´ã€ä¿®æ”¹è¯·æ±‚å‚æ•° 3. ä¸­æ–­è¯·æ±‚ï¼šè®¾ç½® context.setSendZuulResponse(false) é˜»æ­¢è½¬å‘ 4.
     * è®¾ç½®å“åº”ï¼šç›´æ¥è¿”å›å“åº”ï¼Œä¸è½¬å‘åˆ°åç«¯æœåŠ¡
     *
     * <span class="token keyword keyword-@return">@return</span> é€šå¸¸è¿”å› nullï¼Œç‰¹æ®Šæƒ…å†µä¸‹å¯è¿”å›ä»»æ„å¯¹è±¡
     * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">ZuulException</span></span> å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">ZuulException</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡</span>
        <span class="token comment">// RequestContext æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå­˜å‚¨äº†æ•´ä¸ªè¯·æ±‚é“¾è·¯çš„å…±äº«æ•°æ®</span>
        <span class="token class-name">RequestContext</span> context <span class="token operator">=</span> <span class="token class-name">RequestContext</span><span class="token punctuation">.</span><span class="token function">getCurrentContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä»ä¸Šä¸‹æ–‡ä¸­è·å–åŸå§‹çš„ HTTP è¯·æ±‚å¯¹è±¡</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è®°å½•è¯·æ±‚æ—¥å¿—ï¼šåŒ…å«è¯·æ±‚æ–¹æ³•å’Œå®Œæ•´URL</span>
        <span class="token comment">// å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯æ·»åŠ æ›´å¤šä¿¡æ¯ï¼šå®¢æˆ·ç«¯IPã€ç”¨æˆ·IDã€è¯·æ±‚æ—¶é—´ç­‰</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"CustomZuulFilter: {} request to {}"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// è¯·æ±‚æ–¹æ³•ï¼šGET/POST/PUT/DELETEç­‰</span>
            request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¯·æ±‚çš„å®Œæ•´URL</span>

        <span class="token comment">// å¯åœ¨æ­¤å¤„æ·»åŠ æ›´å¤šä¸šåŠ¡é€»è¾‘ï¼š</span>
        <span class="token comment">// 1. èº«ä»½éªŒè¯ï¼šæ£€æŸ¥Tokenæˆ–Session</span>
        <span class="token comment">// 2. æƒé™æ ¡éªŒï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®è¯¥æ¥å£</span>
        <span class="token comment">// 3. å‚æ•°æ ¡éªŒï¼šæ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦åˆæ³•</span>
        <span class="token comment">// 4. é™æµæ£€æŸ¥ï¼šåˆ¤æ–­æ˜¯å¦è¶…è¿‡è®¿é—®é¢‘ç‡é™åˆ¶</span>
        <span class="token comment">// 5. è¯·æ±‚ä¿®æ”¹ï¼šæ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´</span>

        <span class="token comment">// ç¤ºä¾‹ï¼šæ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´</span>
        <span class="token comment">// context.addZuulRequestHeader("X-Custom-Header", "CustomValue");</span>

        <span class="token comment">// ç¤ºä¾‹ï¼šä¸­æ–­è¯·æ±‚å¹¶è¿”å›è‡ªå®šä¹‰å“åº”</span>
        <span class="token comment">// if (!isValidRequest(request)) {</span>
        <span class="token comment">//     context.setSendZuulResponse(false);  // ä¸è½¬å‘åˆ°åç«¯æœåŠ¡</span>
        <span class="token comment">//     context.setResponseStatusCode(401);  // è®¾ç½®å“åº”çŠ¶æ€ç </span>
        <span class="token comment">//     context.setResponseBody("Unauthorized");  // è®¾ç½®å“åº”ä½“</span>
        <span class="token comment">// }</span>

        <span class="token comment">// è¿”å› null è¡¨ç¤ºè¿‡æ»¤å™¨æ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œç»§ç»­åç»­å¤„ç†</span>
        <span class="token comment">// å¦‚æœè¿”å›énullå¯¹è±¡ï¼Œå¯èƒ½ä¼šå½±å“è¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œï¼ˆæ ¹æ®å…·ä½“å®ç°ï¼‰</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¾…åŠ©æ–¹æ³•ç¤ºä¾‹ï¼šéªŒè¯è¯·æ±‚æ˜¯å¦åˆæ³• ï¼ˆå®é™…ä½¿ç”¨æ—¶æ ¹æ®éœ€æ±‚å®ç°ï¼‰
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">request</span> HTTPè¯·æ±‚å¯¹è±¡
     * <span class="token keyword keyword-@return">@return</span> è¯·æ±‚æ˜¯å¦åˆæ³•
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-boolean">boolean</span> <span class="token function">isValidRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¤ºä¾‹éªŒè¯é€»è¾‘ï¼š</span>
        <span class="token comment">// 1. æ£€æŸ¥å¿…è¦çš„è¯·æ±‚å¤´æ˜¯å¦å­˜åœ¨</span>
        <span class="token comment">// 2. éªŒè¯Tokenæˆ–ç­¾å</span>
        <span class="token comment">// 3. æ£€æŸ¥è¯·æ±‚é¢‘ç‡</span>
        <span class="token comment">// 4. éªŒè¯å‚æ•°æ ¼å¼</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// é»˜è®¤è¿”å›trueï¼Œå®é™…åº”æ ¹æ®ä¸šåŠ¡é€»è¾‘å®ç°</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><p>é‡å¯ç½‘å…³æœåŠ¡ï¼Œæµ‹è¯•ä¸Šé¢æˆ‘ä»¬çš„è¯·æ±‚ï¼Œç„¶åè§‚å¯Ÿæ§åˆ¶å°æ‰“å°è¾“å‡ºã€‚</p>
<p><img src="assets/image-20251222152348039.png" alt="image-20251222152348039"></p>
<h3 id="ç»Ÿä¸€é‰´æƒ">ç»Ÿä¸€é‰´æƒ </h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ç½‘å…³è¿‡æ»¤å™¨ä¸­é€šè¿‡ Token åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå®Œæˆä¸€ä¸ªç»Ÿä¸€é‰´æƒæ¡ˆä¾‹ã€‚</p>
<h4 id="åˆ›å»ºè¿‡æ»¤å™¨-1">åˆ›å»ºè¿‡æ»¤å™¨ </h4>
<p>åˆ›å»ºä¸€ä¸ªåä¸º AccessFilter çš„è¿‡æ»¤å™¨ï¼Œç»§æ‰¿è‡ª ZuulFilter ç±»ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">ZuulFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">RequestContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ZuulException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * è‡ªå®šä¹‰ Zuul ç½‘å…³è¿‡æ»¤å™¨
 * ä½œç”¨ï¼šå®ç°è¯·æ±‚çº§åˆ«çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æƒé™éªŒè¯ã€å‚æ•°æ ¡éªŒç­‰ ç”Ÿå‘½å‘¨æœŸï¼šåœ¨è¯·æ±‚ç»è¿‡ Zuul ç½‘å…³æ—¶è¢«è°ƒç”¨ï¼ŒæŒ‰ç…§è¿‡æ»¤å™¨ç±»å‹å’Œé¡ºåºæ‰§è¡Œ
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 */</span>
<span class="token annotation punctuation">@Component</span>  <span class="token comment">// å£°æ˜ä¸º Spring ç»„ä»¶ï¼Œè‡ªåŠ¨æ³¨å†Œåˆ° Spring å®¹å™¨</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">AccessFilter</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">ZuulFilter</span> <span class="token punctuation">{</span>

    <span class="token comment">// æ—¥å¿—è®°å½•å™¨ï¼Œç”¨äºè¾“å‡ºè¿‡æ»¤å™¨æ‰§è¡Œä¿¡æ¯</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">AccessFilter</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨ç±»å‹å®šä¹‰
     * è¿”å›å€¼å¿…é¡»æ˜¯ä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š - "pre":    å‰ç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹å‰æ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šèº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€é™æµç­‰ - "route":  è·¯ç”±è¿‡æ»¤å™¨ï¼Œè´Ÿè´£å°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡ å…¸å‹ç”¨é€”ï¼šHTTPè¯·æ±‚è½¬å‘ã€æœåŠ¡å‘ç°é›†æˆ
     * - "post":   åç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹åæ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šå“åº”å¤´ä¿®æ”¹ã€ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ã€æ—¥å¿—è®°å½• - "error":  é”™è¯¯è¿‡æ»¤å™¨ï¼Œå½“è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šé”™è¯¯å¤„ç†ã€å¼‚å¸¸å“åº”æ ¼å¼åŒ–
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨ç±»å‹å­—ç¬¦ä¸²
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">filterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"pre"</span><span class="token punctuation">;</span>  <span class="token comment">// å½“å‰è¿‡æ»¤å™¨ä¸ºå‰ç½®è¿‡æ»¤å™¨</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
     * ä½œç”¨ï¼šå½“æœ‰å¤šä¸ªåŒç±»å‹è¿‡æ»¤å™¨æ—¶ï¼Œç¡®å®šå®ƒä»¬çš„æ‰§è¡Œé¡ºåº è§„åˆ™ï¼šæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œè¶Šé å‰ èŒƒå›´ï¼šå¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œé€šå¸¸ä½¿ç”¨ 0, 1, 2, ... ç­‰
     * ç¤ºä¾‹ï¼š - è®¤è¯è¿‡æ»¤å™¨ï¼šorder = 0ï¼ˆæœ€å…ˆæ‰§è¡Œï¼ŒéªŒè¯èº«ä»½ï¼‰ - æ—¥å¿—è¿‡æ»¤å™¨ï¼šorder = 1ï¼ˆå…¶æ¬¡æ‰§è¡Œï¼Œè®°å½•è¯·æ±‚ï¼‰ - å‚æ•°æ ¡éªŒè¿‡æ»¤å™¨ï¼šorder = 2ï¼ˆæœ€åæ‰§è¡Œï¼Œæ ¡éªŒå‚æ•°ï¼‰
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºçš„æ•´æ•°å€¼
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-int">int</span> <span class="token function">filterOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// æœ€é«˜ä¼˜å…ˆçº§ï¼Œæœ€å…ˆæ‰§è¡Œ</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ˜¯å¦å¯ç”¨è¯¥è¿‡æ»¤å™¨
     * ä½œç”¨ï¼šåŠ¨æ€æ§åˆ¶è¿‡æ»¤å™¨æ˜¯å¦æ‰§è¡Œ è¿”å›å€¼ï¼š - true:  æ‰§è¡Œè¯¥è¿‡æ»¤å™¨çš„ run() æ–¹æ³• - false: è·³è¿‡è¯¥è¿‡æ»¤å™¨ï¼Œä¸æ‰§è¡Œ run() æ–¹æ³•
     * åº”ç”¨åœºæ™¯ï¼š 1. æ ¹æ®è¯·æ±‚è·¯å¾„å†³å®šæ˜¯å¦æ‰§è¡Œï¼ˆå¦‚åªå¯¹ /api/** è·¯å¾„ç”Ÿæ•ˆï¼‰ 2. æ ¹æ®é…ç½®å¼€å…³åŠ¨æ€å¯ç”¨/ç¦ç”¨è¿‡æ»¤å™¨ 3. æ ¹æ®è¯·æ±‚å¤´æˆ–å‚æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦è¿‡æ»¤
     *
     * <span class="token keyword keyword-@return">@return</span> å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰§è¡Œè¯¥è¿‡æ»¤å™¨
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-boolean">boolean</span> <span class="token function">shouldFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// å§‹ç»ˆæ‰§è¡Œæ­¤è¿‡æ»¤å™¨</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
     * ä½œç”¨ï¼šå®ç°å…·ä½“çš„è¿‡æ»¤å¤„ç†é€»è¾‘ æ‰§è¡Œæ—¶æœºï¼šå½“ shouldFilter() è¿”å› true æ—¶è¢«è°ƒç”¨
     * å…³é”®å¯¹è±¡ï¼š 1. RequestContext: Zuul è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨è¯·æ±‚/å“åº”ä¿¡æ¯ 2. HttpServletRequest: åŸå§‹ HTTP è¯·æ±‚å¯¹è±¡
     * å¸¸ç”¨æ“ä½œï¼š 1. è·å–è¯·æ±‚ä¿¡æ¯ï¼šURLã€æ–¹æ³•ã€å¤´ä¿¡æ¯ã€å‚æ•°ç­‰ 2. ä¿®æ”¹è¯·æ±‚ï¼šæ·»åŠ /åˆ é™¤è¯·æ±‚å¤´ã€ä¿®æ”¹è¯·æ±‚å‚æ•° 3. ä¸­æ–­è¯·æ±‚ï¼šè®¾ç½® context.setSendZuulResponse(false) é˜»æ­¢è½¬å‘ 4.
     * è®¾ç½®å“åº”ï¼šç›´æ¥è¿”å›å“åº”ï¼Œä¸è½¬å‘åˆ°åç«¯æœåŠ¡
     *
     * <span class="token keyword keyword-@return">@return</span> é€šå¸¸è¿”å› nullï¼Œç‰¹æ®Šæƒ…å†µä¸‹å¯è¿”å›ä»»æ„å¯¹è±¡
     * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">ZuulException</span></span> å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">ZuulException</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–å½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡å¯¹è±¡</span>
        <span class="token comment">// RequestContext æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå­˜å‚¨äº†æ•´ä¸ªè¯·æ±‚é“¾è·¯çš„å…±äº«æ•°æ®</span>
        <span class="token class-name">RequestContext</span> context <span class="token operator">=</span> <span class="token class-name">RequestContext</span><span class="token punctuation">.</span><span class="token function">getCurrentContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä»ä¸Šä¸‹æ–‡ä¸­è·å–åŸå§‹çš„ HTTP è¯·æ±‚å¯¹è±¡</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è®°å½•è¯·æ±‚æ—¥å¿—ï¼šåŒ…å«è¯·æ±‚æ–¹æ³•å’Œå®Œæ•´URL</span>
        <span class="token comment">// å®é™…ç”Ÿäº§ç¯å¢ƒä¸­å¯æ·»åŠ æ›´å¤šä¿¡æ¯ï¼šå®¢æˆ·ç«¯IPã€ç”¨æˆ·IDã€è¯·æ±‚æ—¶é—´ç­‰</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AccessFilter: {} request to {}"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">// è¯·æ±‚æ–¹æ³•ï¼šGET/POST/PUT/DELETEç­‰</span>
            request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è¯·æ±‚çš„å®Œæ•´URL</span>

        <span class="token comment">// å¯åœ¨æ­¤å¤„æ·»åŠ æ›´å¤šä¸šåŠ¡é€»è¾‘ï¼š</span>
        <span class="token comment">// 1. èº«ä»½éªŒè¯ï¼šæ£€æŸ¥Tokenæˆ–Session</span>
        <span class="token comment">// 2. æƒé™æ ¡éªŒï¼šéªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒè®¿é—®è¯¥æ¥å£</span>
        <span class="token comment">// 3. å‚æ•°æ ¡éªŒï¼šæ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦åˆæ³•</span>
        <span class="token comment">// 4. é™æµæ£€æŸ¥ï¼šåˆ¤æ–­æ˜¯å¦è¶…è¿‡è®¿é—®é¢‘ç‡é™åˆ¶</span>
        <span class="token comment">// 5. è¯·æ±‚ä¿®æ”¹ï¼šæ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´</span>
        <span class="token class-name">String</span> token <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>token <span class="token operator">==</span> <span class="token keyword keyword-null">null</span> <span class="token operator">||</span> token<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"AccessFilter: Missing token parameter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            context<span class="token punctuation">.</span><span class="token function">setSendZuulResponse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸è½¬å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡</span>
            context<span class="token punctuation">.</span><span class="token function">setResponseStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_UNAUTHORIZED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®¾ç½®å“åº”çŠ¶æ€ç ä¸º 401 æœªæˆæƒ</span>
            context<span class="token punctuation">.</span><span class="token function">setResponseBody</span><span class="token punctuation">(</span><span class="token string">"Unauthorized: Missing token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®¾ç½®å“åº”ä½“å†…å®¹</span>
            <span class="token comment">// return null;  // ç»“æŸè¿‡æ»¤å™¨æ‰§è¡Œ</span>
            context<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
            <span class="token keyword keyword-try">try</span><span class="token punctuation">{</span>
                writer <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"{\"code\":401,\"message\":\"Unauthorized: Missing token\"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span><span class="token punctuation">{</span>
                ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
                <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-null">null</span> <span class="token operator">!=</span> writer<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword keyword-else">else</span><span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"AccessFilter: Valid token received"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ç¤ºä¾‹ï¼šæ·»åŠ è‡ªå®šä¹‰è¯·æ±‚å¤´</span>
        <span class="token comment">// context.addZuulRequestHeader("X-Custom-Header", "CustomValue");</span>

        <span class="token comment">// ç¤ºä¾‹ï¼šä¸­æ–­è¯·æ±‚å¹¶è¿”å›è‡ªå®šä¹‰å“åº”</span>
        <span class="token comment">// if (!isValidRequest(request)) {</span>
        <span class="token comment">//     context.setSendZuulResponse(false);  // ä¸è½¬å‘åˆ°åç«¯æœåŠ¡</span>
        <span class="token comment">//     context.setResponseStatusCode(401);  // è®¾ç½®å“åº”çŠ¶æ€ç </span>
        <span class="token comment">//     context.setResponseBody("Unauthorized");  // è®¾ç½®å“åº”ä½“</span>
        <span class="token comment">// }</span>

        <span class="token comment">// è¿”å› null è¡¨ç¤ºè¿‡æ»¤å™¨æ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œç»§ç»­åç»­å¤„ç†</span>
        <span class="token comment">// å¦‚æœè¿”å›énullå¯¹è±¡ï¼Œå¯èƒ½ä¼šå½±å“è¿‡æ»¤å™¨é“¾çš„æ‰§è¡Œï¼ˆæ ¹æ®å…·ä½“å®ç°ï¼‰</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¾…åŠ©æ–¹æ³•ç¤ºä¾‹ï¼šéªŒè¯è¯·æ±‚æ˜¯å¦åˆæ³• ï¼ˆå®é™…ä½¿ç”¨æ—¶æ ¹æ®éœ€æ±‚å®ç°ï¼‰
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">request</span> HTTPè¯·æ±‚å¯¹è±¡
     * <span class="token keyword keyword-@return">@return</span> è¯·æ±‚æ˜¯å¦åˆæ³•
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-boolean">boolean</span> <span class="token function">isValidRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç¤ºä¾‹éªŒè¯é€»è¾‘ï¼š</span>
        <span class="token comment">// 1. æ£€æŸ¥å¿…è¦çš„è¯·æ±‚å¤´æ˜¯å¦å­˜åœ¨</span>
        <span class="token comment">// 2. éªŒè¯Tokenæˆ–ç­¾å</span>
        <span class="token comment">// 3. æ£€æŸ¥è¯·æ±‚é¢‘ç‡</span>
        <span class="token comment">// 4. éªŒè¯å‚æ•°æ ¼å¼</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// é»˜è®¤è¿”å›trueï¼Œå®é™…åº”æ ¹æ®ä¸šåŠ¡é€»è¾‘å®ç°</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>é‡å¯ç½‘å…³æœåŠ¡ï¼Œæµ‹è¯•ä¸Šé¢æˆ‘ä»¬çš„è¯·æ±‚ï¼Œç„¶åè§‚å¯Ÿæ§åˆ¶å°æ‰“å°åŠé¡µé¢è¾“å‡ºã€‚</p>
<p><img src="assets/image-20251222153615574.png" alt="image-20251222153615574"></p>
<p><img src="assets/image-20251222153753154.png" alt="image-20251222153753154"></p>
<h2 id="zuul-è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ">Zuul è¯·æ±‚ç”Ÿå‘½å‘¨æœŸ </h2>
<img src="assets/image-20251222153856735.png" alt="image-20251222153856735" style="zoom:50%;">
<p>ç”Ÿå‘½å‘¨æœŸæ­¥éª¤åˆ†æï¼š</p>
<ol>
<li>HTTP å‘é€è¯·æ±‚è‡³ Zuul ç½‘å…³ï¼›</li>
<li>Zuul ç½‘å…³é¦–å…ˆç»è¿‡ pre filter ï¼ŒéªŒè¯é€šè¿‡åè¿›å…¥ routing filterï¼›</li>
<li>æ¥ç€å°†è¯·æ±‚è½¬å‘ç»™è¿œç¨‹æœåŠ¡ï¼Œè¿œç¨‹æœåŠ¡æ‰§è¡Œå®Œè¿”å›ç»“æœï¼Œå¦‚æœå‡ºé”™ï¼Œåˆ™æ‰§è¡Œ error filterï¼›</li>
<li>æœªå‡ºé”™åˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œ post filterï¼›</li>
<li>æœ€åè¿”å›å“åº”ç»™ HTTP å®¢æˆ·ç«¯ï¼›</li>
</ol>
<h2 id="ç½‘å…³è¿‡æ»¤å™¨å¼‚å¸¸ç»Ÿä¸€å¤„ç†">ç½‘å…³è¿‡æ»¤å™¨å¼‚å¸¸ç»Ÿä¸€å¤„ç† </h2>
<h3 id="åˆ›å»ºè¿‡æ»¤å™¨-2">åˆ›å»ºè¿‡æ»¤å™¨ </h3>
<p>åˆ›å»ºä¸€ä¸ªåä¸º ErrorFilter çš„è¿‡æ»¤å™¨ï¼Œç»§æ‰¿è‡ª ZuulFilter ç±»ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">ZuulFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">RequestContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ZuulException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * è‡ªå®šä¹‰ Zuul ç½‘å…³è¿‡æ»¤å™¨ ä½œç”¨ï¼šå®ç°è¯·æ±‚çº§åˆ«çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æƒé™éªŒè¯ã€å‚æ•°æ ¡éªŒç­‰ ç”Ÿå‘½å‘¨æœŸï¼šåœ¨è¯·æ±‚ç»è¿‡ Zuul ç½‘å…³æ—¶è¢«è°ƒç”¨ï¼ŒæŒ‰ç…§è¿‡æ»¤å™¨ç±»å‹å’Œé¡ºåºæ‰§è¡Œ
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ErrorFilter</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">ZuulFilter</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ErrorFilter</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨ç±»å‹å®šä¹‰ è¿”å›å€¼å¿…é¡»æ˜¯ä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š - "pre":    å‰ç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹å‰æ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šèº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€é™æµç­‰ - "route":  è·¯ç”±è¿‡æ»¤å™¨ï¼Œè´Ÿè´£å°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡
     * å…¸å‹ç”¨é€”ï¼šHTTPè¯·æ±‚è½¬å‘ã€æœåŠ¡å‘ç°é›†æˆ - "post":   åç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹åæ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šå“åº”å¤´ä¿®æ”¹ã€ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ã€æ—¥å¿—è®°å½• - "error":  é”™è¯¯è¿‡æ»¤å™¨ï¼Œå½“è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œ
     * å…¸å‹ç”¨é€”ï¼šé”™è¯¯å¤„ç†ã€å¼‚å¸¸å“åº”æ ¼å¼åŒ–
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨ç±»å‹å­—ç¬¦ä¸²
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">filterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"error"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº ä½œç”¨ï¼šå½“æœ‰å¤šä¸ªåŒç±»å‹è¿‡æ»¤å™¨æ—¶ï¼Œç¡®å®šå®ƒä»¬çš„æ‰§è¡Œé¡ºåº è§„åˆ™ï¼šæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œè¶Šé å‰ èŒƒå›´ï¼šå¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œé€šå¸¸ä½¿ç”¨ 0, 1, 2, ... ç­‰ ç¤ºä¾‹ï¼š - è®¤è¯è¿‡æ»¤å™¨ï¼šorder = 0ï¼ˆæœ€å…ˆæ‰§è¡Œï¼ŒéªŒè¯èº«ä»½ï¼‰ -
     * æ—¥å¿—è¿‡æ»¤å™¨ï¼šorder = 1ï¼ˆå…¶æ¬¡æ‰§è¡Œï¼Œè®°å½•è¯·æ±‚ï¼‰ - å‚æ•°æ ¡éªŒè¿‡æ»¤å™¨ï¼šorder = 2ï¼ˆæœ€åæ‰§è¡Œï¼Œæ ¡éªŒå‚æ•°ï¼‰
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºçš„æ•´æ•°å€¼
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-int">int</span> <span class="token function">filterOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ˜¯å¦å¯ç”¨è¯¥è¿‡æ»¤å™¨ ä½œç”¨ï¼šåŠ¨æ€æ§åˆ¶è¿‡æ»¤å™¨æ˜¯å¦æ‰§è¡Œ è¿”å›å€¼ï¼š - true:  æ‰§è¡Œè¯¥è¿‡æ»¤å™¨çš„ run() æ–¹æ³• - false: è·³è¿‡è¯¥è¿‡æ»¤å™¨ï¼Œä¸æ‰§è¡Œ run() æ–¹æ³• åº”ç”¨åœºæ™¯ï¼š 1. æ ¹æ®è¯·æ±‚è·¯å¾„å†³å®šæ˜¯å¦æ‰§è¡Œï¼ˆå¦‚åªå¯¹ /api/**
     * è·¯å¾„ç”Ÿæ•ˆï¼‰ 2. æ ¹æ®é…ç½®å¼€å…³åŠ¨æ€å¯ç”¨/ç¦ç”¨è¿‡æ»¤å™¨ 3. æ ¹æ®è¯·æ±‚å¤´æˆ–å‚æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦è¿‡æ»¤
     *
     * <span class="token keyword keyword-@return">@return</span> å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰§è¡Œè¯¥è¿‡æ»¤å™¨
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-boolean">boolean</span> <span class="token function">shouldFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ä½œç”¨ï¼šå®ç°å…·ä½“çš„è¿‡æ»¤å¤„ç†é€»è¾‘ æ‰§è¡Œæ—¶æœºï¼šå½“ shouldFilter() è¿”å› true æ—¶è¢«è°ƒç”¨ å…³é”®å¯¹è±¡ï¼š 1. RequestContext: Zuul è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨è¯·æ±‚/å“åº”ä¿¡æ¯ 2.
     * HttpServletRequest: åŸå§‹ HTTP è¯·æ±‚å¯¹è±¡ å¸¸ç”¨æ“ä½œï¼š 1. è·å–è¯·æ±‚ä¿¡æ¯ï¼šURLã€æ–¹æ³•ã€å¤´ä¿¡æ¯ã€å‚æ•°ç­‰ 2. ä¿®æ”¹è¯·æ±‚ï¼šæ·»åŠ /åˆ é™¤è¯·æ±‚å¤´ã€ä¿®æ”¹è¯·æ±‚å‚æ•° 3. ä¸­æ–­è¯·æ±‚ï¼šè®¾ç½®
     * context.setSendZuulResponse(false) é˜»æ­¢è½¬å‘ 4. è®¾ç½®å“åº”ï¼šç›´æ¥è¿”å›å“åº”ï¼Œä¸è½¬å‘åˆ°åç«¯æœåŠ¡
     *
     * <span class="token keyword keyword-@return">@return</span> é€šå¸¸è¿”å› nullï¼Œç‰¹æ®Šæƒ…å†µä¸‹å¯è¿”å›ä»»æ„å¯¹è±¡
     * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">ZuulException</span></span> å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">ZuulException</span> <span class="token punctuation">{</span>
        <span class="token class-name">RequestContext</span> context <span class="token operator">=</span> <span class="token class-name">RequestContext</span><span class="token punctuation">.</span><span class="token function">getCurrentContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ErrorFilter: {} request to {}"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setSendZuulResponse</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setResponseStatusCode</span><span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">setResponseBody</span><span class="token punctuation">(</span><span class="token string">"Unauthorized: Missing token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
            writer <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"{\"code\":500,\"message\":\"æœåŠ¡å™¨å¼‚å¸¸\"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-null">null</span> <span class="token operator">!=</span> writer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><h3 id="æ¨¡æ‹Ÿå¼‚å¸¸">æ¨¡æ‹Ÿå¼‚å¸¸ </h3>
<p>åœ¨ pre è¿‡æ»¤å™¨ä¸­æ·»åŠ æ¨¡æ‹Ÿå¼‚å¸¸ä»£ç ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-int">int</span> r <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre><h3 id="é…ç½®å¼‚å¸¸è¿‡æ»¤å™¨">é…ç½®å¼‚å¸¸è¿‡æ»¤å™¨ </h3>
<p>ç¦ç”¨ Zuul é»˜è®¤çš„å¼‚å¸¸å¤„ç† filterï¼š<code>SendErrorFilter</code></p>
<pre data-role="codeBlock" data-info="yml" class="language-yaml yml"><code><span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">SendErrorFilter</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨å‘é€é”™è¯¯è¿‡æ»¤å™¨</span>
    <span class="token comment"># true: å¯ç”¨ï¼Œå¤„ç†è¯·æ±‚è¿‡ç¨‹ä¸­å‡ºç°çš„é”™è¯¯å¹¶è¿”å›é€‚å½“å“åº”</span>
    <span class="token comment"># false: ç¦ç”¨ï¼Œä¸å¤„ç†é”™è¯¯</span>
    <span class="token key atrule">error</span><span class="token punctuation">:</span>
      <span class="token key atrule">disable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><p>é‡å¯æœåŠ¡å™¨ï¼Œå‘èµ·è¯·æ±‚ä¹‹åï¼Œæµè§ˆå™¨è¾“å‡ºæŠ¥é”™ä¿¡æ¯ã€‚</p>
<p><img src="assets/image-20251222161016645.png" alt="image-20251222161016645"></p>
<h2 id="zuul-å’Œ-hystrix-æ— ç¼ç»“åˆ">Zuul å’Œ Hystrix æ— ç¼ç»“åˆ </h2>
<p>åœ¨ Spring Cloud ä¸­ï¼ŒZuul å¯åŠ¨å™¨ä¸­åŒ…å«äº† Hystrix ç›¸å…³ä¾èµ–ã€‚åœ¨ Zuul ç½‘å…³ä¸­ï¼Œé»˜è®¤æä¾›äº† Hystrix Dashboard æœåŠ¡ç›‘æ§æ•°æ®ï¼ˆhystrix.streamï¼‰ï¼Œä½†æ˜¯æ²¡æœ‰æä¾›ç›‘æ§é¢æ¿çš„ç•Œé¢å±•ç¤ºã€‚Zuul å’Œ Hystrix æ˜¯æ— ç¼ç»“åˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ç°ç½‘å…³å®¹é”™å¤„ç†ã€‚</p>
<h3 id="ç½‘å…³ç›‘æ§">ç½‘å…³ç›‘æ§ </h3>
<h4 id="æ·»åŠ ä¾èµ–">æ·»åŠ ä¾èµ– </h4>
<p>Zuul çš„ä¾èµ–ä¸­åŒ…å«äº† Hystrix çš„ç›¸å…³ jar åŒ…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨é¡¹ç›®ä¸­é¢å¤–æ·»åŠ  Hystrix çš„ä¾èµ–ï¼Œä½†æ˜¯å¦‚æœéœ€è¦å¼€å¯æ•°æ®ç›‘æ§åˆ™éœ€è¦æ·»åŠ  dashboard ç›¸å…³ä¾èµ–ã€‚</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-hystrix-dashboard<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><h4 id="é…ç½®æ–‡ä»¶-1">é…ç½®æ–‡ä»¶ </h4>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­å¼€å¯ <code>hystrix.stream</code> ç«¯ç‚¹ã€‚</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> hystrix.stream
</code></pre><h4 id="å¯åŠ¨ç±»-1">å¯åŠ¨ç±» </h4>
<p>åœ¨éœ€è¦å¼€å¯æ•°æ®ç›‘æ§çš„é¡¹ç›®å¯åŠ¨ç±»æ·»åŠ  <code>@EnableHystrixDashboard</code> ã€<code>@EnableHystrix </code>æ³¨è§£ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrix</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">EnableZuulProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span></span><span class="token class-name">Environment</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * Zuul ç½‘å…³åº”ç”¨å¯åŠ¨ç±»
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç±»æ˜¯ AutumnNook å¾®æœåŠ¡æ¶æ„ä¸­çš„ API ç½‘å…³å…¥å£ï¼Œè´Ÿè´£ç»Ÿä¸€çš„è·¯ç”±è½¬å‘ã€
 * æœåŠ¡å‘ç°ã€ç†”æ–­é™çº§å’Œç›‘æ§ç®¡ç†åŠŸèƒ½ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>æ ¸å¿ƒåŠŸèƒ½æ³¨è§£è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableZuulProxy</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Zuul ä»£ç†åŠŸèƒ½ï¼Œæä¾›åŠ¨æ€è·¯ç”±å’Œè¿‡æ»¤å™¨æ”¯æŒ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œä¸æ³¨å†Œä¸­å¿ƒäº¤äº’<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableHystrix</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Hystrix ç†”æ–­å™¨ï¼Œæä¾›æœåŠ¡çš„å®¹é”™ä¿æŠ¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Hystrix ä»ªè¡¨ç›˜ï¼Œæä¾›ç†”æ–­ç›‘æ§ç•Œé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">}</span>ï¼šSpring Boot åº”ç”¨æ ‡å‡†æ³¨è§£ï¼ŒåŒ…å«ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨é…ç½®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>åº”ç”¨æ¶æ„å®šä½ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½œä¸ºå¾®æœåŠ¡æ¶æ„çš„ç»Ÿä¸€å…¥å£ç½‘å…³<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è´Ÿè´£è¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æä¾›ç»Ÿä¸€çš„è®¤è¯æˆæƒå…¥å£<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å®ç°æœåŠ¡çš„ç†”æ–­é™çº§å’Œé™æµä¿æŠ¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ”¶é›†å’Œå±•ç¤ºæœåŠ¡ç›‘æ§æŒ‡æ ‡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 * <span class="token keyword keyword-@version">@version</span> 1.0
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableZuulProxy</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableDiscoveryClient</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableHystrix</span></span>
 * <span class="token keyword keyword-@since">@since</span> 2024
 */</span>
<span class="token annotation punctuation">@EnableHystrix</span>                  <span class="token comment">// å¯ç”¨ Hystrix ç†”æ–­å™¨ï¼Œæä¾›æœåŠ¡çš„å®¹é”™ä¿æŠ¤æœºåˆ¶</span>
<span class="token annotation punctuation">@EnableZuulProxy</span>                <span class="token comment">// å¯ç”¨ Zuul ä»£ç†ï¼Œæä¾›åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ç­‰åŠŸèƒ½</span>
<span class="token annotation punctuation">@SpringBootApplication</span>          <span class="token comment">// Spring Boot åº”ç”¨æ ¸å¿ƒæ³¨è§£ï¼ŒåŒ…å«é…ç½®ã€ç»„ä»¶æ‰«æç­‰</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>          <span class="token comment">// å¯ç”¨æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Eurekaã€Consul ç­‰æ³¨å†Œä¸­å¿ƒ</span>
<span class="token annotation punctuation">@EnableHystrixDashboard</span>         <span class="token comment">// å¯ç”¨ Hystrix ä»ªè¡¨ç›˜ï¼Œæä¾›å¯è§†åŒ–çš„ç†”æ–­å™¨ç›‘æ§ç•Œé¢</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulApplication</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ—¥å¿—è®°å½•å™¨å®ä¾‹ï¼Œç”¨äºè¾“å‡ºåº”ç”¨å¯åŠ¨å’Œè¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * åº”ç”¨ä¸»å…¥å£æ–¹æ³•
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨æµç¨‹è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå§‹åŒ– Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®å’Œ Bean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨å†…åµŒçš„ Web æœåŠ¡å™¨ï¼ˆUndertowï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒï¼ˆEurekaï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå§‹åŒ– Zuul è·¯ç”±é…ç½®å’Œè¿‡æ»¤å™¨é“¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨ Hystrix ç†”æ–­å™¨å’Œç›‘æ§ä»ªè¡¨ç›˜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è¾“å‡ºå¯åŠ¨æˆåŠŸä¿¡æ¯å’Œå…³é”®é…ç½®å‚æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å…³é”®é…ç½®è¾“å‡ºï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡ç«¯å£ï¼šç½‘å…³å¯¹å¤–æœåŠ¡çš„ç«¯å£å·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å®ä¾‹åœ°å€ï¼šå½“å‰å®ä¾‹åœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡å‘ç°é…ç½®ï¼šæ˜¯å¦æ‹‰å–å’Œæ³¨å†ŒæœåŠ¡çš„å¼€å…³çŠ¶æ€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å†Œä¸­å¿ƒåœ°å€ï¼šEureka æœåŠ¡å™¨é›†ç¾¤åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è®¿é—®åœ°å€ï¼šåº”ç”¨å¯åŠ¨åçš„å¯è®¿é—®åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç›‘æ§ç«¯ç‚¹ï¼šActuator ç›‘æ§ç«¯ç‚¹çš„è®¿é—®åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">args</span> å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ç”¨äºè¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°
     */</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯åŠ¨ Spring Boot åº”ç”¨ï¼Œè¿”å›åº”ç”¨ä¸Šä¸‹æ–‡</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–ç¯å¢ƒé…ç½®ä¿¡æ¯</span>
        <span class="token class-name">Environment</span> environment <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–å…³é”®é…ç½®ä¿¡æ¯</span>
        <span class="token class-name">String</span> port <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"server.port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fetchRegistry <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.fetch-registry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> registryWithEureka <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.register-with-eureka"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> defaultZone <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.service-url.defaultZone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hostname <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.instance.hostname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> preferIpAddress <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.instance.prefer-ip-address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºåº”ç”¨å¯åŠ¨æˆåŠŸä¿¡æ¯å’Œå…³é”®é…ç½®</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"========= AutumnNook Zuul started successfully ========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸš€ æœåŠ¡ç«¯å£ï¼š{}"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ  å®ä¾‹åœ°å€ï¼š{}"</span><span class="token punctuation">,</span> hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“¥ æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡ï¼š{}"</span><span class="token punctuation">,</span> fetchRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“¤ æ˜¯å¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š{}"</span><span class="token punctuation">,</span> registryWithEureka<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ”— æ³¨å†Œä¸­å¿ƒé›†ç¾¤åœ°å€ï¼š{}"</span><span class="token punctuation">,</span> defaultZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸŒ æ˜¯å¦ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨çš„IPåœ°å€ï¼š{}"</span><span class="token punctuation">,</span> preferIpAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“Š è®¿é—®åœ°å€ï¼šhttp://localhost:{}/"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ‘ï¸ ç›‘æ§ç«¯ç‚¹ï¼šhttp://localhost:{}/actuator"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"========================================================"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-static">static</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ³¨å†Œ JVM å…³é—­é’©å­ï¼Œç¡®ä¿åº”ç”¨ä¼˜é›…å…³é—­</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"===================Autumnnook Zuul æ­£åœ¨å…³é—­==================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨æ¸…ç†èµ„æº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„èµ„æºæ¸…ç†é€»è¾‘ï¼Œå¦‚ï¼š</span>
            <span class="token comment">// - å…³é—­æ•°æ®åº“è¿æ¥æ± </span>
            <span class="token comment">// - é‡Šæ”¾ Redis è¿æ¥</span>
            <span class="token comment">// - ä»æ³¨å†Œä¸­å¿ƒæ³¨é”€æœåŠ¡</span>
            <span class="token comment">// - åœæ­¢åå°çº¿ç¨‹ç­‰</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"èµ„æºæ¸…ç†å®Œæˆï¼ŒæœåŠ¡å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h4 id="è®¿é—®å¹¶æŸ¥çœ‹æ•°æ®">è®¿é—®å¹¶æŸ¥çœ‹æ•°æ® </h4>
<p>é‡å¯æœåŠ¡ï¼Œè®¿é—®å¹¶æŸ¥çœ‹æ•°æ®ï¼Œè®¿é—® <a href="http://127.0.0.1:30000/hystrix">http://127.0.0.1:30000/hystrix</a></p>
<p><img src="assets/image-20251222170631890.png" alt="image-20251222170631890"></p>
<p><img src="assets/image-20251222170740832.png" alt="image-20251222170740832"></p>
<p>ç›‘æ§ç«¯ç‚¹åœ°å€ï¼š<a href="http://127.0.0.1:30000/actuator/hystrix.stream">http://127.0.0.1:30000/actuator/hystrix.stream</a></p>
<p><img src="assets/image-20251222170303388.png" alt="image-20251222170303388"></p>
<h3 id="ç½‘å…³ç†”æ–­">ç½‘å…³ç†”æ–­ </h3>
<p>åœ¨ Edgeware ç‰ˆæœ¬ä¹‹å‰ï¼ŒZuul æä¾›äº†æ¥å£ <code>ZuulFallbackProvider</code> ç”¨äºå®ç° fallback å¤„ç†ã€‚ä» Edgeware ç‰ˆæœ¬å¼€å§‹ï¼ŒZuul æä¾›äº†æ¥å£ <code>FallbackProvider</code> æ¥å£æ¥æä¾› fallback å¤„ç†ã€‚</p>
<p>Zuul çš„ fallback å®¹é”™å¤„ç†é€»è¾‘ï¼Œåªé’ˆå¯¹ timeout å¼‚å¸¸å¤„ç†ï¼Œå½“è¯·æ±‚è¢« Zuul è·¯ç”±åï¼Œåªè¦æœåŠ¡æœ‰è¿”å›ï¼ˆåŒ…æ‹¬å¼‚å¸¸ï¼‰ï¼Œéƒ½ä¸ä¼šè§¦å‘ Zuul çš„ fallback å®¹é”™é€»è¾‘ã€‚</p>
<p><span style="color:#d44e7d;font-size:12px;">å› ä¸ºå¯¹äº Zuul ç½‘å…³è€Œè¨€ï¼Œåšè¯·æ±‚è·¯ç”±åˆ†å‘çš„æ—¶å€™ï¼Œç»“æœç”±è¿œç¨‹æœåŠ¡è¿ç®—ã€‚è¿œç¨‹æœåŠ¡åé¦ˆäº†å¼‚å¸¸ä¿¡æ¯ï¼ŒZuul ç½‘å…³ä¸ä¼šå¤„ç†å¼‚å¸¸ï¼Œå› ä¸ºæ— æ³•ç¡®å®šè¿™ä¸ªé”™è¯¯æ˜¯å¦æ˜¯åº”ç”¨ç¨‹åºçœŸå®è¦åé¦ˆç»™å®¢æˆ·ç«¯çš„ã€‚</span></p>
<h4 id="ç‰¹å®šæœåŠ¡çš„é™çº§æä¾›è€…">ç‰¹å®šæœåŠ¡çš„é™çº§æä¾›è€… </h4>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">FallbackProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ClientHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * ç³»ç»ŸæœåŠ¡é™çº§æä¾›è€…
 * ä½œç”¨ï¼šå½“ Zuul ç½‘å…³è·¯ç”±çš„åç«¯æœåŠ¡ä¸å¯ç”¨ï¼ˆè¶…æ—¶ã€å®•æœºã€ç†”æ–­ç­‰ï¼‰æ—¶ï¼Œ æä¾›è‡ªå®šä¹‰çš„é™çº§å“åº”ï¼Œé¿å…å®¢æˆ·ç«¯æ”¶åˆ°åŸå§‹é”™è¯¯ä¿¡æ¯
 * æ ¸å¿ƒæ¦‚å¿µï¼š 
 * 1. æœåŠ¡é™çº§ï¼šåœ¨æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›é¢„è®¾çš„å‹å¥½å“åº”ï¼Œè€Œä¸æ˜¯é”™è¯¯å †æ ˆ 
 * 2. ç†”æ–­è§¦å‘ï¼šå½“ Hystrix ç†”æ–­å™¨æ‰“å¼€æˆ–æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶è‡ªåŠ¨è§¦å‘ 
 * 3. ä¼˜é›…é™çº§ï¼šä¿è¯ç³»ç»Ÿåœ¨éƒ¨åˆ†æœåŠ¡æ•…éšœæ—¶ä»èƒ½æä¾›åŸºæœ¬åŠŸèƒ½
 * åº”ç”¨åœºæ™¯ï¼š - åç«¯æœåŠ¡å®•æœºæˆ–ç»´æŠ¤ - æœåŠ¡è°ƒç”¨è¶…æ—¶ - æœåŠ¡ç†”æ–­å™¨æ‰“å¼€ - ç½‘ç»œå¼‚å¸¸å¯¼è‡´æœåŠ¡ä¸å¯è¾¾
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SystemFallbackProvider</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">FallbackProvider</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æŒ‡å®šè¯¥é™çº§æä¾›è€…é€‚ç”¨çš„æœåŠ¡è·¯ç”±
     * è¿”å›å€¼è§„åˆ™ï¼š 1. è¿”å›å…·ä½“æœåŠ¡åï¼šåªå¯¹è¯¥æœåŠ¡ç”Ÿæ•ˆï¼ˆå¦‚ "user-service"ï¼‰ 2. è¿”å› "*" æˆ– nullï¼šå¯¹æ‰€æœ‰æœåŠ¡ç”Ÿæ•ˆï¼ˆå…¨å±€é™çº§ï¼‰ 3. è¿”å›ç‰¹å®šè·¯ç”±IDï¼šå¯¹æŒ‡å®šè·¯ç”±ç”Ÿæ•ˆ
     * æ³¨æ„ï¼šæœåŠ¡åéœ€è¦ä¸ zuul.routes é…ç½®ä¸­çš„ serviceId ä¸€è‡´ï¼Œ æˆ–è€…ä¸ Eureka æ³¨å†Œçš„æœåŠ¡åä¸€è‡´
     *
     * <span class="token keyword keyword-@return">@return</span> æœåŠ¡è·¯ç”±æ ‡è¯†ç¬¦
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿”å› "autumnnook-system" è¡¨ç¤ºæ­¤é™çº§æä¾›è€…</span>
        <span class="token comment">// ä»…å¯¹åä¸º "autumnnook-system" çš„åç«¯æœåŠ¡ç”Ÿæ•ˆ</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"autumnnook-system"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºé™çº§å“åº”
     * è§¦å‘æ—¶æœºï¼š 1. åç«¯æœåŠ¡è°ƒç”¨è¶…æ—¶ï¼ˆé»˜è®¤1ç§’ï¼Œå¯é…ç½®ï¼‰ 2. æœåŠ¡æŠ›å‡ºå¼‚å¸¸ï¼ˆ5xxã€4xx é”™è¯¯ï¼‰ 3. Hystrix ç†”æ–­å™¨æ‰“å¼€ 4. æœåŠ¡å®ä¾‹ä¸å­˜åœ¨æˆ–ä¸‹çº¿
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">route</span> è§¦å‘é™çº§çš„æœåŠ¡è·¯ç”±ï¼ˆä¸ getRoute() è¿”å›å€¼ä¸€è‡´ï¼‰
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">cause</span> å¯¼è‡´é™çº§çš„å¼‚å¸¸å¯¹è±¡ï¼Œå¯ç”¨äºåˆ¤æ–­é™çº§åŸå›  å¸¸è§å¼‚å¸¸ç±»å‹ï¼š - HystrixTimeoutException: è¶…æ—¶ - ZuulException: Zuulå†…éƒ¨å¼‚å¸¸ - RuntimeException:
     *              è¿è¡Œæ—¶å¼‚å¸¸ - IOException: ç½‘ç»œIOå¼‚å¸¸
     * <span class="token keyword keyword-@return">@return</span> è‡ªå®šä¹‰çš„ HTTP å“åº”å¯¹è±¡
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">ClientHttpResponse</span> <span class="token function">fallbackResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> route<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// è¿”å›ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»å®ç°çš„ ClientHttpResponse æ¥å£</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ClientHttpResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token doc-comment comment">/**
             * å“åº”çŠ¶æ€ç 
             *
             * è®¾è®¡å»ºè®®ï¼š
             * 1. æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼š503 Service Unavailable
             * 2. è¯·æ±‚è¶…æ—¶ï¼š504 Gateway Timeout
             * 3. ç†”æ–­å™¨æ‰“å¼€ï¼š429 Too Many Requests
             * 4. é€šç”¨é”™è¯¯ï¼š500 Internal Server Error
             *
             * å¯ä»¥æ ¹æ® cause ç±»å‹è¿”å›ä¸åŒçš„çŠ¶æ€ç 
             *
             * <span class="token keyword keyword-@return">@return</span> HTTP çŠ¶æ€ç æšä¸¾
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">HttpStatus</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å› 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯</span>
                <span class="token comment">// å®é™…å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼š</span>
                <span class="token comment">// if (cause instanceof HystrixTimeoutException) {</span>
                <span class="token comment">//     return HttpStatus.GATEWAY_TIMEOUT; // 504</span>
                <span class="token comment">// } else if (cause instanceof ConnectException) {</span>
                <span class="token comment">//     return HttpStatus.SERVICE_UNAVAILABLE; // 503</span>
                <span class="token comment">// }</span>
                <span class="token keyword keyword-return">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * åŸå§‹çŠ¶æ€ç ï¼ˆæ•°å€¼å½¢å¼ï¼‰
             *
             * æ³¨æ„ï¼šæ­¤æ–¹æ³•è¿”å› int ç±»å‹çŠ¶æ€ç ï¼Œ
             *       åº”ä¸ getStatusCode() æ–¹æ³•ä¿æŒä¸€è‡´
             *
             * <span class="token keyword keyword-@return">@return</span> HTTP çŠ¶æ€ç çš„æ•´æ•°å€¼
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-int">int</span> <span class="token function">getRawStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å›çŠ¶æ€ç çš„æ•°å€¼å½¢å¼ï¼Œ500</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * çŠ¶æ€æ–‡æœ¬æè¿°
             *
             * ç¤ºä¾‹ï¼š
             * - 200: "OK"
             * - 404: "Not Found"
             * - 500: "Internal Server Error"
             *
             * <span class="token keyword keyword-@return">@return</span> çŠ¶æ€ç å¯¹åº”çš„æ–‡æœ¬æè¿°
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getStatusText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å›çŠ¶æ€ç å¯¹åº”çš„æ ‡å‡†æè¿°æ–‡æœ¬</span>
                <span class="token comment">// HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase() = "Internal Server Error"</span>
                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReasonPhrase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * å…³é—­å“åº”èµ„æº
             *
             * ä½œç”¨ï¼šé‡Šæ”¾å“åº”ç›¸å…³çš„èµ„æºï¼ˆå¦‚è¾“å…¥æµã€ç½‘ç»œè¿æ¥ç­‰ï¼‰
             * æ³¨æ„ï¼šå¦‚æœå“åº”ä½“æ˜¯ ByteArrayInputStreamï¼Œé€šå¸¸ä¸éœ€è¦ç‰¹æ®Šå¤„ç†
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ByteArrayInputStream ä¸éœ€è¦æ˜¾å¼å…³é—­</span>
                <span class="token comment">// å¦‚æœæ˜¯å…¶ä»–éœ€è¦å…³é—­çš„èµ„æºï¼ˆå¦‚æ–‡ä»¶æµã€ç½‘ç»œæµï¼‰ï¼Œåº”åœ¨æ­¤å¤„é‡Šæ”¾</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * å“åº”ä½“å†…å®¹
             *
             * è®¾è®¡åŸåˆ™ï¼š
             * 1. è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼Œé¿å…æŠ€æœ¯ç»†èŠ‚æš´éœ²
             * 2. ä¿æŒç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼ˆJSON/XMLï¼‰
             * 3. åŒ…å«å¿…è¦çš„é”™è¯¯ä»£ç å’Œç”¨æˆ·æç¤º
             * 4. å¯æ·»åŠ è¯·æ±‚IDä¾¿äºè¿½è¸ª
             * <span class="token keyword keyword-@return">@return</span> å“åº”ä½“çš„è¾“å…¥æµ
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">InputStream</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ›å»º JSON æ ¼å¼çš„é™çº§å“åº”ä½“</span>
                <span class="token class-name">String</span> fallbackJson <span class="token operator">=</span> <span class="token string">"{\"message\":\"System service is unavailable. Please try again later.\"}"</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯æ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹è¿”å›ä¸åŒçš„é™çº§ä¿¡æ¯</span>
                <span class="token comment">// if (cause instanceof HystrixTimeoutException) {</span>
                <span class="token comment">//     fallbackJson = "{\"code\":\"TIMEOUT\",\"message\":\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•\"}";</span>
                <span class="token comment">// } else if (cause instanceof ConnectException) {</span>
                <span class="token comment">//     fallbackJson = "{\"code\":\"SERVICE_DOWN\",\"message\":\"æœåŠ¡æš‚æ—¶ä¸å¯ç”¨\"}";</span>
                <span class="token comment">// }</span>
                <span class="token comment">// å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚è¾“å…¥æµ</span>
                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>fallbackJson<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨é»˜è®¤å­—ç¬¦é›†ï¼ˆUTF-8ï¼‰ï¼Œ</span>
                <span class="token comment">// å¦‚æœéœ€è¦æŒ‡å®šå­—ç¬¦é›†ï¼Œå¯ä»¥ä½¿ç”¨ï¼šfallbackJson.getBytes(StandardCharsets.UTF_8)</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * å“åº”å¤´ä¿¡æ¯
             *
             * å¿…é¡»è®¾ç½® Content-Typeï¼Œå¦åˆ™å®¢æˆ·ç«¯å¯èƒ½æ— æ³•æ­£ç¡®è§£æå“åº”ä½“
             * å»ºè®®è®¾ç½®ï¼š
             * 1. Content-Type: å“åº”ä½“æ ¼å¼ï¼ˆapplication/jsonï¼‰
             * 2. Charset: å­—ç¬¦ç¼–ç ï¼ˆUTF-8ï¼‰
             * 3. Cache-Control: ç¼“å­˜æ§åˆ¶ï¼ˆno-cacheï¼‰
             * 4. è‡ªå®šä¹‰å¤´ï¼šå¦‚ X-Fallback-Reason
             *
             * <span class="token keyword keyword-@return">@return</span> HTTP å“åº”å¤´é›†åˆ
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">HttpHeaders</span> <span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ›å»ºå“åº”å¤´å¯¹è±¡</span>
                <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è®¾ç½®å†…å®¹ç±»å‹ä¸º JSONï¼Œå­—ç¬¦ç¼–ç ä¸º UTF-8</span>
                <span class="token comment">// è¿™æ˜¯æœ€é‡è¦çš„å“åº”å¤´ï¼Œå¿…é¡»è®¾ç½®</span>
                headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json; charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯æ·»åŠ å…¶ä»–å“åº”å¤´ï¼š</span>
                <span class="token comment">// headers.add("Cache-Control", "no-cache, no-store, max-age=0, must-revalidate");</span>
                <span class="token comment">// headers.add("Pragma", "no-cache");</span>
                <span class="token comment">// headers.add("Expires", "0");</span>
                <span class="token comment">// headers.add("X-Fallback-Reason", cause != null ? cause.getClass().getSimpleName() : "unknown");</span>
                <span class="token comment">// headers.add("X-Service-Name", route);</span>
                <span class="token keyword keyword-return">return</span> headers<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¯é€‰ï¼šè·å–é™çº§åŸå› ï¼ˆSpring Cloud æ›´é«˜ç‰ˆæœ¬æ”¯æŒï¼‰
     * ç”¨äºåœ¨æ—¥å¿—æˆ–ç›‘æ§ä¸­è®°å½•é™çº§çš„å…·ä½“åŸå› 
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">route</span> æœåŠ¡è·¯ç”±
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">cause</span> å¼‚å¸¸åŸå› 
     * <span class="token keyword keyword-@return">@return</span> é™çº§åŸå› æè¿°
     */</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getFallbackReason</span><span class="token punctuation">(</span><span class="token class-name">String</span> route<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cause <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token string">"Unknown reason for route: "</span> <span class="token operator">+</span> route<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æ ¹æ®å¼‚å¸¸ç±»å‹è¿”å›ä¸åŒçš„åŸå› æè¿°</span>
        <span class="token class-name">String</span> causeType <span class="token operator">=</span> cause<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> causeMessage <span class="token operator">=</span> cause<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Fallback triggered for %s. Cause: %s - %s"</span><span class="token punctuation">,</span> route<span class="token punctuation">,</span> causeType<span class="token punctuation">,</span> causeMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>é‡å¯ç½‘å…³æœåŠ¡ï¼Œæˆ‘ä»¬å°†è¦è®¿é—®çš„é‚£ä¸ªæœåŠ¡åœæ‰ï¼Œæ¨¡æ‹Ÿè°ƒç”¨æœåŠ¡è¶…æ—¶ã€‚</p>
<p><img src="assets/image-20251222174310741.png" alt="image-20251222174310741"></p>
<h4 id="é€šç”¨çš„å…¨å±€é™çº§æä¾›è€…">é€šç”¨çš„å…¨å±€é™çº§æä¾›è€… </h4>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span>route<span class="token punctuation">.</span></span><span class="token class-name">FallbackProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpHeaders</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">ClientHttpResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayInputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * ç³»ç»ŸæœåŠ¡é™çº§æä¾›è€…
 * ä½œç”¨ï¼šå½“ Zuul ç½‘å…³è·¯ç”±çš„åç«¯æœåŠ¡ä¸å¯ç”¨ï¼ˆè¶…æ—¶ã€å®•æœºã€ç†”æ–­ç­‰ï¼‰æ—¶ï¼Œ æä¾›è‡ªå®šä¹‰çš„é™çº§å“åº”ï¼Œé¿å…å®¢æˆ·ç«¯æ”¶åˆ°åŸå§‹é”™è¯¯ä¿¡æ¯
 * æ ¸å¿ƒæ¦‚å¿µï¼š 1. æœåŠ¡é™çº§ï¼šåœ¨æœåŠ¡ä¸å¯ç”¨æ—¶è¿”å›é¢„è®¾çš„å‹å¥½å“åº”ï¼Œè€Œä¸æ˜¯é”™è¯¯å †æ ˆ 2. ç†”æ–­è§¦å‘ï¼šå½“ Hystrix ç†”æ–­å™¨æ‰“å¼€æˆ–æœåŠ¡è°ƒç”¨å¤±è´¥æ—¶è‡ªåŠ¨è§¦å‘ 3. ä¼˜é›…é™çº§ï¼šä¿è¯ç³»ç»Ÿåœ¨éƒ¨åˆ†æœåŠ¡æ•…éšœæ—¶ä»èƒ½æä¾›åŸºæœ¬åŠŸèƒ½
 * åº”ç”¨åœºæ™¯ï¼š - åç«¯æœåŠ¡å®•æœºæˆ–ç»´æŠ¤ - æœåŠ¡è°ƒç”¨è¶…æ—¶ - æœåŠ¡ç†”æ–­å™¨æ‰“å¼€ - ç½‘ç»œå¼‚å¸¸å¯¼è‡´æœåŠ¡ä¸å¯è¾¾
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">SystemFallbackProvider</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">FallbackProvider</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æŒ‡å®šè¯¥é™çº§æä¾›è€…é€‚ç”¨çš„æœåŠ¡è·¯ç”±
     * è¿”å›å€¼è§„åˆ™ï¼š 1. è¿”å›å…·ä½“æœåŠ¡åï¼šåªå¯¹è¯¥æœåŠ¡ç”Ÿæ•ˆï¼ˆå¦‚ "user-service"ï¼‰ 2. è¿”å› "*" æˆ– nullï¼šå¯¹æ‰€æœ‰æœåŠ¡ç”Ÿæ•ˆï¼ˆå…¨å±€é™çº§ï¼‰ 3. è¿”å›ç‰¹å®šè·¯ç”±IDï¼šå¯¹æŒ‡å®šè·¯ç”±ç”Ÿæ•ˆ
     * æ³¨æ„ï¼šæœåŠ¡åéœ€è¦ä¸ zuul.routes é…ç½®ä¸­çš„ serviceId ä¸€è‡´ï¼Œ æˆ–è€…ä¸ Eureka æ³¨å†Œçš„æœåŠ¡åä¸€è‡´
     *
     * <span class="token keyword keyword-@return">@return</span> æœåŠ¡è·¯ç”±æ ‡è¯†ç¬¦
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"*"</span><span class="token punctuation">;</span><span class="token comment">//é€šç”¨å…¨å±€æœåŠ¡</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * åˆ›å»ºé™çº§å“åº”
     * è§¦å‘æ—¶æœºï¼š 1. åç«¯æœåŠ¡è°ƒç”¨è¶…æ—¶ï¼ˆé»˜è®¤1ç§’ï¼Œå¯é…ç½®ï¼‰ 2. æœåŠ¡æŠ›å‡ºå¼‚å¸¸ï¼ˆ5xxã€4xx é”™è¯¯ï¼‰ 3. Hystrix ç†”æ–­å™¨æ‰“å¼€ 4. æœåŠ¡å®ä¾‹ä¸å­˜åœ¨æˆ–ä¸‹çº¿
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">route</span> è§¦å‘é™çº§çš„æœåŠ¡è·¯ç”±ï¼ˆä¸ getRoute() è¿”å›å€¼ä¸€è‡´ï¼‰
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">cause</span> å¯¼è‡´é™çº§çš„å¼‚å¸¸å¯¹è±¡ï¼Œå¯ç”¨äºåˆ¤æ–­é™çº§åŸå›  å¸¸è§å¼‚å¸¸ç±»å‹ï¼š - HystrixTimeoutException: è¶…æ—¶ - ZuulException: Zuulå†…éƒ¨å¼‚å¸¸ - RuntimeException:
     *              è¿è¡Œæ—¶å¼‚å¸¸ - IOException: ç½‘ç»œIOå¼‚å¸¸
     * <span class="token keyword keyword-@return">@return</span> è‡ªå®šä¹‰çš„ HTTP å“åº”å¯¹è±¡
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">ClientHttpResponse</span> <span class="token function">fallbackResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> route<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// è¿”å›ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»å®ç°çš„ ClientHttpResponse æ¥å£</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ClientHttpResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token doc-comment comment">/**
             * å“åº”çŠ¶æ€ç 
             *
             * è®¾è®¡å»ºè®®ï¼š
             * 1. æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼š503 Service Unavailable
             * 2. è¯·æ±‚è¶…æ—¶ï¼š504 Gateway Timeout
             * 3. ç†”æ–­å™¨æ‰“å¼€ï¼š429 Too Many Requests
             * 4. é€šç”¨é”™è¯¯ï¼š500 Internal Server Error
             *
             * å¯ä»¥æ ¹æ® cause ç±»å‹è¿”å›ä¸åŒçš„çŠ¶æ€ç 
             *
             * <span class="token keyword keyword-@return">@return</span> HTTP çŠ¶æ€ç æšä¸¾
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">HttpStatus</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å› 500 å†…éƒ¨æœåŠ¡å™¨é”™è¯¯</span>
                <span class="token comment">// å®é™…å¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼š</span>
                <span class="token comment">// if (cause instanceof HystrixTimeoutException) {</span>
                <span class="token comment">//     return HttpStatus.GATEWAY_TIMEOUT; // 504</span>
                <span class="token comment">// } else if (cause instanceof ConnectException) {</span>
                <span class="token comment">//     return HttpStatus.SERVICE_UNAVAILABLE; // 503</span>
                <span class="token comment">// }</span>
                <span class="token keyword keyword-return">return</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * åŸå§‹çŠ¶æ€ç ï¼ˆæ•°å€¼å½¢å¼ï¼‰
             *
             * æ³¨æ„ï¼šæ­¤æ–¹æ³•è¿”å› int ç±»å‹çŠ¶æ€ç ï¼Œ
             *       åº”ä¸ getStatusCode() æ–¹æ³•ä¿æŒä¸€è‡´
             *
             * <span class="token keyword keyword-@return">@return</span> HTTP çŠ¶æ€ç çš„æ•´æ•°å€¼
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-int">int</span> <span class="token function">getRawStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å›çŠ¶æ€ç çš„æ•°å€¼å½¢å¼ï¼Œ500</span>
                <span class="token keyword keyword-return">return</span> <span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * çŠ¶æ€æ–‡æœ¬æè¿°
             *
             * ç¤ºä¾‹ï¼š
             * - 200: "OK"
             * - 404: "Not Found"
             * - 500: "Internal Server Error"
             *
             * <span class="token keyword keyword-@return">@return</span> çŠ¶æ€ç å¯¹åº”çš„æ–‡æœ¬æè¿°
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getStatusText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// è¿”å›çŠ¶æ€ç å¯¹åº”çš„æ ‡å‡†æè¿°æ–‡æœ¬</span>
                <span class="token comment">// HttpStatus.INTERNAL_SERVER_ERROR.getReasonPhrase() = "Internal Server Error"</span>
                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-this">this</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReasonPhrase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * å…³é—­å“åº”èµ„æº
             *
             * ä½œç”¨ï¼šé‡Šæ”¾å“åº”ç›¸å…³çš„èµ„æºï¼ˆå¦‚è¾“å…¥æµã€ç½‘ç»œè¿æ¥ç­‰ï¼‰
             * æ³¨æ„ï¼šå¦‚æœå“åº”ä½“æ˜¯ ByteArrayInputStreamï¼Œé€šå¸¸ä¸éœ€è¦ç‰¹æ®Šå¤„ç†
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ByteArrayInputStream ä¸éœ€è¦æ˜¾å¼å…³é—­</span>
                <span class="token comment">// å¦‚æœæ˜¯å…¶ä»–éœ€è¦å…³é—­çš„èµ„æºï¼ˆå¦‚æ–‡ä»¶æµã€ç½‘ç»œæµï¼‰ï¼Œåº”åœ¨æ­¤å¤„é‡Šæ”¾</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * å“åº”ä½“å†…å®¹
             *
             * è®¾è®¡åŸåˆ™ï¼š
             * 1. è¿”å›å‹å¥½çš„é”™è¯¯ä¿¡æ¯ï¼Œé¿å…æŠ€æœ¯ç»†èŠ‚æš´éœ²
             * 2. ä¿æŒç»Ÿä¸€çš„å“åº”æ ¼å¼ï¼ˆJSON/XMLï¼‰
             * 3. åŒ…å«å¿…è¦çš„é”™è¯¯ä»£ç å’Œç”¨æˆ·æç¤º
             * 4. å¯æ·»åŠ è¯·æ±‚IDä¾¿äºè¿½è¸ª
             * <span class="token keyword keyword-@return">@return</span> å“åº”ä½“çš„è¾“å…¥æµ
             * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">IOException</span></span>
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">InputStream</span> <span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ›å»º JSON æ ¼å¼çš„é™çº§å“åº”ä½“</span>
                <span class="token class-name">String</span> fallbackJson <span class="token operator">=</span> <span class="token string">"{\"message\":\"service is unavailable. please try again later.\"}"</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯æ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹è¿”å›ä¸åŒçš„é™çº§ä¿¡æ¯</span>
                <span class="token comment">// if (cause instanceof HystrixTimeoutException) {</span>
                <span class="token comment">//     fallbackJson = "{\"code\":\"TIMEOUT\",\"message\":\"è¯·æ±‚è¶…æ—¶ï¼Œè¯·ç¨åé‡è¯•\"}";</span>
                <span class="token comment">// } else if (cause instanceof ConnectException) {</span>
                <span class="token comment">//     fallbackJson = "{\"code\":\"SERVICE_DOWN\",\"message\":\"æœåŠ¡æš‚æ—¶ä¸å¯ç”¨\"}";</span>
                <span class="token comment">// }</span>
                <span class="token comment">// å°† JSON å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚è¾“å…¥æµ</span>
                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ByteArrayInputStream</span><span class="token punctuation">(</span>fallbackJson<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨é»˜è®¤å­—ç¬¦é›†ï¼ˆUTF-8ï¼‰ï¼Œ</span>
                <span class="token comment">// å¦‚æœéœ€è¦æŒ‡å®šå­—ç¬¦é›†ï¼Œå¯ä»¥ä½¿ç”¨ï¼šfallbackJson.getBytes(StandardCharsets.UTF_8)</span>
            <span class="token punctuation">}</span>

            <span class="token doc-comment comment">/**
             * å“åº”å¤´ä¿¡æ¯
             *
             * å¿…é¡»è®¾ç½® Content-Typeï¼Œå¦åˆ™å®¢æˆ·ç«¯å¯èƒ½æ— æ³•æ­£ç¡®è§£æå“åº”ä½“
             * å»ºè®®è®¾ç½®ï¼š
             * 1. Content-Type: å“åº”ä½“æ ¼å¼ï¼ˆapplication/jsonï¼‰
             * 2. Charset: å­—ç¬¦ç¼–ç ï¼ˆUTF-8ï¼‰
             * 3. Cache-Control: ç¼“å­˜æ§åˆ¶ï¼ˆno-cacheï¼‰
             * 4. è‡ªå®šä¹‰å¤´ï¼šå¦‚ X-Fallback-Reason
             *
             * <span class="token keyword keyword-@return">@return</span> HTTP å“åº”å¤´é›†åˆ
             */</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">HttpHeaders</span> <span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ›å»ºå“åº”å¤´å¯¹è±¡</span>
                <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è®¾ç½®å†…å®¹ç±»å‹ä¸º JSONï¼Œå­—ç¬¦ç¼–ç ä¸º UTF-8</span>
                <span class="token comment">// è¿™æ˜¯æœ€é‡è¦çš„å“åº”å¤´ï¼Œå¿…é¡»è®¾ç½®</span>
                headers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/json; charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å¯æ·»åŠ å…¶ä»–å“åº”å¤´ï¼š</span>
                <span class="token comment">// headers.add("Cache-Control", "no-cache, no-store, max-age=0, must-revalidate");</span>
                <span class="token comment">// headers.add("Pragma", "no-cache");</span>
                <span class="token comment">// headers.add("Expires", "0");</span>
                <span class="token comment">// headers.add("X-Fallback-Reason", cause != null ? cause.getClass().getSimpleName() : "unknown");</span>
                <span class="token comment">// headers.add("X-Service-Name", route);</span>
                <span class="token keyword keyword-return">return</span> headers<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * å¯é€‰ï¼šè·å–é™çº§åŸå› ï¼ˆSpring Cloud æ›´é«˜ç‰ˆæœ¬æ”¯æŒï¼‰
     * ç”¨äºåœ¨æ—¥å¿—æˆ–ç›‘æ§ä¸­è®°å½•é™çº§çš„å…·ä½“åŸå› 
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">route</span> æœåŠ¡è·¯ç”±
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">cause</span> å¼‚å¸¸åŸå› 
     * <span class="token keyword keyword-@return">@return</span> é™çº§åŸå› æè¿°
     */</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getFallbackReason</span><span class="token punctuation">(</span><span class="token class-name">String</span> route<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cause <span class="token operator">==</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token string">"Unknown reason for route: "</span> <span class="token operator">+</span> route<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æ ¹æ®å¼‚å¸¸ç±»å‹è¿”å›ä¸åŒçš„åŸå› æè¿°</span>
        <span class="token class-name">String</span> causeType <span class="token operator">=</span> cause<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> causeMessage <span class="token operator">=</span> cause<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Fallback triggered for %s. Cause: %s - %s"</span><span class="token punctuation">,</span> route<span class="token punctuation">,</span> causeType<span class="token punctuation">,</span> causeMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p><span style="color:#d44e7d;font-size:12px;">æ³¨ï¼šé’ˆå¯¹ OpenFeign æœåŠ¡é—´è°ƒç”¨ï¼Œç½‘å…³ç†”æ–­é™çº§é€»è¾‘æ˜¯ä¸ç”Ÿæ•ˆçš„ï¼</span></p>
<h3 id="ç½‘å…³é™æµ">ç½‘å…³é™æµ </h3>
<p>é¡¾åæ€ä¹‰ï¼Œé™æµå°±æ˜¯é™åˆ¶æµé‡ï¼Œå°±åƒä½ å¸¦å®½åŒ…åªæœ‰ 1 ä¸ª G çš„æµé‡ï¼Œç”¨å®Œäº†å°±æ²¡äº†ã€‚é€šè¿‡é™æµï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¥½çš„æ§åˆ¶ç³»ç»Ÿçš„ QPSï¼Œä»è€Œè¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ç›®çš„ã€‚Zuul ç½‘å…³ç»„ä»¶ä¹Ÿæä¾›äº†é™æµä¿æŠ¤ã€‚å½“è¯·æ±‚å¹¶å‘è¾¾åˆ°äº†é˜ˆå€¼ï¼Œè‡ªåŠ¨è§¦å‘é™æµä¿æŠ¤ï¼Œè¿”å›é”™è¯¯ç»“æœã€‚åªè¦æä¾› error é”™è¯¯å¤„ç†æœºåˆ¶å³å¯ã€‚</p>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦é™æµ">ä¸ºä»€ä¹ˆéœ€è¦é™æµ </h4>
<p>æ¯”å¦‚ Web æœåŠ¡ï¼Œå¯¹å¤– API ï¼Œè¿™ç§ç±»å‹çš„æœåŠ¡æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½å¯¼è‡´æœºå™¨è¢«æ‹–å®ï¼š</p>
<ul>
<li>
<p>ç”¨æˆ·å¢é•¿è¿‡å¿«ï¼ˆè¿™æ˜¯å¥½äº‹ğŸ˜„ï¼‰</p>
</li>
<li>
<p>å› ä¸ºæŸä¸ªçƒ­ç‚¹äº‹ä»¶ï¼ˆæ¯”å¦‚å¾®åšçƒ­æœï¼‰</p>
</li>
<li>
<p>ç«äº‰å¯¹è±¡çˆ¬è™«</p>
</li>
<li>
<p>æ¶æ„è¯·æ±‚</p>
</li>
</ul>
<p>è¿™äº›æƒ…å†µéƒ½æ˜¯æ— æ³•é¢„çŸ¥çš„ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä¼šæœ‰ 10 å€ç”šè‡³ 20 å€çš„æµé‡æ‰“è¿›æ¥ï¼Œå¦‚æœçœŸç¢°ä¸Šè¿™ç§æƒ…å†µï¼Œæ‰©å®¹æ ¹æœ¬æ¥ä¸åŠã€‚</p>
<img src="assets/image-20251222215718898.png" alt="image-20251222215718898" style="zoom:50%;">
<p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå¯¹å†…è€Œè¨€ï¼šä¸Šæ¸¸çš„ Aã€B æœåŠ¡ç›´æ¥ä¾èµ–äº†ä¸‹æ¸¸çš„åŸºç¡€æœåŠ¡ Cï¼Œå¯¹äº Aã€B æœåŠ¡éƒ½ä¾èµ–çš„åŸºç¡€æœåŠ¡ C è¿™ç§åœºæ™¯ï¼ŒæœåŠ¡ A å’Œ B å…¶å®å¤„äºæŸç§ç«äº‰å…³ç³»ï¼Œå¦‚æœæœåŠ¡ A çš„å¹¶å‘é˜ˆå€¼è®¾ç½®è¿‡å¤§ï¼Œå½“æµé‡é«˜å³°æœŸåˆ°æ¥ï¼Œæœ‰å¯èƒ½ç›´æ¥æ‹–è·¨åŸºç¡€æœåŠ¡ C å¹¶å½±å“æœåŠ¡ Bï¼Œä¹Ÿå°±æ˜¯é€ æˆäº†<span style="color:#ff6e00;">é›ªå´©æ•ˆåº”</span>ã€‚</p>
<h4 id="é™æµç®—æ³•">é™æµç®—æ³• </h4>
<p>å¸¸è§çš„é™æµç®—æ³•æœ‰ï¼š</p>
<ul>
<li>è®¡æ•°å™¨ç®—æ³•</li>
<li>æ¼æ¡¶ï¼ˆLeaky Bucketï¼‰ç®—æ³•</li>
<li>ä»¤ç‰Œæ¡¶ï¼ˆToken Bucketï¼‰ç®—æ³•</li>
</ul>
<h5 id="è®¡æ•°å™¨ç®—æ³•">è®¡æ•°å™¨ç®—æ³• </h5>
<p>è®¡æ•°å™¨ç®—æ³•æ˜¯é™æµç®—æ³•ä¸­æœ€ç®€å•ä¸”æœ€å®¹æ˜“å®ç°çš„ä¸€ç§ç®—æ³•ã€‚æ¯”å¦‚æˆ‘ä»¬è§„å®šï¼Œå¯¹äº æ¥å£A æ¥è¯´ï¼Œæˆ‘ä»¬ 1 åˆ†é’Ÿå†…çš„è®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡ 100 æ¬¡ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆåšï¼šåœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨ counterï¼Œæ¯å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œcounter å°±åŠ  1ï¼Œå¦‚æœ counter çš„å€¼å¤§äº 100 å¹¶ä¸”è¯¥è¯·æ±‚ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”è¿˜åœ¨ 1 åˆ†é’Ÿä¹‹å†…ï¼Œé‚£ä¹ˆè§¦å‘é™æµï¼›å¦‚æœè¯¥è¯·æ±‚ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”å¤§äº 1 åˆ†é’Ÿï¼Œé‡ç½® counter é‡æ–°è®¡æ•°ï¼Œå…·ä½“ç®—æ³•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<img src="./assets/image-20241223211750996.png" alt="image-20241223211750996" style="zoom: 53%;">
<p>è¿™ä¸ªç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªååˆ†è‡´å‘½çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸´ç•Œå€¼çš„é—®é¢˜ï¼Œæˆ‘ä»¬çœ‹ä¸‹å›¾ï¼š</p>
 <img src="./assets/image-20241223211823709.png" alt="image-20241223211823709" style="zoom: 35%;">
<p>ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡è®¾å­˜åœ¨ä¸€ä¸ªæ¶æ„çš„ç”¨æˆ·ï¼Œåœ¨ç¬¬ 59 s çš„æ—¶å€™ï¼Œé€šè¿‡æŸç§æ‰‹æ®µï¼ˆæ¯”å¦‚ï¼šæ¸—é€æµ‹è¯•ï¼‰ç¬é—´å‘é€äº† 100 ä¸ªè¯·æ±‚ï¼Œåœ¨ ç¬¬ 60 s ï¼ˆè¿™ä¸ªæ—¶å€™è®¡æ•°å™¨å·²ç»è¢«é‡ç½®äº†ï¼‰çš„æ—¶å€™åˆå‘é€äº† 100ä¸ªè¯·æ±‚ï¼Œç›¸å½“äºè¿™ä¸ªç”¨æˆ·åœ¨ 1s æ—¶é—´å†…ï¼Œç¬é—´å‘é€äº† 200 ä¸ªè¯·æ±‚ã€‚ä¸€å¼€å§‹æˆ‘ä»¬è§„å®šçš„æ˜¯ 1 åˆ†é’Ÿå†…æœ€å¤š 100ä¸ªè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’æœ€å¤§ 1.7 ä¸ªè¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡åœ¨æ—¶é—´çª—å£çš„é‡ç½®èŠ‚ç‚¹å¤„çªå‘å¤§é‡è¯·æ±‚ï¼Œå¯ä»¥ç¬é—´è¶…è¿‡æˆ‘ä»¬çš„é™æµé˜ˆå€¼ã€‚ç”¨æˆ·å¾ˆæœ‰å¯èƒ½é€šè¿‡ç®—æ³•çš„è¿™ä¸ªæ¼æ´ï¼Œç¬é—´å‹å®æˆ‘ä»¬çš„åº”ç”¨ã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ï¼Œè¿˜å­˜åœ¨èµ„æºæµªè´¹çš„é—®é¢˜ï¼Œæˆ‘ä»¬çš„é¢„æƒ³ç®—æ³•æ˜¯å¸Œæœ› 100 ä¸ªè¯·æ±‚å‡åŒ€çš„åˆ†æ•£åœ¨ 1 åˆ†é’Ÿå†…ï¼Œå‡è®¾ 30s å†…æˆ‘ä»¬è¯·æ±‚å°±è¾¾åˆ°ä¸Šé™äº†ï¼Œå‰©ä¸‹çš„åŠåˆ†é’Ÿå†…ï¼ŒæœåŠ¡å™¨å°±å¤„äºé—²ç½®çŠ¶æ€ï¼Œæ¯”å¦‚ä¸‹å›¾ï¼š</p>
<img src="./assets/image-20241223212658994.png" alt="image-20241223212658994" style="zoom: 30%;">
<h5 id="æ¼æ¡¶ç®—æ³•">æ¼æ¡¶ç®—æ³• </h5>
<p>æ¼æ¡¶ç®—æ³•å…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå¯ä»¥ç²—ç•¥çš„è®¤ä¸ºå°±æ˜¯æ³¨æ°´æ¼æ°´çš„è¿‡ç¨‹ä¸­ï¼Œå¾€æ¡¶ä¸­ä»¥ä»»æ„é€Ÿç‡æµå…¥ç¨ï¼Œä»¥ä¸€å®šé€Ÿç‡æµå‡ºæ°´ï¼Œå½“æ°´è¶…è¿‡æ¡¶æµé‡åˆ™ä¸¢å¼ƒï¼Œå› ä¸ºæ¡¶å®¹é‡ä¸å˜ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚</p>
<img src="assets/image-20251222220254736.png" alt="image-20251222220254736" style="zoom:70%;">
<p>æ¼æ¡¶ç®—æ³•é€šè¿‡é˜Ÿåˆ—æœºåˆ¶å®ç°ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<img src="./assets/image-20241223222215371.png" alt="image-20241223222215371" style="zoom: 50%;">
<p>ä½†æ˜¯æ¼æ¡¶ç®—æ³•ä¹Ÿå­˜åœ¨è‡´å‘½çš„é—®é¢˜ï¼Œå½“å„æœåŠ¡å¤§é‡è¯·æ±‚æ‰“è¿›æ¥ï¼Œæ¡¶å†…æµé‡å †ç§¯ä¼šé€ æˆç½‘å…³å‹åŠ›å·¨å¤§ï¼Œä¸€æ—¦ç½‘å…³å®•æœºï¼Œæ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿå°†å´©æºƒã€‚</p>
<h5 id="ä»¤ç‰Œæ¡¶ç®—æ³•">ä»¤ç‰Œæ¡¶ç®—æ³• </h5>
<p>ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯å¯¹æ¼æ¡¶ç®—æ³•çš„ä¸€ç§æ”¹è¿›ï¼Œæ¼æ¡¶ç®—æ³•èƒ½å¤Ÿé™åˆ¶è¯·æ±‚è°ƒç”¨çš„é€Ÿç‡ï¼Œè€Œä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶è°ƒç”¨çš„å¹³å‡é€Ÿç‡çš„åŒæ—¶è¿˜å…è®¸ä¸€å®šç¨‹åº¦çš„çªå‘è°ƒç”¨ã€‚åœ¨ä»¤ç‰Œæ¡¶ç®—æ³•ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªæ¡¶ï¼Œç”¨æ¥å­˜æ”¾å›ºå®šæ•°é‡çš„ä»¤ç‰Œã€‚<span style="color:#ff6e00;">ç®—æ³•ä¸­å­˜åœ¨ä¸€ç§æœºåˆ¶ï¼Œä»¥ä¸€å®šé€Ÿç‡å¾€æ¡¶ä¸­æ”¾ä»¤ç‰Œï¼Œæ¯æ¬¡è°ƒç”¨è¯·æ±‚éœ€è¦å…ˆè·å–ä»¤ç‰Œï¼Œåªæœ‰æ‹¿åˆ°ä»¤ç‰Œï¼Œæ‰æœ‰æœºä¼šç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™é€‰æ‹©ç­‰å¾…å¯ç”¨çš„ä»¤ç‰Œã€æˆ–è€…ç›´æ¥æ‹’ç»ã€‚</span>æ”¾ä»¤ç‰Œçš„è¿™ä¸ªåŠ¨ä½œæ˜¯æŒç»­ä¸æ–­åœ°è¿›è¡Œçš„ï¼Œå¦‚æœæ¡¶ä¸­ä»¤ç‰Œè¾¾åˆ°ä¸Šé™ï¼Œå°±ä¸¢å¼ƒä»¤ç‰Œã€‚</p>
<blockquote>
<p><strong>âœ¨ åœºæ™¯ï¼š</strong></p>
<p>æ¡¶ä¸­ä¸€ç›´æœ‰å¤§é‡å¯ç”¨çš„ä»¤ç‰Œï¼Œè¿™æ—¶å€™è¿›æ¥çš„è¯·æ±‚èƒ½å¤Ÿç›´æ¥æ‹¿åˆ°ä»¤ç‰Œæ‰§è¡Œã€‚æ¯”å¦‚è®¾ç½® QPS ä¸º100/sï¼Œé‚£ä¹ˆé™æµå™¨åˆå§‹åŒ–å®Œæˆ 1 s åï¼Œæ¡¶å†…å°±å·²ç»æœ‰äº† 100 ä¸ªä»¤ç‰Œï¼Œç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆå¯¹å¤–æä¾›æœåŠ¡æ—¶ï¼Œè¯¥é™æµå™¨å¯ä»¥æŠµæŒ¡ç¬æ—¶ 100 ä¸ªè¯·æ±‚ã€‚å½“æ¡¶ä¸­æ²¡æœ‰ä»¤ç‰Œï¼Œè¯·æ±‚ç»§ç»­ç­‰å¾…ï¼Œæœ€åç›¸å½“äºä»¥ä¸€å®šé€Ÿç‡æ‰§è¡Œã€‚</p>
</blockquote>
<p>Spring Cloud Zuul å†…éƒ¨ä½¿ç”¨çš„å°±æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œå¤§æ¦‚æè¿°å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¯¹æ‰€æœ‰çš„è¯·æ±‚åœ¨å¤„ç†ä¹‹å‰éƒ½éœ€è¦æ‹¿åˆ°ä¸€ä¸ªå¯ç”¨çš„ä»¤ç‰Œæ‰ä¼šè¢«å¤„ç†ï¼›</li>
<li>æ ¹æ®é™æµå¤§å°ï¼Œè®¾ç½®æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼›</li>
<li>æ¡¶è®¾ç½®æœ€å¤§çš„æ”¾ç½®ä»¤ç‰Œé™åˆ¶ï¼Œæ¡¶æ»¡æ—¶ï¼Œæ–°æ·»åŠ çš„ä»¤ç‰Œç›´æ¥ä¸¢å¼ƒæˆ–è¢«æ‹’ç»ï¼›</li>
<li>è¯·æ±‚è¾¾åˆ°åé¦–å…ˆè¦è·å–ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œï¼Œæ‹¿ç€ä»¤ç‰Œæ‰å¯ä»¥è¿›è¡Œå…¶ä»–çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¤„ç†å®Œä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå°†ä»¤ç‰Œç›´æ¥åˆ é™¤ï¼›</li>
<li><span style="color:#ff6e00;">ä»¤ç‰Œæ¡¶å­˜åœ¨æœ€ä½é™é¢ï¼Œå½“æ¡¶å†…ä»¤ç‰Œè¾¾åˆ°æœ€ä½é™é¢æ—¶ï¼Œè¯·æ±‚å¤„ç†å®Œåä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä»¥ä¿è¯è¶³å¤Ÿçš„é™æµï¼›</span></li>
</ul>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img src="./assets/image-20241223223610164.png" alt="image-20241223223610164" style="zoom:67%;">
<p>é€šè¿‡å¯¹æ¯”æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ¼æ¡¶ç®—æ³•ä¸»è¦ç”¨é€”åœ¨äºä¿æŠ¤å„ä¸ªå¾®æœåŠ¡ç»„ä»¶ï¼Œè€Œä»¤ç‰Œæ¡¶ç®—æ³•ä¸»è¦ç›®çš„åœ¨äºä¿æŠ¤ç½‘å…³æœ¬èº«ï¼Œå°†è¯·æ±‚çš„å‹åŠ›äº¤ç»™ç›®æ ‡æœåŠ¡è‡ªå·±å»å¤„ç†ã€‚å‡è®¾çªç„¶è¿›æ¥å¾ˆå¤šè¯·æ±‚ï¼Œåªæœ‰æ‹¿åˆ°ä»¤ç‰Œçš„è¯·æ±‚æ‰ä¼šç¬æ—¶è¢«å¤„ç†è°ƒç”¨ç›®æ ‡æœåŠ¡ã€‚</p>
<h4 id="zuul-é™æµå®ç°">Zuul é™æµå®ç° </h4>
<h5 id="é€šè¿‡-ratelimit-å®ç°é™æµ">é€šè¿‡ RateLimit å®ç°é™æµ </h5>
<h6 id="æ·»åŠ ä¾èµ–-1">æ·»åŠ ä¾èµ– </h6>
<blockquote>
<p>RateLimit å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://github.com/marcosbarbero/spring-cloud-zuul-ratelimit">https://github.com/marcosbarbero/spring-cloud-zuul-ratelimit</a></p>
</blockquote>
<p>Zuul çš„é™æµä¿æŠ¤éœ€è¦é¢å¤–å¼•å…¥ <code>spring-cloud-zuul-ratelimit</code> ç»„ä»¶ï¼Œé™æµæ•°æ®é‡‡ç”¨ Redis å­˜å‚¨ï¼Œæ‰€ä»¥è¿˜éœ€è¦æ·»åŠ  Redis ç»„ä»¶ã€‚</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.marcosbarbero.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-zuul-ratelimit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis-reactive<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><h6 id="å…¨å±€é™æµé…ç½®">å…¨å±€é™æµé…ç½® </h6>
<p>ä½¿ç”¨å…¨å±€é™æµé…ç½®ï¼ŒZuul å¯¹æ‰€æœ‰çš„æœåŠ¡æä¾›é™æµä¿æŠ¤ã€‚</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">10000</span> <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 117.24.15.104 <span class="token comment"># redisæœåŠ¡åœ°å€</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span> <span class="token comment"># redisæœåŠ¡ç«¯å£</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> redis_Fct28w <span class="token comment"># rediså¯†ç </span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># é€‰æ‹©å“ªä¸€ä¸ªåº“ï¼Œé»˜è®¤0åº“</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token comment"># æœ€å¤§è¿æ¥æ•°</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">10000</span> <span class="token comment">#æœ€å¤§è¿æ¥é˜»å¡ç­‰å¾…æ—¶é—´ï¼Œå•ä½ ms é»˜è®¤ -1</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token comment"># æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># æœ€å°ç©ºé—²è¿æ¥</span>
<span class="token comment"># Zuul ç½‘å…³æ ¸å¿ƒé…ç½®</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">ratelimit</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨è¯·æ±‚é™æµåŠŸèƒ½</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># é™æµç­–ç•¥ç±»å‹ï¼Œä½¿ç”¨ Redis å­˜å‚¨é™æµæ•°æ®</span>
    <span class="token key atrule">repository</span><span class="token punctuation">:</span> REDIS
    <span class="token comment"># å®šä¹‰é»˜è®¤çš„é™æµè§„åˆ™</span>
    <span class="token key atrule">default-policy-list</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token number">5</span>
        <span class="token key atrule">refresh-interval</span><span class="token punctuation">:</span> <span class="token number">60</span> <span class="token comment"># é»˜è®¤é™æµè§„åˆ™ï¼Œ1s å†…è¯·æ±‚è¶…è¿‡ 1000 æ¬¡åˆ™é™æµ</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> origin
          <span class="token punctuation">-</span> url
          <span class="token punctuation">-</span> user
</code></pre><p>åªè¦æˆ‘ä»¬åœ¨ 1åˆ†é’Ÿå†…è®¿é—® <a href="http://127.0.0.1:30000/autumnnook-system/test/info">http://127.0.0.1:30000/autumnnook-system/test/info</a> æœåŠ¡è¶…è¿‡ 5 æ¬¡ï¼Œå°±ä¼šè§¦å‘é™æµã€‚</p>
<p><img src="assets/image-20251222225628671.png" alt="image-20251222225628671"></p>
<h6 id="å±€éƒ¨é™æµé…ç½®">å±€éƒ¨é™æµé…ç½® </h6>
<p>ä½¿ç”¨å±€éƒ¨é™æµé…ç½®ï¼ŒZuul ä»…é’ˆå¯¹é…ç½®çš„æœåŠ¡æä¾›é™æµä¿æŠ¤ã€‚</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">10000</span> <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 117.24.15.104 <span class="token comment"># redisæœåŠ¡åœ°å€</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span> <span class="token comment"># redisæœåŠ¡ç«¯å£</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> redis_Fct28w <span class="token comment"># rediså¯†ç </span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment"># é€‰æ‹©å“ªä¸€ä¸ªåº“ï¼Œé»˜è®¤0åº“</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">1024</span> <span class="token comment"># æœ€å¤§è¿æ¥æ•°</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">10000</span> <span class="token comment">#æœ€å¤§è¿æ¥é˜»å¡ç­‰å¾…æ—¶é—´ï¼Œå•ä½ ms é»˜è®¤ -1</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">200</span> <span class="token comment"># æœ€å¤§ç©ºé—²è¿æ¥</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment"># æœ€å°ç©ºé—²è¿æ¥</span>
<span class="token comment"># Zuul ç½‘å…³æ ¸å¿ƒé…ç½®</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">ratelimit</span><span class="token punctuation">:</span>
    <span class="token comment"># æ˜¯å¦å¯ç”¨è¯·æ±‚é™æµåŠŸèƒ½</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># é™æµç­–ç•¥ç±»å‹ï¼Œä½¿ç”¨ Redis å­˜å‚¨é™æµæ•°æ®</span>
    <span class="token key atrule">repository</span><span class="token punctuation">:</span> REDIS
    <span class="token comment"># å®šä¹‰å…·ä½“çš„é™æµè§„åˆ™</span>
    <span class="token key atrule">policy-list</span><span class="token punctuation">:</span>
      <span class="token comment"># é’ˆå¯¹ autumnnook-system æœåŠ¡çš„é™æµè§„åˆ™</span>
      <span class="token key atrule">autumnnook-system</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">limit</span><span class="token punctuation">:</span> <span class="token number">5</span>
          <span class="token key atrule">refresh-interval</span><span class="token punctuation">:</span> <span class="token number">60</span> <span class="token comment"># åˆ·æ–°é—´éš”ï¼Œå•ä½ç§’ï¼Œ60s å†…è¯·æ±‚è¶…è¿‡ 5 æ¬¡åˆ™é™æµ</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> origin <span class="token comment"># æ ¹æ®è¯·æ±‚æ¥æºè¿›è¡Œé™æµ</span>
            <span class="token punctuation">-</span> url <span class="token comment"># æ ¹æ®è¯·æ±‚ URL è¿›è¡Œé™æµ</span>
            <span class="token punctuation">-</span> user <span class="token comment"># æ ¹æ®ç”¨æˆ·è¿›è¡Œé™æµ</span>
</code></pre><p>åªè¦æˆ‘ä»¬åœ¨ 1åˆ†é’Ÿå†…è®¿é—® <a href="http://127.0.0.1:30000/autumnnook-system/test/info">http://127.0.0.1:30000/autumnnook-system/test/info</a> æœåŠ¡è¶…è¿‡ 5 æ¬¡ï¼Œå°±ä¼šè§¦å‘é™æµã€‚</p>
<p><img src="assets/image-20251222225628671.png" alt="image-20251222225628671"></p>
<p>æŸ¥çœ‹ Redis éªŒè¯ä»¤ç‰Œã€‚</p>
<p><img src="assets/image-20251222230401996.png" alt="image-20251222230401996"></p>
<h6 id="è‡ªå®šä¹‰é™æµç­–ç•¥">è‡ªå®šä¹‰é™æµç­–ç•¥ </h6>
<p>å¦‚æœå¸Œæœ›è‡ªå·±æ§åˆ¶é™æµç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰ <code>RateLimitKeyGenerator</code> çš„å®ç°æ¥å¢åŠ è‡ªå·±çš„ç­–ç•¥é€»è¾‘ã€‚</p>
<p>ğŸ¯å‡è®¾æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦æ ¹æ® id å»æŸ¥è¯¢ä¸€ä¸ªèœå•çš„ä¿¡æ¯çš„æ—¶å€™ï¼Œå¾€å¾€æˆ‘ä»¬çš„ä¸šåŠ¡æ¥å£å¤§è‡´ä¼šè¿™ä¹ˆå†™ï¼š</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/getMenuById"</span><span class="token punctuation">)</span>
<span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getMenuById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token string">"return menu by id."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>è¿™æ ·å°±ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜å°±æ˜¯å‡è®¾æŸä¸ªèœå•åŠŸèƒ½åœ¨æŸä¸ªæ—¶é—´æ®µè¢«ç”¨æˆ·å¤§é‡ä½¿ç”¨ï¼Œç§°ä¸ºçƒ­é—¨åŠŸèƒ½ï¼Œå°±ä¼šå¯¼è‡´è§¦å‘é™æµï¼Œè€Œä¸€äº›å†·é—¨çš„èœå•ä¹Ÿä¼šæ”¶åˆ°ç‰µè¿ã€‚å¾€å¾€æˆ‘ä»¬ä½¿ç”¨ RESTful é£æ ¼å†™æ³•å°±å¯ä»¥é¿å…è¿™ç§é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸º url å§‹ç»ˆæ˜¯åœ¨å˜åŒ–çš„ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{id}"</span><span class="token punctuation">)</span>
<span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getMenuById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword keyword-return">return</span> <span class="token string">"return menu by id."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>å› æ­¤ä¸ºäº†é¿å…è¿™ç§ â€œè¯¯ä¼¤â€ ç°è±¡ï¼Œæˆ‘ä»¬å°±éœ€è¦è‡ªå®šä¹‰æˆ‘ä»¬çš„é™æµç­–ç•¥è¿›è¡Œé™æµã€‚</p>
<ul>
<li>é€šè¿‡ç»§æ‰¿ <code>DefaultRateLimitKeyGenerator</code> é‡å†™ <code>key()</code> æ–¹æ³•å®ç°</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">RateLimitGenerator</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">DefaultRateLimitKeyGenerator</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-public">public</span> <span class="token class-name">RateLimitGenerator</span><span class="token punctuation">(</span><span class="token class-name">RateLimitProperties</span> properties<span class="token punctuation">,</span> <span class="token class-name">RateLimitUtils</span> rateLimitUtils<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-super">super</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> rateLimitUtils<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">key</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Route</span> route<span class="token punctuation">,</span> <span class="token class-name">RateLimitProperties<span class="token punctuation">.</span>Policy</span> policy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯¹è¯·æ±‚å‚æ•°ä¸­ç›¸åŒçš„ id è¿›è¡Œé™æµ</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> route<span class="token punctuation">,</span> policy<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><ul>
<li>é€šè¿‡é…ç½®ç±»å®ç°ï¼ˆå…¶å®ç›®çš„éƒ½ä¸€æ ·ï¼‰</li>
</ul>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">RateLimitGeneratorConfiguration</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">RateLimitKeyGenerator</span> <span class="token function">rateLimitKeyGenerator</span><span class="token punctuation">(</span><span class="token class-name">RateLimitProperties</span> properties<span class="token punctuation">,</span> <span class="token class-name">RateLimitUtils</span> rateLimitUtils<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">DefaultRateLimitKeyGenerator</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> rateLimitUtils<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">key</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Route</span> route<span class="token punctuation">,</span> <span class="token class-name">RateLimitProperties<span class="token punctuation">.</span>Policy</span> policy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¯¹è¯·æ±‚å‚æ•°ä¸­ç›¸åŒçš„ id è¿›è¡Œé™æµ</span>
                <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-super">super</span><span class="token punctuation">.</span><span class="token function">key</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> route<span class="token punctuation">,</span> policy<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h5 id="é€šè¿‡-sentinel-å®ç°é™æµ">é€šè¿‡ Sentinel å®ç°é™æµ </h5>
<p>Sentinel æ”¯æŒå¯¹ Spring Cloud Gatewayã€Netflix Zuul ç­‰ä¸»æµçš„ API ç½‘å…³è¿›è¡Œé™æµã€‚</p>
<img src="assets/58381714-266d7980-7ff3-11e9-8617-d0d7c325d703.png" alt="sentinel-api-gateway-common-arch" style="zoom:50%;">
<p>å®˜æ–¹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel">https://github.com/alibaba/spring-cloud-alibaba/wiki/Sentinel</a></li>
<li><a href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81#zuul-1x">https://github.com/alibaba/Sentinel/wiki/ç½‘å…³é™æµ#zuul-1x</a></li>
</ul>
<p>ğŸ‘‰æœ€æ–°æ–‡æ¡£è¯·å‚è€ƒ <a href="https://sentinelguard.io/zh-cn/docs/api-gateway-flow-control.html">https://sentinelguard.io/zh-cn/docs/api-gateway-flow-control.html</a></p>
<p>Sentinel 1.6.0 å¼•å…¥äº† Sentinel API Gateway Adapter Common æ¨¡å—ï¼Œæ­¤æ¨¡å—ä¸­åŒ…å«ç½‘å…³é™æµçš„è§„åˆ™å’Œè‡ªå®šä¹‰ API çš„å®ä½“å’Œç®¡ç†é€»è¾‘ã€‚</p>
<ul>
<li><span style="color:#3370ff;font-weight:bold;">GatewayFlowRuleï¼š</span> ç½‘å…³é™æµè§„åˆ™ï¼Œé’ˆå¯¹ API Gateway çš„åœºæ™¯å®šåˆ¶çš„é™æµè§„åˆ™ï¼Œå¯ä»¥é’ˆå¯¹ä¸åŒ route æˆ–è‡ªå®šä¹‰çš„ API åˆ†ç»„è¿›è¡Œé™æµï¼Œæ”¯æŒé’ˆå¯¹è¯·æ±‚ä¸­çš„å‚æ•°ã€Headerã€æ¥æº IP ç­‰è¿›è¡Œå®šåˆ¶åŒ–çš„é™æµã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">ApiDefinitionï¼š</span>ç”¨æˆ·è‡ªå®šä¹‰çš„ API å®šä¹‰åˆ†ç»„ï¼Œå¯ä»¥çœ‹åšæ˜¯ä¸€äº› URL åŒ¹é…çš„ç»„åˆã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª API å« <code>my_api</code>ï¼Œè¯·æ±‚ path æ¨¡å¼ä¸º <code>/foo/**</code> å’Œ <code>/baz/**</code> çš„éƒ½å½’åˆ° <code>my_api</code> è¿™ä¸ª API åˆ†ç»„ä¸‹é¢ã€‚é™æµçš„æ—¶å€™å¯ä»¥é’ˆå¯¹è¿™ä¸ªè‡ªå®šä¹‰çš„ API åˆ†ç»„ç»´åº¦è¿›è¡Œé™æµã€‚</li>
</ul>
<p>å…¶ä¸­ç½‘å…³é™æµè§„åˆ™  GatewayFlowRule çš„å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼š</p>
<ul>
<li><span style="color:#3370ff;font-weight:bold;">resourceï¼š</span>èµ„æºåç§°ï¼Œå¯ä»¥æ˜¯ç½‘å…³ä¸­çš„ route åç§°æˆ–è€…ç”¨æˆ·è‡ªå®šä¹‰çš„ API åˆ†ç»„åç§°ã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">resourceModeï¼š</span>è§„åˆ™æ˜¯é’ˆå¯¹ API Gateway çš„ routeï¼ˆ<code>RESOURCE_MODE_ROUTE_ID</code>ï¼‰è¿˜æ˜¯ç”¨æˆ·åœ¨ Sentinel ä¸­å®šä¹‰çš„ API åˆ†ç»„ï¼ˆ<code>RESOURCE_MODE_CUSTOM_API_NAME</code>ï¼‰ï¼Œé»˜è®¤æ˜¯ routeã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">gradeï¼š</span>é™æµæŒ‡æ ‡ç»´åº¦ï¼ŒåŒé™æµè§„åˆ™çš„ <code>grade</code> å­—æ®µã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">countï¼š</span>é™æµé˜ˆå€¼</li>
<li><span style="color:#3370ff;font-weight:bold;">intervalSecï¼š</span>ç»Ÿè®¡æ—¶é—´çª—å£ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤æ˜¯ 1 ç§’ã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">controlBehaviorï¼š</span>æµé‡æ•´å½¢çš„æ§åˆ¶æ•ˆæœï¼ŒåŒé™æµè§„åˆ™çš„ <code>controlBehavior</code> å­—æ®µï¼Œç›®å‰æ”¯æŒå¿«é€Ÿå¤±è´¥å’ŒåŒ€é€Ÿæ’é˜Ÿä¸¤ç§æ¨¡å¼ï¼Œé»˜è®¤æ˜¯å¿«é€Ÿå¤±è´¥ã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">burstï¼š</span>åº”å¯¹çªå‘è¯·æ±‚æ—¶é¢å¤–å…è®¸çš„è¯·æ±‚æ•°ç›®ã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">maxQueueingTimeoutMsï¼š</span>åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ä¸‹çš„æœ€é•¿æ’é˜Ÿæ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œä»…åœ¨åŒ€é€Ÿæ’é˜Ÿæ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚</li>
<li><span style="color:#3370ff;font-weight:bold;">paramItemï¼š</span>å‚æ•°é™æµé…ç½®ã€‚è‹¥ä¸æä¾›ï¼Œåˆ™ä»£è¡¨ä¸é’ˆå¯¹å‚æ•°è¿›è¡Œé™æµï¼Œè¯¥ç½‘å…³è§„åˆ™å°†ä¼šè¢«è½¬æ¢æˆæ™®é€šæµæ§è§„åˆ™ï¼›å¦åˆ™ä¼šè½¬æ¢æˆçƒ­ç‚¹è§„åˆ™ã€‚å…¶ä¸­çš„å­—æ®µï¼š
<ul>
<li><span style="color:#7faff6;font-weight:bold;">parseStrategyï¼š</span>ä»è¯·æ±‚ä¸­æå–å‚æ•°çš„ç­–ç•¥ï¼Œç›®å‰æ”¯æŒæå–æ¥æº IPï¼ˆ<code>PARAM_PARSE_STRATEGY_CLIENT_IP</code>ï¼‰ã€Hostï¼ˆ<code>PARAM_PARSE_STRATEGY_HOST</code>ï¼‰ã€ä»»æ„ Headerï¼ˆ<code>PARAM_PARSE_STRATEGY_HEADER</code>ï¼‰å’Œä»»æ„ URL å‚æ•°ï¼ˆ<code>PARAM_PARSE_STRATEGY_URL_PARAM</code>ï¼‰å››ç§æ¨¡å¼ã€‚</li>
<li><span style="color:#7faff6;font-weight:bold;">fieldNameï¼š</span>è‹¥æå–ç­–ç•¥é€‰æ‹© Header æ¨¡å¼æˆ– URL å‚æ•°æ¨¡å¼ï¼Œåˆ™éœ€è¦æŒ‡å®šå¯¹åº”çš„ header åç§°æˆ– URL å‚æ•°åç§°ã€‚</li>
<li><span style="color:#7faff6;font-weight:bold;">patternï¼š</span>å‚æ•°å€¼çš„åŒ¹é…æ¨¡å¼ï¼Œåªæœ‰åŒ¹é…è¯¥æ¨¡å¼çš„è¯·æ±‚å±æ€§å€¼ä¼šçº³å…¥ç»Ÿè®¡å’Œæµæ§ï¼›è‹¥ä¸ºç©ºåˆ™ç»Ÿè®¡è¯¥è¯·æ±‚å±æ€§çš„æ‰€æœ‰å€¼ã€‚ï¼ˆ1.6.2 ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼‰</li>
<li><span style="color:#7faff6;font-weight:bold;">matchStrategyï¼š</span>å‚æ•°å€¼çš„åŒ¹é…ç­–ç•¥ï¼Œç›®å‰æ”¯æŒç²¾ç¡®åŒ¹é…ï¼ˆ<code>PARAM_MATCH_STRATEGY_EXACT</code>ï¼‰ã€å­ä¸²åŒ¹é…ï¼ˆ<code>PARAM_MATCH_STRATEGY_CONTAINS</code>ï¼‰å’Œæ­£åˆ™åŒ¹é…ï¼ˆ<code>PARAM_MATCH_STRATEGY_REGEX</code>ï¼‰ã€‚ï¼ˆ1.6.2 ç‰ˆæœ¬å¼€å§‹æ”¯æŒï¼‰</li>
</ul>
</li>
</ul>
<p>ç”¨æˆ·å¯ä»¥é€šè¿‡ <code>GatewayRuleManager.loadRules(rules)</code> æ‰‹åŠ¨åŠ è½½ç½‘å…³è§„åˆ™ï¼Œæˆ–é€šè¿‡ <code>GatewayRuleManager.register2Property(property)</code> æ³¨å†ŒåŠ¨æ€è§„åˆ™æºåŠ¨æ€æ¨é€ï¼ˆæ¨èæ–¹å¼ï¼‰ã€‚</p>
<h6 id="æ·»åŠ ä¾èµ–-2">æ·»åŠ ä¾èµ– </h6>
<p><a href="https://github.com/alibaba/Sentinel/wiki/%E7%BD%91%E5%85%B3%E9%99%90%E6%B5%81">å‚è€ƒ Sentinel ç½‘å…³é™æµæ–‡æ¡£</a></p>
<p>å¦‚æœå•ç‹¬ä½¿ç”¨ï¼Œåªéœ€è¦æ·»åŠ  <code>sentinel-zuul-adapter</code> ç»„ä»¶å³å¯ã€‚</p>
<p>è‹¥æƒ³è·Ÿ Sentinel Starter é…åˆä½¿ç”¨ï¼Œéœ€è¦åŠ ä¸Š <code>spring-cloud-alibaba-sentinel-gateway</code> ä¾èµ–ï¼ŒåŒæ—¶éœ€è¦æ·»åŠ  <code>spring-cloud-starter-netflix-zuul</code> ä¾èµ–æ¥è®© <code>spring-cloud-alibaba-sentinel-gateway</code> æ¨¡å—é‡Œçš„ Zuul è‡ªåŠ¨åŒ–é…ç½®ç±»ç”Ÿæ•ˆï¼š</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-sentinel-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>åŒæ—¶è¯·å°† <code>spring.cloud.sentinel.filter.enabled</code> é…ç½®é¡¹ç½®ä¸º falseï¼ˆè‹¥åœ¨ç½‘å…³æµæ§æ§åˆ¶å°ä¸Šçœ‹åˆ°äº† URL èµ„æºï¼Œå°±æ˜¯æ­¤é…ç½®é¡¹æ²¡æœ‰ç½®ä¸º falseï¼‰ã€‚Sentinel ç½‘å…³æµæ§é»˜è®¤çš„ç²’åº¦æ˜¯ route ç»´åº¦ä»¥åŠè‡ªå®šä¹‰ API åˆ†ç»„ç»´åº¦ï¼Œé»˜è®¤<strong>ä¸æ”¯æŒ URL ç²’åº¦</strong>ã€‚å¦‚éœ€ç»†åŒ–åˆ° URL ç²’åº¦ï¼Œè¯·å‚è€ƒ <a href="https://sentinelguard.io/zh-cn/docs/api-gateway-flow-control.html">ç½‘å…³æµæ§æ–‡æ¡£</a> è‡ªå®šä¹‰ API åˆ†ç»„ã€‚</p>
<h6 id="zuul-1x-å•ç‹¬ä½¿ç”¨">Zuul 1.x å•ç‹¬ä½¿ç”¨ </h6>
<p>Sentinel æä¾›äº† Zuul 1.x çš„é€‚é…æ¨¡å—ï¼Œå¯ä»¥ä¸º Zuul Gateway æä¾›ä¸¤ç§èµ„æºç»´åº¦çš„é™æµï¼š</p>
<ul>
<li>route ç»´åº¦ï¼šå³åœ¨ Spring é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„è·¯ç”±æ¡ç›®ï¼Œèµ„æºåä¸ºå¯¹åº”çš„ route IDï¼ˆå¯¹åº” <code>RequestContext</code> ä¸­çš„ <code>proxy</code> å­—æ®µï¼‰</li>
<li>è‡ªå®šä¹‰ API ç»´åº¦ï¼šç”¨æˆ·å¯ä»¥åˆ©ç”¨ Sentinel æä¾›çš„ API æ¥è‡ªå®šä¹‰ä¸€äº› API åˆ†ç»„</li>
</ul>
<p>ä½¿ç”¨æ—¶éœ€å¼•å…¥ä»¥ä¸‹æ¨¡å—ï¼ˆä»¥ Maven ä¸ºä¾‹ï¼‰ï¼š</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.csp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>sentinel-zuul-adapter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--&lt;version&gt;x.y.z&lt;/version&gt;--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>è‹¥ä½¿ç”¨çš„æ˜¯ Spring Cloud Netflix Zuulï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨é…ç½®ç±»ä¸­å°†ä¸‰ä¸ª filter æ³¨å…¥åˆ° Spring ç¯å¢ƒä¸­å³å¯ï¼š</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">ZuulFilter</span> <span class="token function">sentinelZuulPreFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// We can also provider the filter order in the constructor.</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SentinelZuulPreFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">ZuulFilter</span> <span class="token function">sentinelZuulPostFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SentinelZuulPostFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">ZuulFilter</span> <span class="token function">sentinelZuulErrorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">SentinelZuulErrorFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GatewayFlowRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">GatewayFlowRule</span><span class="token punctuation">(</span><span class="token string">"autumnnook-system"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">//é™æµé˜ˆå€¼</span>
                <span class="token punctuation">.</span><span class="token function">setIntervalSec</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 60s å†…è®¿é—®è¶…è¿‡ 3 æ¬¡åˆ™é™æµï¼Œé»˜è®¤1s</span>
        <span class="token class-name">GatewayRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>Sentinel Zuul Adapter ç”Ÿæˆçš„è°ƒç”¨é“¾è·¯ç±»ä¼¼äºä¸‹é¢ï¼Œå…¶ä¸­çš„èµ„æºåéƒ½æ˜¯ route ID æˆ–è€…è‡ªå®šä¹‰çš„ API åˆ†ç»„åç§°ï¼š</p>
<pre data-role="codeBlock" data-info="bash" class="language-bash bash"><code>-EntranceNode: sentinel_gateway_context<span class="token variable">$$</span>route<span class="token variable">$$</span>another-route-b<span class="token punctuation">(</span>t:0 pq:0.0 bq:0.0 tq:0.0 rt:0.0 prq:0.0 1mp:8 1mb:1 1mt:9<span class="token punctuation">)</span>
--another-route-b<span class="token punctuation">(</span>t:0 pq:0.0 bq:0.0 tq:0.0 rt:0.0 prq:0.0 1mp:4 1mb:1 1mt:5<span class="token punctuation">)</span>
--another_customized_api<span class="token punctuation">(</span>t:0 pq:0.0 bq:0.0 tq:0.0 rt:0.0 prq:0.0 1mp:4 1mb:0 1mt:4<span class="token punctuation">)</span>
-EntranceNode: sentinel_gateway_context<span class="token variable">$$</span>route<span class="token variable">$$</span>my-route-1<span class="token punctuation">(</span>t:0 pq:0.0 bq:0.0 tq:0.0 rt:0.0 prq:0.0 1mp:6 1mb:0 1mt:6<span class="token punctuation">)</span>
--my-route-1<span class="token punctuation">(</span>t:0 pq:0.0 bq:0.0 tq:0.0 rt:0.0 prq:0.0 1mp:2 1mb:0 1mt:2<span class="token punctuation">)</span>
--some_customized_api<span class="token punctuation">(</span>t:0 pq:0.0 bq:0.0 tq:0.0 rt:0.0 prq:0.0 1mp:2 1mb:0 1mt:2<span class="token punctuation">)</span>
</code></pre><p>å‘ç”Ÿé™æµä¹‹åçš„å¤„ç†æµç¨‹ ï¼š</p>
<ul>
<li>å‘ç”Ÿé™æµä¹‹åå¯è‡ªå®šä¹‰è¿”å›å‚æ•°ï¼Œé€šè¿‡å®ç° <code>SentinelFallbackProvider</code> æ¥å£ï¼Œé»˜è®¤çš„å®ç°æ˜¯ <code>DefaultBlockFallbackProvider</code>ã€‚</li>
<li>é»˜è®¤çš„ fallback route çš„è§„åˆ™æ˜¯ route ID æˆ–è‡ªå®šä¹‰çš„ API åˆ†ç»„åç§°ã€‚</li>
</ul>
<p>æ¯”å¦‚ï¼š</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token comment">// è‡ªå®šä¹‰ FallbackProvider </span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">MyBlockFallbackProvider</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">ZuulBlockFallbackProvider</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-private">private</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">DefaultBlockFallbackProvider</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"/book/app"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">BlockResponse</span> <span class="token function">fallbackResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> route<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RecordLog</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"[Sentinel DefaultBlockFallbackProvider] Run fallback route: %s"</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cause <span class="token keyword keyword-instanceof">instanceof</span> <span class="token class-name">BlockException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">BlockResponse</span><span class="token punctuation">(</span><span class="token number">429</span><span class="token punctuation">,</span> <span class="token string">"Sentinel block exception"</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">BlockResponse</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">"System Error"</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 
 <span class="token comment">// æ³¨å†Œ FallbackProvider</span>
 <span class="token class-name">ZuulBlockFallbackManager</span><span class="token punctuation">.</span><span class="token function">registerProvider</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">MyBlockFallbackProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>é»˜è®¤æƒ…å†µä¸‹é™æµåä¼šè¿”å› 429 çŠ¶æ€ç ï¼Œè¿”å›ç»“æœä¸ºï¼š</p>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
    <span class="token property">"code"</span><span class="token operator">:</span><span class="token number">429</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span><span class="token string">"Sentinel block exception"</span><span class="token punctuation">,</span>
    <span class="token property">"route"</span><span class="token operator">:</span><span class="token string">"/"</span>
<span class="token punctuation">}</span>
</code></pre><p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>Sentinel ç½‘å…³æµæ§é»˜è®¤çš„ç²’åº¦æ˜¯ route ç»´åº¦ä»¥åŠè‡ªå®šä¹‰ API åˆ†ç»„ç»´åº¦ï¼Œé»˜è®¤<strong>ä¸æ”¯æŒ URL ç²’åº¦</strong>ã€‚è‹¥é€šè¿‡ Spring Cloud Alibaba æ¥å…¥ï¼Œè¯·å°† <code>spring.cloud.sentinel.filter.enabled</code> é…ç½®é¡¹ç½®ä¸º falseï¼ˆè‹¥åœ¨ç½‘å…³æµæ§æ§åˆ¶å°ä¸Šçœ‹åˆ°äº† URL èµ„æºï¼Œå°±æ˜¯æ­¤é…ç½®é¡¹æ²¡æœ‰ç½®ä¸º falseï¼‰ã€‚</li>
<li>è‹¥ä½¿ç”¨ Spring Cloud Alibaba Sentinel æ•°æ®æºæ¨¡å—ï¼Œéœ€è¦æ³¨æ„ç½‘å…³æµæ§è§„åˆ™æ•°æ®æºç±»å‹æ˜¯ <code>gw-flow</code>ï¼Œè‹¥å°†ç½‘å…³æµæ§è§„åˆ™æ•°æ®æºæŒ‡å®šä¸º flow åˆ™ä¸ç”Ÿæ•ˆã€‚</li>
</ul>
<p>è®¿é—®æœåŠ¡ <a href="http://localhost:30000/autumnnook-system/test/status">http://localhost:30000/autumnnook-system/test/status</a> å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="assets/image-20251223145604534.png" alt="image-20251223145604534"></p>
<h6 id="ç»“åˆ-starter-ä½¿ç”¨">ç»“åˆ Starter ä½¿ç”¨ </h6>
<p>ä½¿ç”¨ starter ç›¸å…³ä¾èµ–ï¼Œæ³¨é‡Šæ‰ <code>sentinel-zuul-adapter</code> ç»„ä»¶ä¾èµ–ã€‚</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-sentinel<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-alibaba-sentinel-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-zuul<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>é…ç½®æ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹ã€‚</p>
<pre data-role="codeBlock" data-info="yaml" class="language-yaml yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
      <span class="token key atrule">filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre><p>åŒæ ·çš„æ·»åŠ  ZuulConfig é…ç½®ç±»ï¼Œè‡ªå®šä¹‰é™æµé˜ˆå€¼ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulConfig</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GatewayFlowRule</span><span class="token punctuation">&gt;</span></span> rules <span class="token operator">=</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rules<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">GatewayFlowRule</span><span class="token punctuation">(</span><span class="token string">"autumnnook-system"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setCount</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment">//é™æµé˜ˆå€¼</span>
                <span class="token punctuation">.</span><span class="token function">setIntervalSec</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 60s å†…è®¿é—®è¶…è¿‡ 3 æ¬¡åˆ™é™æµï¼Œé»˜è®¤1s</span>
        <span class="token class-name">GatewayRuleManager</span><span class="token punctuation">.</span><span class="token function">loadRules</span><span class="token punctuation">(</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>è®¿é—®æœåŠ¡ <a href="http://localhost:30000/autumnnook-system/test/status">http://localhost:30000/autumnnook-system/test/status</a> å¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="assets/image-20251223150357626.png" alt="image-20251223150357626"></p>
<h6 id="è‡ªå®šä¹‰-sentinel-é™æµå¼‚å¸¸ç½‘å…³ç†”æ–­">è‡ªå®šä¹‰ Sentinel é™æµå¼‚å¸¸ï¼ˆç½‘å…³ç†”æ–­ï¼‰ </h6>
<p>å‘ç”Ÿé™æµä¹‹åçš„å¤„ç†æµç¨‹ï¼š</p>
<ul>
<li>å‘ç”Ÿé™æµä¹‹åå¯è‡ªå®šä¹‰è¿”å›å‚æ•°ï¼Œé€šè¿‡å®ç° <code>ZuulBlockFallbackProvider</code> æ¥å£ï¼Œé»˜è®¤çš„å®ç°æ˜¯ <code>DefaultBlockFallbackProvier</code>ï¼›</li>
<li>é»˜è®¤çš„ fallback route çš„è§„åˆ™æ˜¯ route ID æˆ–è‡ªå®šä¹‰çš„ API åˆ†ç»„åç§°ï¼›</li>
</ul>
<ol>
<li>ç¼–å†™é™æµå¤„ç†ç±»-å¯¹å…·ä½“æœåŠ¡è¿›è¡Œå®¹é”™å¤„ç†</li>
</ol>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">BlockResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">ZuulBlockFallbackProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>log<span class="token punctuation">.</span></span><span class="token class-name">RecordLog</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>slots<span class="token punctuation">.</span>block<span class="token punctuation">.</span></span><span class="token class-name">BlockException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulFallbackProvider</span> <span class="token keyword keyword-implements">implements</span> <span class="token class-name">ZuulBlockFallbackProvider</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">getRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"autumnnook-system"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">BlockResponse</span> <span class="token function">fallbackResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> route<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">RecordLog</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"[Sentinel DefaultBlockFallbackProvider] Run fallback route: %s"</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>cause <span class="token keyword keyword-instanceof">instanceof</span> <span class="token class-name">BlockException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">BlockResponse</span><span class="token punctuation">(</span><span class="token number">429</span><span class="token punctuation">,</span> <span class="token string">"æœåŠ¡è®¿é—®å‹åŠ›è¿‡å¤§ï¼Œè¯·ç¨åé‡è¯•ï¼"</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-else">else</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">BlockResponse</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">"ç³»ç»Ÿé”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼"</span><span class="token punctuation">,</span> route<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ol start="2">
<li>æ³¨å†Œç½‘å…³ç†”æ–­æä¾›è€…</li>
</ol>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>common<span class="token punctuation">.</span>rule<span class="token punctuation">.</span></span><span class="token class-name">GatewayFlowRule</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>common<span class="token punctuation">.</span>rule<span class="token punctuation">.</span></span><span class="token class-name">GatewayRuleManager</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">ZuulBlockFallbackManager</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SentinelZuulErrorFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SentinelZuulPostFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>csp<span class="token punctuation">.</span>sentinel<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SentinelZuulPreFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>autumnnook<span class="token punctuation">.</span>fallback<span class="token punctuation">.</span></span><span class="token class-name">ZuulFallbackProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>autumnnook<span class="token punctuation">.</span>locator<span class="token punctuation">.</span></span><span class="token class-name">SimpleRoutingLocater</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">ZuulFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">ServerProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">SimpleRouteLocator</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>filters<span class="token punctuation">.</span></span><span class="token class-name">ZuulProperties</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Primary</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">PostConstruct</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashSet</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * Zuulç½‘å…³é…ç½®ç±»
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç±»è´Ÿè´£é…ç½®Zuulç½‘å…³çš„æ ¸å¿ƒç»„ä»¶ï¼Œç‰¹åˆ«æ˜¯è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨çš„æ³¨å†Œå’Œåˆå§‹åŒ–ã€‚
 * é€šè¿‡æ›¿æ¢é»˜è®¤çš„è·¯ç”±å®šä½å™¨ï¼Œå®ç°åŸºäºæœåŠ¡å‘ç°çš„åŠ¨æ€è·¯ç”±ç®¡ç†ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>ä¸»è¦åŠŸèƒ½ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>é…ç½®è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨Bean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å…¥Zuulå’ŒæœåŠ¡å™¨ç›¸å…³é…ç½®å±æ€§<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç¡®ä¿è‡ªå®šä¹‰è·¯ç”±å®šä½å™¨ä¼˜å…ˆäºé»˜è®¤å®ç°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>é…ç½®è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Configuration</span></span><span class="token punctuation">}</span>æ ‡è¯†ä¸ºé…ç½®ç±»<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">RequiredArgsConstructor</span></span><span class="token punctuation">}</span>è‡ªåŠ¨ç”Ÿæˆæ„é€ å‡½æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½¿ç”¨<span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">Primary</span></span><span class="token punctuation">}</span>ç¡®ä¿è‡ªå®šä¹‰Beanä¼˜å…ˆè¢«ä½¿ç”¨<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 * <span class="token keyword keyword-@version">@version</span> 1.0
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">SimpleRoutingLocater</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">ZuulProperties</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">ServerProperties</span></span>
 * <span class="token keyword keyword-@since">@since</span> 2024
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-void">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ZuulBlockFallbackManager</span><span class="token punctuation">.</span><span class="token function">registerProvider</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">ZuulFallbackProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><p>é‡å¯ zuul ç½‘å…³ï¼Œè®¿é—® <a href="http://127.0.0.1:30000/autumnnook-system/test/status">http://127.0.0.1:30000/autumnnook-system/test/status</a> å¤šæ¬¡ï¼Œè§¦å‘é™æµï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="assets/image-20251223151925530.png" alt="image-20251223151925530"></p>
<h4 id="ç½‘å…³é™æµé”™è¯¯å¤„ç†">ç½‘å…³é™æµé”™è¯¯å¤„ç† </h4>
<p>é…ç½® <code>error</code> ç±»å‹çš„ç½‘å…³è¿‡æ»¤å™¨è¿›è¡Œå¤„ç†å³å¯ï¼Œä¿®æ”¹ä¹‹å‰çš„ <code>ErrorFilter</code> è®©å…¶å˜å¾—é€šç”¨ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">ZuulFilter</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">RequestContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">ZuulException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ZuulRuntimeException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * è‡ªå®šä¹‰ Zuul ç½‘å…³è¿‡æ»¤å™¨ ä½œç”¨ï¼šå®ç°è¯·æ±‚çº§åˆ«çš„è‡ªå®šä¹‰å¤„ç†é€»è¾‘ï¼Œå¦‚æ—¥å¿—è®°å½•ã€æƒé™éªŒè¯ã€å‚æ•°æ ¡éªŒç­‰ ç”Ÿå‘½å‘¨æœŸï¼šåœ¨è¯·æ±‚ç»è¿‡ Zuul ç½‘å…³æ—¶è¢«è°ƒç”¨ï¼ŒæŒ‰ç…§è¿‡æ»¤å™¨ç±»å‹å’Œé¡ºåºæ‰§è¡Œ
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ErrorFilter</span> <span class="token keyword keyword-extends">extends</span> <span class="token class-name">ZuulFilter</span> <span class="token punctuation">{</span>

    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ErrorFilter</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨ç±»å‹å®šä¹‰ è¿”å›å€¼å¿…é¡»æ˜¯ä»¥ä¸‹å››ç§ç±»å‹ä¹‹ä¸€ï¼š - "pre":    å‰ç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹å‰æ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šèº«ä»½éªŒè¯ã€æ—¥å¿—è®°å½•ã€é™æµç­‰ - "route":  è·¯ç”±è¿‡æ»¤å™¨ï¼Œè´Ÿè´£å°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“çš„å¾®æœåŠ¡
     * å…¸å‹ç”¨é€”ï¼šHTTPè¯·æ±‚è½¬å‘ã€æœåŠ¡å‘ç°é›†æˆ - "post":   åç½®è¿‡æ»¤å™¨ï¼Œåœ¨è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ä¹‹åæ‰§è¡Œ å…¸å‹ç”¨é€”ï¼šå“åº”å¤´ä¿®æ”¹ã€ç»Ÿè®¡ä¿¡æ¯æ”¶é›†ã€æ—¥å¿—è®°å½• - "error":  é”™è¯¯è¿‡æ»¤å™¨ï¼Œå½“è¯·æ±‚å¤„ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶æ‰§è¡Œ
     * å…¸å‹ç”¨é€”ï¼šé”™è¯¯å¤„ç†ã€å¼‚å¸¸å“åº”æ ¼å¼åŒ–
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨ç±»å‹å­—ç¬¦ä¸²
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">String</span> <span class="token function">filterType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">"pre"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº ä½œç”¨ï¼šå½“æœ‰å¤šä¸ªåŒç±»å‹è¿‡æ»¤å™¨æ—¶ï¼Œç¡®å®šå®ƒä»¬çš„æ‰§è¡Œé¡ºåº è§„åˆ™ï¼šæ•°å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæ‰§è¡Œè¶Šé å‰ èŒƒå›´ï¼šå¯ä»¥æ˜¯ä»»æ„æ•´æ•°ï¼Œé€šå¸¸ä½¿ç”¨ 0, 1, 2, ... ç­‰ ç¤ºä¾‹ï¼š - è®¤è¯è¿‡æ»¤å™¨ï¼šorder = 0ï¼ˆæœ€å…ˆæ‰§è¡Œï¼ŒéªŒè¯èº«ä»½ï¼‰ -
     * æ—¥å¿—è¿‡æ»¤å™¨ï¼šorder = 1ï¼ˆå…¶æ¬¡æ‰§è¡Œï¼Œè®°å½•è¯·æ±‚ï¼‰ - å‚æ•°æ ¡éªŒè¿‡æ»¤å™¨ï¼šorder = 2ï¼ˆæœ€åæ‰§è¡Œï¼Œæ ¡éªŒå‚æ•°ï¼‰
     *
     * <span class="token keyword keyword-@return">@return</span> è¿‡æ»¤å™¨æ‰§è¡Œé¡ºåºçš„æ•´æ•°å€¼
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-int">int</span> <span class="token function">filterOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * æ˜¯å¦å¯ç”¨è¯¥è¿‡æ»¤å™¨ ä½œç”¨ï¼šåŠ¨æ€æ§åˆ¶è¿‡æ»¤å™¨æ˜¯å¦æ‰§è¡Œ è¿”å›å€¼ï¼š - true:  æ‰§è¡Œè¯¥è¿‡æ»¤å™¨çš„ run() æ–¹æ³• - false: è·³è¿‡è¯¥è¿‡æ»¤å™¨ï¼Œä¸æ‰§è¡Œ run() æ–¹æ³• åº”ç”¨åœºæ™¯ï¼š 1. æ ¹æ®è¯·æ±‚è·¯å¾„å†³å®šæ˜¯å¦æ‰§è¡Œï¼ˆå¦‚åªå¯¹ /api/**
     * è·¯å¾„ç”Ÿæ•ˆï¼‰ 2. æ ¹æ®é…ç½®å¼€å…³åŠ¨æ€å¯ç”¨/ç¦ç”¨è¿‡æ»¤å™¨ 3. æ ¹æ®è¯·æ±‚å¤´æˆ–å‚æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦è¿‡æ»¤
     *
     * <span class="token keyword keyword-@return">@return</span> å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦æ‰§è¡Œè¯¥è¿‡æ»¤å™¨
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-boolean">boolean</span> <span class="token function">shouldFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-return">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * è¿‡æ»¤å™¨çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ä½œç”¨ï¼šå®ç°å…·ä½“çš„è¿‡æ»¤å¤„ç†é€»è¾‘ æ‰§è¡Œæ—¶æœºï¼šå½“ shouldFilter() è¿”å› true æ—¶è¢«è°ƒç”¨ å…³é”®å¯¹è±¡ï¼š 1. RequestContext: Zuul è¯·æ±‚ä¸Šä¸‹æ–‡ï¼Œå­˜å‚¨è¯·æ±‚/å“åº”ä¿¡æ¯ 2.
     * HttpServletRequest: åŸå§‹ HTTP è¯·æ±‚å¯¹è±¡ å¸¸ç”¨æ“ä½œï¼š 1. è·å–è¯·æ±‚ä¿¡æ¯ï¼šURLã€æ–¹æ³•ã€å¤´ä¿¡æ¯ã€å‚æ•°ç­‰ 2. ä¿®æ”¹è¯·æ±‚ï¼šæ·»åŠ /åˆ é™¤è¯·æ±‚å¤´ã€ä¿®æ”¹è¯·æ±‚å‚æ•° 3. ä¸­æ–­è¯·æ±‚ï¼šè®¾ç½®
     * context.setSendZuulResponse(false) é˜»æ­¢è½¬å‘ 4. è®¾ç½®å“åº”ï¼šç›´æ¥è¿”å›å“åº”ï¼Œä¸è½¬å‘åˆ°åç«¯æœåŠ¡
     *
     * <span class="token keyword keyword-@return">@return</span> é€šå¸¸è¿”å› nullï¼Œç‰¹æ®Šæƒ…å†µä¸‹å¯è¿”å›ä»»æ„å¯¹è±¡
     * <span class="token keyword keyword-@throws">@throws</span> <span class="token reference"><span class="token class-name">ZuulException</span></span> å¤„ç†è¿‡ç¨‹ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword keyword-public">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-throws">throws</span> <span class="token class-name">ZuulException</span> <span class="token punctuation">{</span>
        <span class="token class-name">RequestContext</span> rc <span class="token operator">=</span> <span class="token class-name">RequestContext</span><span class="token punctuation">.</span><span class="token function">getCurrentContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ZuulException</span> exception <span class="token operator">=</span> <span class="token function">findZuulException</span><span class="token punctuation">(</span>rc<span class="token punctuation">.</span><span class="token function">getThrowable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ErrorFilter caught an exception: {}"</span><span class="token punctuation">,</span> exception<span class="token punctuation">.</span>errorCause<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpStatus</span> status <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token number">429</span> <span class="token operator">==</span> exception<span class="token punctuation">.</span>nStatusCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            status <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">TOO_MANY_REQUESTS</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token number">500</span> <span class="token operator">==</span> exception<span class="token punctuation">.</span>nStatusCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            status <span class="token operator">=</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        rc<span class="token punctuation">.</span><span class="token function">setResponseStatusCode</span><span class="token punctuation">(</span>status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rc<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/json;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">PrintWriter</span> writer <span class="token operator">=</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-try">try</span> <span class="token punctuation">{</span>
            writer <span class="token operator">=</span> rc<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"{\"code\":"</span> <span class="token operator">+</span> status<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">",\"message\":\""</span> <span class="token operator">+</span> status<span class="token punctuation">.</span><span class="token function">getReasonPhrase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-catch">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            ex<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword keyword-finally">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span><span class="token keyword keyword-null">null</span> <span class="token operator">!=</span> writer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-private">private</span> <span class="token class-name">ZuulException</span> <span class="token function">findZuulException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>throwable<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-instanceof">instanceof</span> <span class="token class-name">ZuulException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token class-name">ZuulException</span><span class="token punctuation">)</span>throwable<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>throwable<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword keyword-instanceof">instanceof</span> <span class="token class-name">ZuulRuntimeException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword keyword-return">return</span> <span class="token punctuation">(</span><span class="token class-name">ZuulException</span><span class="token punctuation">)</span>throwable<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> <span class="token keyword keyword-new">new</span> <span class="token class-name">ZuulException</span><span class="token punctuation">(</span>throwable<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span><span class="token punctuation">.</span><span class="token constant">SC_INTERNAL_SERVER_ERROR</span><span class="token punctuation">,</span> <span class="token keyword keyword-null">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h2 id="ç½‘å…³è°ƒä¼˜">ç½‘å…³è°ƒä¼˜ </h2>
<p>ä½¿ç”¨ Zuul çš„ Spring Cloud å¾®æœåŠ¡ç»“æ„å›¾ã€‚</p>
<img src="assets/image-20251222234034873.png" alt="image-20251222234034873" style="zoom:57%;">
<p>ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼Œæ•´ä½“è¯·æ±‚é€»è¾‘è¿˜æ˜¯å¾ˆå¤æ‚çš„ï¼Œåœ¨æ²¡æœ‰ zuul ç½‘å…³çš„æƒ…å†µä¸‹ï¼Œclient è¯·æ±‚ service çš„æ—¶å€™ï¼Œä¹Ÿæœ‰è¯·æ±‚è¶…æ—¶çš„å¯èƒ½ï¼Œé‚£ä¹ˆå½“å¢åŠ äº† Zuul ç½‘å…³çš„æ—¶å€™ï¼Œè¯·æ±‚è¶…æ—¶çš„å¯èƒ½å°±ä¼šæ›´åŠ æ˜æ˜¾ã€‚</p>
<p>å½“è¯·æ±‚é€šè¿‡ Zuul ç½‘å…³è·¯ç”±åˆ°æœåŠ¡ï¼Œå¹¶ç­‰å¾…æœåŠ¡è¿”å›å“åº”ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ Zuul ä¹Ÿæœ‰è¶…æ—¶æ§åˆ¶ã€‚Zuul çš„åº•å±‚ä½¿ç”¨çš„æ˜¯ Hystrix + Ribbon æ¥å®ç°è¯·æ±‚è·¯ç”±ã€‚</p>
<img src="assets/image-20251222234427027.png" alt="image-20251222234427027" style="zoom:54%;">
<p>Zuul ä¸­çš„ Hystrix å†…éƒ¨ä½¿ç”¨çº¿ç¨‹æ± éš”ç¦»æœºåˆ¶æä¾›è¯·æ±‚è·¯ç”±å®ç°ï¼Œå…¶é»˜è®¤çš„è¶…æ—¶æ—¶é•¿ä¸º 1000 msï¼ŒRibbon åº•å±‚é»˜è®¤è¶…æ—¶æ—¶é•¿ä¸º 5000 msã€‚</p>
<ul>
<li><span style="color:#e94242;">å¦‚æœ Hystrix è¶…æ—¶ï¼Œç›´æ¥è¿”å›è¶…æ—¶å¼‚å¸¸ï¼›</span></li>
<li><span style="color:#e94242;">å¦‚æœ Ribbon è¶…æ—¶ï¼ŒåŒæ—¶ Hystrix æœªè¶…æ—¶ï¼ŒRibbon ä¼šè‡ªåŠ¨è¿›è¡ŒæœåŠ¡é›†ç¾¤è½®è¯¢é‡è¯•ï¼Œç›´åˆ° Hystrix è¶…æ—¶ä¸ºæ­¢ï¼›</span></li>
<li><span style="color:#e94242;">å¦‚æœ Hystrix è¶…æ—¶æ—¶é•¿å°äº Ribbon è¶…æ—¶æ—¶é•¿ï¼ŒRibbon ä¸ä¼šè¿›è¡ŒæœåŠ¡é›†ç¾¤çš„è½®è¯¢é‡è¯•ï¼›</span></li>
</ul>
<h3 id="æ·»åŠ ä¾èµ–-3">æ·»åŠ ä¾èµ– </h3>
<p>Spring Cloud Netflix Zuul ç½‘å…³é‡è¯•æœºåˆ¶éœ€è¦ä½¿ç”¨ <code>spring-retry</code> ç»„ä»¶ã€‚</p>
<pre data-role="codeBlock" data-info="xml" class="language-xml xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.retry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-retry<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="é…ç½®æ–‡ä»¶-2">é…ç½®æ–‡ä»¶ </h3>
<pre data-role="codeBlock" data-info="yml" class="language-yaml yml"><code><span class="token comment"># Hystrix ç†”æ–­å™¨é…ç½®</span>
<span class="token key atrule">hystrix</span><span class="token punctuation">:</span>
  <span class="token key atrule">command</span><span class="token punctuation">:</span>
    <span class="token key atrule">default</span><span class="token punctuation">:</span>
      <span class="token key atrule">execution</span><span class="token punctuation">:</span>
        <span class="token key atrule">isolation</span><span class="token punctuation">:</span>
          <span class="token key atrule">thread</span><span class="token punctuation">:</span>
            <span class="token comment"># çº¿ç¨‹æ± éš”ç¦»ç­–ç•¥ä¸‹çš„çº¿ç¨‹æ± é…ç½®</span>
            <span class="token key atrule">timeoutInMilliseconds</span><span class="token punctuation">:</span> <span class="token number">10000</span> <span class="token comment"># è®¾ç½® Hystrix å‘½ä»¤çš„æ‰§è¡Œè¶…æ—¶æ—¶é—´ä¸º 10 ç§’</span>

<span class="token comment"># Ribbon è´Ÿè½½å‡è¡¡å™¨é…ç½®ï¼Œå»ºè®®å°äº Hystrix è¶…æ—¶</span>
<span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token key atrule">ConnectionTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span> <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span>
  <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span> <span class="token comment"># è¯»å–è¶…æ—¶æ—¶é—´ï¼Œå•ä½æ¯«ç§’</span>
  <span class="token key atrule">MaxAutoRetries</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># æœ€å¤§è‡ªåŠ¨é‡è¯•æ¬¡æ•°</span>
  <span class="token key atrule">MaxAutoRetriesNextServer</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token comment"># åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæœåŠ¡å™¨çš„æœ€å¤§é‡è¯•æ¬¡æ•°</span>
  <span class="token key atrule">OkToRetryOnAllOperations</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># æ˜¯å¦å¯¹æ‰€æœ‰æ“ä½œè¿›è¡Œé‡è¯•</span>
  
<span class="token comment"># Zuul ç½‘å…³æ ¸å¿ƒé…ç½®</span>
<span class="token key atrule">zuul</span><span class="token punctuation">:</span>
  <span class="token key atrule">retryable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># å¯ç”¨è¯·æ±‚é‡è¯•æœºåˆ¶ï¼Œæå‡è¯·æ±‚æˆåŠŸç‡</span>
</code></pre><h3 id="å¯åŠ¨ç±»-2">å¯åŠ¨ç±» </h3>
<p>å¯åŠ¨ç±»éœ€è¦å¼€å¯ <code>@EnableRetry</code> é‡è¯•æ³¨è§£ã€‚</p>
<pre data-role="codeBlock" data-info="java" class="language-java java"><code><span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrix</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>hystrix<span class="token punctuation">.</span>dashboard<span class="token punctuation">.</span></span><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>zuul<span class="token punctuation">.</span></span><span class="token class-name">EnableZuulProxy</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span></span><span class="token class-name">Environment</span></span><span class="token punctuation">;</span>
<span class="token keyword keyword-import">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>retry<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">EnableRetry</span></span><span class="token punctuation">;</span>
<span class="token doc-comment comment">/**
 * Zuul ç½‘å…³åº”ç”¨å¯åŠ¨ç±»
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>è¯¥ç±»æ˜¯ AutumnNook å¾®æœåŠ¡æ¶æ„ä¸­çš„ API ç½‘å…³å…¥å£ï¼Œè´Ÿè´£ç»Ÿä¸€çš„è·¯ç”±è½¬å‘ã€
 * æœåŠ¡å‘ç°ã€ç†”æ–­é™çº§å’Œç›‘æ§ç®¡ç†åŠŸèƒ½ã€‚<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>æ ¸å¿ƒåŠŸèƒ½æ³¨è§£è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableZuulProxy</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Zuul ä»£ç†åŠŸèƒ½ï¼Œæä¾›åŠ¨æ€è·¯ç”±å’Œè¿‡æ»¤å™¨æ”¯æŒ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableDiscoveryClient</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œä¸æ³¨å†Œä¸­å¿ƒäº¤äº’<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableHystrix</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Hystrix ç†”æ–­å™¨ï¼Œæä¾›æœåŠ¡çš„å®¹é”™ä¿æŠ¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">EnableHystrixDashboard</span></span><span class="token punctuation">}</span>ï¼šå¯ç”¨ Hystrix ä»ªè¡¨ç›˜ï¼Œæä¾›ç†”æ–­ç›‘æ§ç•Œé¢<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword keyword-@link">@link</span> <span class="token reference"><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">}</span>ï¼šSpring Boot åº”ç”¨æ ‡å‡†æ³¨è§£ï¼ŒåŒ…å«ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨é…ç½®<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>åº”ç”¨æ¶æ„å®šä½ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ä½œä¸ºå¾®æœåŠ¡æ¶æ„çš„ç»Ÿä¸€å…¥å£ç½‘å…³<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è´Ÿè´£è¯·æ±‚è·¯ç”±å’Œè´Ÿè½½å‡è¡¡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æä¾›ç»Ÿä¸€çš„è®¤è¯æˆæƒå…¥å£<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å®ç°æœåŠ¡çš„ç†”æ–­é™çº§å’Œé™æµä¿æŠ¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ”¶é›†å’Œå±•ç¤ºæœåŠ¡ç›‘æ§æŒ‡æ ‡<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword keyword-@author">@author</span> è”¡ç†™è´
 * <span class="token keyword keyword-@version">@version</span> 1.0
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableZuulProxy</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableDiscoveryClient</span></span>
 * <span class="token keyword keyword-@see">@see</span> <span class="token reference"><span class="token class-name">EnableHystrix</span></span>
 * <span class="token keyword keyword-@since">@since</span> 2024
 */</span>
<span class="token annotation punctuation">@EnableRetry</span>
<span class="token annotation punctuation">@EnableHystrix</span>                  <span class="token comment">// å¯ç”¨ Hystrix ç†”æ–­å™¨ï¼Œæä¾›æœåŠ¡çš„å®¹é”™ä¿æŠ¤æœºåˆ¶</span>
<span class="token annotation punctuation">@EnableZuulProxy</span>                <span class="token comment">// å¯ç”¨ Zuul ä»£ç†ï¼Œæä¾›åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€å¼¹æ€§ç­‰åŠŸèƒ½</span>
<span class="token annotation punctuation">@SpringBootApplication</span>          <span class="token comment">// Spring Boot åº”ç”¨æ ¸å¿ƒæ³¨è§£ï¼ŒåŒ…å«é…ç½®ã€ç»„ä»¶æ‰«æç­‰</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>          <span class="token comment">// å¯ç”¨æœåŠ¡å‘ç°å®¢æˆ·ç«¯ï¼Œæ”¯æŒ Eurekaã€Consul ç­‰æ³¨å†Œä¸­å¿ƒ</span>
<span class="token annotation punctuation">@EnableHystrixDashboard</span>         <span class="token comment">// å¯ç”¨ Hystrix ä»ªè¡¨ç›˜ï¼Œæä¾›å¯è§†åŒ–çš„ç†”æ–­å™¨ç›‘æ§ç•Œé¢</span>
<span class="token keyword keyword-public">public</span> <span class="token keyword keyword-class">class</span> <span class="token class-name">ZuulApplication</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * æ—¥å¿—è®°å½•å™¨å®ä¾‹ï¼Œç”¨äºè¾“å‡ºåº”ç”¨å¯åŠ¨å’Œè¿è¡Œè¿‡ç¨‹ä¸­çš„å…³é”®ä¿¡æ¯
     */</span>
    <span class="token keyword keyword-private">private</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-final">final</span> <span class="token class-name">Logger</span> logger <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * åº”ç”¨ä¸»å…¥å£æ–¹æ³•
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨æµç¨‹è¯´æ˜ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå§‹åŒ– Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®å’Œ Bean<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨å†…åµŒçš„ Web æœåŠ¡å™¨ï¼ˆUndertowï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å†Œåˆ°æœåŠ¡å‘ç°ä¸­å¿ƒï¼ˆEurekaï¼‰<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>åˆå§‹åŒ– Zuul è·¯ç”±é…ç½®å’Œè¿‡æ»¤å™¨é“¾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å¯åŠ¨ Hystrix ç†”æ–­å™¨å’Œç›‘æ§ä»ªè¡¨ç›˜<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è¾“å‡ºå¯åŠ¨æˆåŠŸä¿¡æ¯å’Œå…³é”®é…ç½®å‚æ•°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>å…³é”®é…ç½®è¾“å‡ºï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡ç«¯å£ï¼šç½‘å…³å¯¹å¤–æœåŠ¡çš„ç«¯å£å·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>å®ä¾‹åœ°å€ï¼šå½“å‰å®ä¾‹åœ¨æ³¨å†Œä¸­å¿ƒæ³¨å†Œçš„åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æœåŠ¡å‘ç°é…ç½®ï¼šæ˜¯å¦æ‹‰å–å’Œæ³¨å†ŒæœåŠ¡çš„å¼€å…³çŠ¶æ€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>æ³¨å†Œä¸­å¿ƒåœ°å€ï¼šEureka æœåŠ¡å™¨é›†ç¾¤åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>è®¿é—®åœ°å€ï¼šåº”ç”¨å¯åŠ¨åçš„å¯è®¿é—®åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>ç›‘æ§ç«¯ç‚¹ï¼šActuator ç›‘æ§ç«¯ç‚¹çš„è®¿é—®åœ°å€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword keyword-@param">@param</span> <span class="token parameter">args</span> å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ç”¨äºè¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°
     */</span>
    <span class="token keyword keyword-public">public</span> <span class="token keyword keyword-static">static</span> <span class="token keyword keyword-void">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¯åŠ¨ Spring Boot åº”ç”¨ï¼Œè¿”å›åº”ç”¨ä¸Šä¸‹æ–‡</span>
        <span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ZuulApplication</span><span class="token punctuation">.</span><span class="token keyword keyword-class">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è·å–ç¯å¢ƒé…ç½®ä¿¡æ¯</span>
        <span class="token class-name">Environment</span> environment <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–å…³é”®é…ç½®ä¿¡æ¯</span>
        <span class="token class-name">String</span> port <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"server.port"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fetchRegistry <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.fetch-registry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> registryWithEureka <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.register-with-eureka"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> defaultZone <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.client.service-url.defaultZone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> hostname <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.instance.hostname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> preferIpAddress <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"eureka.instance.prefer-ip-address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è¾“å‡ºåº”ç”¨å¯åŠ¨æˆåŠŸä¿¡æ¯å’Œå…³é”®é…ç½®</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"========= AutumnNook Zuul started successfully ========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸš€ æœåŠ¡ç«¯å£ï¼š{}"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ  å®ä¾‹åœ°å€ï¼š{}"</span><span class="token punctuation">,</span> hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“¥ æ˜¯å¦ä»æ³¨å†Œä¸­å¿ƒæ‹‰å–æœåŠ¡ï¼š{}"</span><span class="token punctuation">,</span> fetchRegistry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“¤ æ˜¯å¦æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒï¼š{}"</span><span class="token punctuation">,</span> registryWithEureka<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ”— æ³¨å†Œä¸­å¿ƒé›†ç¾¤åœ°å€ï¼š{}"</span><span class="token punctuation">,</span> defaultZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸŒ æ˜¯å¦ä¼˜å…ˆä½¿ç”¨æœåŠ¡å™¨çš„IPåœ°å€ï¼š{}"</span><span class="token punctuation">,</span> preferIpAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ“Š è®¿é—®åœ°å€ï¼šhttp://localhost:{}/"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ğŸ‘ï¸ ç›‘æ§ç«¯ç‚¹ï¼šhttp://localhost:{}/actuator"</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"========================================================"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-static">static</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ³¨å†Œ JVM å…³é—­é’©å­ï¼Œç¡®ä¿åº”ç”¨ä¼˜é›…å…³é—­</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span><span class="token keyword keyword-new">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"===================Autumnnook Zuul æ­£åœ¨å…³é—­==================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"æ­£åœ¨æ¸…ç†èµ„æº..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„èµ„æºæ¸…ç†é€»è¾‘ï¼Œå¦‚ï¼š</span>
            <span class="token comment">// - å…³é—­æ•°æ®åº“è¿æ¥æ± </span>
            <span class="token comment">// - é‡Šæ”¾ Redis è¿æ¥</span>
            <span class="token comment">// - ä»æ³¨å†Œä¸­å¿ƒæ³¨é”€æœåŠ¡</span>
            <span class="token comment">// - åœæ­¢åå°çº¿ç¨‹ç­‰</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"èµ„æºæ¸…ç†å®Œæˆï¼ŒæœåŠ¡å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><h2 id="é«˜å¯ç”¨ç½‘å…³ç¯å¢ƒæ­å»º">é«˜å¯ç”¨ç½‘å…³ç¯å¢ƒæ­å»º </h2>
<p>ä¸šå†…é€šå¸¸ç”¨å¤šå°‘ä¸ª 9 æ¥è¡¡é‡ç½‘ç«™çš„å¯ç”¨æ€§ï¼Œä¾‹å¦‚ QQ çš„å¯ç”¨æ€§æ˜¯ 4 ä¸ª 9 ï¼Œå°±æ˜¯è¯´ QQ èƒ½å¤Ÿä¿è¯åœ¨ä¸€å¹´é‡Œï¼ŒæœåŠ¡åœ¨ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ï¼Œåªæœ‰ 0.01% çš„æ—¶é—´ä¸å¯ç”¨ï¼Œå¤§çº¦æœ€å¤š53åˆ†é’Ÿï¼Œè¿™æ˜¯ååˆ†ç‰›é€¼çš„ã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°ç½‘ç«™æ¥è¯´ï¼Œ2ä¸ª 9 æ˜¯åŸºæœ¬å¯ç”¨ã€3 ä¸ª 9 å°±ä»£è¡¨é«˜å¯ç”¨ã€4 ä¸ª 9 å°±æ˜¯æ‹¥æœ‰è‡ªåŠ¨æ¢å¤èƒ½åŠ›çš„é«˜å¯ç”¨ã€‚</p>
<p>å®ç°é«˜å¯ç”¨çš„ä¸»è¦æ‰‹æ®µå°±æ˜¯ æ•°æ®çš„å†—ä½™å¤‡ä»½å’Œ æœåŠ¡æ•…éšœè½¬ç§»ï¼Œè¿™ä¸¤ä¸ªæ‰‹æ®µå…·ä½“å¯ä»¥æ€ä¹ˆåšï¼Œåœ¨ç½‘å…³ä¸­å¦‚ä½•å®ç°ï¼Ÿä¸»è¦é’ˆå¯¹ä»¥ä¸‹å‡ ä¸ªæ–¹å‘ï¼š</p>
<ul>
<li>é›†ç¾¤éƒ¨ç½²</li>
<li>è´Ÿè½½å‡è¡¡</li>
<li>å¥åº·æ£€æŸ¥</li>
<li>èŠ‚ç‚¹è‡ªåŠ¨é‡å¯</li>
<li>ç†”æ–­</li>
<li>æœåŠ¡é™çº§</li>
<li>æ¥å£é‡è¯•</li>
</ul>
<h3 id="nginx--ç½‘å…³é›†ç¾¤å®ç°é«˜å¯ç”¨ç½‘å…³">Nginx + ç½‘å…³é›†ç¾¤å®ç°é«˜å¯ç”¨ç½‘å…³ </h3>
<img src="./assets/image-20241224200645668.png" alt="image-20241224200645668" style="zoom: 50%;">
<h4 id="ä¸‹è½½å®‰è£…-nginx">ä¸‹è½½å®‰è£… Nginx </h4>
<p>è¯¦è§ <a href="">ç¬¬8ç«  Nginx å®ç° API ç½‘å…³</a>ã€‚</p>
<h4 id="é…ç½®ç½‘å…³é›†ç¾¤">é…ç½®ç½‘å…³é›†ç¾¤ </h4>
<p><em>nginx.conf</em></p>
<pre data-role="codeBlock" data-info="shell" class="language-shell shell"><code>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>
events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
    
    sendfile        on<span class="token punctuation">;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment"># é…ç½®ç½‘å…³é›†ç¾¤</span>
    upstream zuul <span class="token punctuation">{</span>
		server <span class="token number">127.0</span>.0.1:30000<span class="token punctuation">;</span>
		server <span class="token number">127.0</span>.0.1:30001<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>
        
        <span class="token comment"># nginx å°†è¯·æ±‚åˆ†å‘è‡³ç½‘å…³é›†ç¾¤</span>
        location / <span class="token punctuation">{</span>
			proxy_pass http://zuul<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="éªŒè¯é«˜å¯ç”¨ç½‘å…³">éªŒè¯é«˜å¯ç”¨ç½‘å…³ </h4>
<p>æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„ç½‘å…³æœåŠ¡æ‰“æˆ  <code>jar</code>  åŒ…é€šè¿‡æ§åˆ¶å°ä¿®æ”¹å‚æ•°  <code>-Dserver.port</code>  å»å¯åŠ¨ï¼Œè¿™æ ·æˆ‘å°±ä¸éœ€è¦å†å»ºä¸€ä¸ªæ¨¡å—å»å‡‘é›†ç¾¤æœåŠ¡äº†ï¼Œå…·ä½“æƒ…å†µå¦‚ä¸‹ï¼š</p>
<p><img src="./assets/image-20241224202710253.png" alt="image-20241224202710253"></p>
<p>ç„¶åæˆ‘ä»¬å†å¯åŠ¨ Nginx æœåŠ¡ï¼ŒIDEA ä¸­ä»…å¯åŠ¨ æ³¨å†Œä¸­å¿ƒå’ŒæœåŠ¡æä¾›è€…ï¼š</p>
<p><img src="./assets/image-20241224202845465.png" alt="image-20241224202845465"></p>
<p>æ‰“å¼€ Postman è¿›è¡Œæµ‹è¯•ï¼Œæ¨¡æ‹Ÿå¤§é‡è¯·æ±‚è®¿é—®ï¼š</p>
<p><img src="./assets/image-20241224203008409.png" alt="image-20241224203008409"></p>
<p>è¯·æ±‚è½¬å‘æˆåŠŸçš„æƒ…å†µå¦‚ä¸Šæ‰€ç¤ºï¼Œè¯·æ±‚é™æµç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="./assets/image-20241224203056346.png" alt="image-20241224203056346"></p>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>